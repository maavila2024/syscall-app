import{F as Se,E as gl,i as Vl,j as tl,N as hl,k as xl,l as kl}from"./vue-tabler-icons.es-ea5d9a20.js";import{u as ze,aq as al,I as wl,a6 as Te,B as Y,J as i,K as Je,U as re,o as g,c as O,a as d,b as e,w as l,e as le,d as j,t as X,ar as De,l as de,V as M,y as t,as as z,m as ke,at as Ue,P as we,F as qe,q as je,i as Cl,au as Sl,z as ge,S as Ye,T as Ze,p as fe,av as el,aa as Ul,N as Be,O as Ge,ab as Le,aw as ue,ac as oe,an as ol,ax as sl,ay as nl,ad as ul,a3 as Ae,a7 as x,a1 as u,af as C,ae as Z,az as ie,aA as il,W as He,ag as Ke,aB as Re,ao as dl,aC as Oe,a8 as $l,a9 as Ne,r as Tl,ak as Ve,al as ve,aj as me,G as ql,j as Al,aD as Fe,ai as _e,ah as $e,aE as Il,aF as Ee,X as Ml,am as jl}from"./index-2c4a5b9c.js";import{u as Ce}from"./tasks-0107b88b.js";import{_ as We}from"./_plugin-vue_export-helper-c27b6911.js";import{a as V,u as Xe}from"./vee-validate.esm-26d170b6.js";const he=S=>(Be("data-v-8c7da3f8"),S=S(),Ge(),S),Fl={class:"tasks-table-container"},Pl={class:"table-wrapper"},Dl=j(" Chamado "),Rl=j(" Sequência "),Ol=j(" Título "),Nl={class:"text-left",style:{width:"175px"}},El=j(" Solicitante "),zl={class:"text-left",style:{width:"185px"}},Jl=j(" Responsável "),Bl={class:"text-left",style:{width:"135px"}},Gl=j(" Status "),Ll={class:"text-left",style:{width:"165px"}},Hl=j(" Prioridade "),Kl={class:"text-left",style:{width:"235px"}},Wl=j(" Complexidade "),Xl=he(()=>d("th",{class:"text-left",style:{width:"100px"}},"Ações",-1)),Ql=he(()=>d("th",null,null,-1)),Yl={key:0},Zl=he(()=>d("td",null,null,-1)),et=he(()=>d("td",null,null,-1)),lt=he(()=>d("td",null,null,-1)),tt={key:0},at={key:1},ot={key:2},st={key:3},nt={key:4},ut={key:5},it={key:6},dt={key:7},rt={key:8},mt={key:9},ct=he(()=>d("td",null,null,-1)),vt=he(()=>d("td",null,null,-1)),pt={class:"text-clamp"},ft=j("Default"),_t={class:"text-clamp"},bt={class:"text-clamp"},yt={class:"text-right"},gt={class:"d-flex align-center"},Vt={class:"text-clamp"},ht={class:"text-right"},xt={class:"d-flex align-center"},kt={class:"text-clamp"},wt={class:"text-right"},Ct={class:"d-flex align-center"},St={setup(S){const I=ze(),n=Ce(),m=al();wl();const{tasks:J,toShow:B,toEdit:P,toDelete:p,taskFiles:H}=Te(n),$=Y(()=>I.user.teams.some(b=>b.is_admin)),T=i([]),q=i([]),N=i([]),L=i([]),w=i([]),D=i(!1),R=i(!1),K=i(!1),G=i(!1),A=i(!1),k=Y(()=>[...new Set(J.value.map(b=>b.task_status.name))]),E=Y(()=>[...new Set(J.value.map(b=>b.user_owner.first_name))]),h=Y(()=>[...new Set(J.value.map(b=>{var c;return((c=b.user_responsible)==null?void 0:c.first_name)||"Nenhum responsável"}))]),W=Y(()=>[...new Set(J.value.map(b=>b.priority.name))]),F=Y(()=>[...new Set(J.value.map(b=>b.complexity.name))]),_=i(!1),a=i(!1),s=i(!1),se=i(!1),te=i(!1),ce=()=>{_.value=T.value.length===k.value.length},y=()=>{a.value=q.value.length===E.value.length},U=()=>{s.value=N.value.length===h.value.length},v=()=>{se.value=L.value.length===W.value.length},ae=()=>{te.value=w.value.length===F.value.length},Q=()=>{_.value?T.value=[]:T.value=[...k.value]},r=()=>{a.value?q.value=[]:q.value=[...E.value]},f=()=>{s.value?N.value=[]:N.value=[...h.value]},pl=()=>{se.value?L.value=[]:L.value=[...W.value]},fl=()=>{te.value?w.value=[]:w.value=[...F.value]},be=i(""),pe=i("asc"),Pe=b=>{be.value===b?pe.value=pe.value==="asc"?"desc":"asc":(be.value=b,pe.value="asc")},_l=Y(()=>{const b=[...J.value];return b.sort((c,o)=>{const xe=c[be.value],ye=o[be.value];return xe<ye?pe.value==="asc"?-1:1:xe>ye?pe.value==="asc"?1:-1:0}),b}),bl=Y(()=>J.value?_l.value.filter(b=>{var ee,ne,Qe;if(!b)return!1;const c=T.value.length===0||T.value.includes(b.task_status.name),o=q.value.length===0||q.value.includes(b.user_owner.first_name),xe=N.value.length===0||N.value.includes(((ee=b.user_responsible)==null?void 0:ee.first_name)||"Nenhum responsável"),ye=L.value.length===0||L.value.includes(b.priority.name),Ie=w.value.length===0||w.value.includes(b.complexity.name),Me=((ne=I.user)==null?void 0:ne.default_segment)==0||b.segment==((Qe=I.user)==null?void 0:Qe.default_segment);return c&&o&&xe&&ye&&Ie&&Me}):[]),yl=b=>({color:b.color});return Je(()=>{const b=m.query.search||"";b&&n.getTasks(b)}),re(()=>m.query.search,b=>{const c=b||"";n.getTasks(c)}),(b,c)=>(g(),O("div",Fl,[d("div",Pl,[e(Ul,{class:"border-opacity-100"},{default:l(()=>[d("thead",null,[d("tr",null,[d("th",{class:"text-left",style:{width:"50px"},onClick:c[0]||(c[0]=o=>Pe("task_code"))},[Dl,be.value==="task_code"?(g(),le(De,{key:0},{default:l(()=>[j(X(pe.value==="asc"?"mdi-arrow-up":"mdi-arrow-down"),1)]),_:1})):de("",!0)]),d("th",{class:"text-left",style:{width:"50px"},onClick:c[1]||(c[1]=o=>Pe("sequence"))},[Rl,be.value==="sequence"?(g(),le(De,{key:0},{default:l(()=>[j(X(pe.value==="asc"?"mdi-arrow-up":"mdi-arrow-down"),1)]),_:1})):de("",!0)]),d("th",{class:"text-left",style:{width:"50px"},onClick:c[2]||(c[2]=o=>Pe("name"))},[Ol,be.value==="name"?(g(),le(De,{key:0},{default:l(()=>[j(X(pe.value==="asc"?"mdi-arrow-up":"mdi-arrow-down"),1)]),_:1})):de("",!0)]),d("th",Nl,[El,e(M,{icon:"",onClick:c[3]||(c[3]=o=>R.value=!R.value)},{default:l(()=>[e(t(Se))]),_:1})]),d("th",zl,[Jl,e(M,{icon:"",onClick:c[4]||(c[4]=o=>K.value=!K.value)},{default:l(()=>[e(t(Se))]),_:1})]),d("th",Bl,[Gl,e(M,{icon:"",onClick:c[5]||(c[5]=o=>D.value=!D.value)},{default:l(()=>[e(t(Se))]),_:1})]),d("th",Ll,[Hl,e(M,{icon:"",onClick:c[6]||(c[6]=o=>G.value=!G.value)},{default:l(()=>[e(t(Se))]),_:1})]),d("th",Kl,[Wl,e(M,{icon:"",onClick:c[7]||(c[7]=o=>A.value=!A.value)},{default:l(()=>[e(t(Se))]),_:1})]),Xl,Ql])]),d("tbody",null,[R.value||K.value||D.value||G.value||A.value?(g(),O("tr",Yl,[Zl,et,lt,R.value?(g(),O("td",tt,[e(z,{modelValue:q.value,"onUpdate:modelValue":c[9]||(c[9]=o=>q.value=o),items:t(E),label:"Filtro Solicitante",multiple:"",onChange:y},{"prepend-item":l(()=>[e(ke,null,{default:l(()=>[e(Ue,{modelValue:a.value,"onUpdate:modelValue":c[8]||(c[8]=o=>a.value=o),label:a.value?"Desmarcar todos":"Selecionar todos",onChange:r},null,8,["modelValue","label"])]),_:1}),e(we)]),_:1},8,["modelValue","items"])])):(g(),O("td",at)),K.value?(g(),O("td",ot,[e(z,{modelValue:N.value,"onUpdate:modelValue":c[11]||(c[11]=o=>N.value=o),items:t(h),label:"Filtro Responsável",multiple:"",onChange:U},{"prepend-item":l(()=>[e(ke,null,{default:l(()=>[e(Ue,{modelValue:s.value,"onUpdate:modelValue":c[10]||(c[10]=o=>s.value=o),label:s.value?"Desmarcar todos":"Selecionar todos",onChange:f},null,8,["modelValue","label"])]),_:1}),e(we)]),_:1},8,["modelValue","items"])])):(g(),O("td",st)),D.value?(g(),O("td",nt,[e(z,{modelValue:T.value,"onUpdate:modelValue":c[13]||(c[13]=o=>T.value=o),items:t(k),label:"Filtro Status",multiple:"",onChange:ce},{"prepend-item":l(()=>[e(ke,null,{default:l(()=>[e(Ue,{modelValue:_.value,"onUpdate:modelValue":c[12]||(c[12]=o=>_.value=o),label:_.value?"Desmarcar todos":"Selecionar todos",onChange:Q},null,8,["modelValue","label"])]),_:1}),e(we)]),_:1},8,["modelValue","items"])])):(g(),O("td",ut)),G.value?(g(),O("td",it,[e(z,{modelValue:L.value,"onUpdate:modelValue":c[15]||(c[15]=o=>L.value=o),items:t(W),label:"Filtro Prioridade",multiple:"",onChange:v},{"prepend-item":l(()=>[e(ke,null,{default:l(()=>[e(Ue,{modelValue:se.value,"onUpdate:modelValue":c[14]||(c[14]=o=>se.value=o),label:se.value?"Desmarcar todos":"Selecionar todos",onChange:pl},null,8,["modelValue","label"])]),_:1}),e(we)]),_:1},8,["modelValue","items"])])):(g(),O("td",dt)),A.value?(g(),O("td",rt,[e(z,{modelValue:w.value,"onUpdate:modelValue":c[17]||(c[17]=o=>w.value=o),items:t(F),label:"Filtro Complexidade",multiple:"",onChange:ae},{"prepend-item":l(()=>[e(ke,null,{default:l(()=>[e(Ue,{modelValue:te.value,"onUpdate:modelValue":c[16]||(c[16]=o=>te.value=o),label:te.value?"Desmarcar todos":"Selecionar todos",onChange:fl},null,8,["modelValue","label"])]),_:1}),e(we)]),_:1},8,["modelValue","items"])])):(g(),O("td",mt)),ct,vt])):de("",!0),(g(!0),O(qe,null,je(t(bl),(o,xe)=>{var ye,Ie,Me;return g(),O("tr",{key:(o==null?void 0:o.id)||xe},[d("td",null,X(o==null?void 0:o.task_code),1),d("td",null,X(o==null?void 0:o.sequence),1),d("td",null,[d("div",pt,X(o==null?void 0:o.name),1),o!=null&&o.default?(g(),le(Cl,{key:0,size:"small",variant:"tonal",color:"primary",class:"ml-2"},{default:l(()=>[ft]),_:1})):de("",!0)]),d("td",null,[d("div",_t,X((ye=o==null?void 0:o.user_owner)==null?void 0:ye.first_name),1)]),d("td",null,[d("div",bt,X(((Ie=o==null?void 0:o.user_responsible)==null?void 0:Ie.first_name)||"Nenhum responsável"),1)]),d("td",null,[d("div",{class:"text-clamp",style:Sl(yl(o==null?void 0:o.task_status))},X((Me=o==null?void 0:o.task_status)==null?void 0:Me.name),5)]),d("td",yt,[d("div",gt,[e(ge,{text:o==null?void 0:o.priority_justification},{activator:l(({props:ee})=>[e(M,Ye(Ze(ee)),{default:l(()=>{var ne;return[d("span",fe(b.attrs,el(b.on)),[d("div",Vt,X((ne=o==null?void 0:o.priority)==null?void 0:ne.name),1)],16)]}),_:2},1040)]),_:2},1032,["text"])])]),d("td",ht,[d("div",xt,[e(ge,{text:(o==null?void 0:o.complexity_justification)||"Aguardando análise"},{activator:l(({props:ee})=>[e(M,Ye(Ze(ee)),{default:l(()=>{var ne;return[d("span",fe(b.attrs,el(b.on)),[d("div",kt,X(((ne=o==null?void 0:o.complexity)==null?void 0:ne.name)||"Aguardando análise"),1)],16)]}),_:2},1040)]),_:2},1032,["text"])])]),d("td",wt,[d("div",Ct,[e(ge,{text:"Visualizar Chamado"},{activator:l(({props:ee})=>[e(M,fe({icon:"",flat:"",onClick:ne=>B.value=o},ee),{default:l(()=>[e(t(gl),{"stroke-width":"1.5",size:"20",class:"text-primary"})]),_:2},1040,["onClick"])]),_:2},1024),t($)?(g(),le(ge,{key:0,text:"Editar Chamado"},{activator:l(({props:ee})=>[e(M,fe({icon:"",flat:"",onClick:ne=>P.value=o},ee),{default:l(()=>[e(t(Vl),{"stroke-width":"1.5",size:"20",class:"text-primary"})]),_:2},1040,["onClick"])]),_:2},1024)):de("",!0),t($)?(g(),le(ge,{key:1,text:"Deletar Chamado"},{activator:l(({props:ee})=>[e(M,fe({icon:"",flat:"",onClick:ne=>p.value=o},ee),{default:l(()=>[e(t(tl),{"stroke-width":"1.5",size:"20",class:"text-error"})]),_:2},1040,["onClick"])]),_:2},1024)):de("",!0),e(ge,{text:"Consultar Notas de Trabalho"},{activator:l(({props:ee})=>[e(M,fe({icon:"",flat:"",onClick:ne=>b.$emit("openChat",o)},ee),{default:l(()=>[e(t(hl),{"stroke-width":"1.5",size:"20",class:"text-primary"})]),_:2},1040,["onClick"])]),_:2},1024),e(ge,{text:"Anexos"},{activator:l(({props:ee})=>[e(M,fe({icon:"",flat:"",onClick:ne=>b.$emit("openAttachments",o)},ee),{default:l(()=>[e(t(xl),{"stroke-width":"1.5",size:"20",class:"text-primary"})]),_:2},1040,["onClick"])]),_:2},1024)])])])}),128))])]),_:1})])]))}},Ut=We(St,[["__scopeId","data-v-8c7da3f8"]]),$t={emits:["cancel","add"],setup(S,{emit:I}){const n=ze(),m=Ce();i([]);const J=[{label:"Grãos",value:1},{label:"Proteína",value:2}],B=[{label:"Algo que funcionava, parou de funcionar?",value:1},{label:"Fazer uma solicitação, algo novo (melhoria)?",value:2}],P=Y(()=>{var _;return((_=m.priori.find(a=>a.is_default))==null?void 0:_.id)||null}),p=Y(()=>{var _;return((_=m.taskStatus.find(a=>a.is_default))==null?void 0:_.id)||null}),{value:H}=V("segment",2),{value:$}=V("priority_id"),{value:T}=V("task_status_id");Je(()=>{P.value&&!$.value&&($.value=P.value),p.value&&!T.value&&(T.value=p.value)});const q=Y(()=>{const _=m.priori.find(a=>a.id===$.value);return _&&_.justify}),N=Y(()=>Le({segment:ue().required().label("Segmento"),task_type:ue().required().label("Tipo de chamado"),name:oe().required().label("Título"),system_screen:oe().required().label("Tela"),description:oe().required().label("Descrição"),owner_id:ue().required().label("Solicitante"),task_status_id:ue().required().label("Status do Chamado"),priority_id:ue().required().label("Prioridade"),observation:oe().nullable().label("Observação"),priority_justification:q.value?oe().required().label("Justificativa da Prioridade"):oe().label("Justificativa da Prioridade"),status:ol().required().label("Status"),files:sl().of(nl()).nullable()})),{handleSubmit:L,errors:w,isSubmitting:D}=Xe({validationSchema:N,initialValues:{segment:1,task_type:"",name:"",system_screen:"",description:"",owner_id:n.user.id,responsible_id:"",task_status_id:p.value,priority_id:P.value,observation:"",created_at:"",expected_date:"",finish_date:"",priority_justification:"",status:!0,files:[]}}),R=L(async _=>{console.log("priority_id at submit:",$.value),console.log("values before sending:",_),_.priority_id=$.value,_.segment=H.value;try{const a=F.value,s=await m.storeTask(_,a);I("add")}catch(a){console.error("Erro ao adicionar comentário ou fazer upload dos arquivos:",a)}}),K=i(""),{value:G}=V("name"),{value:A}=V("task_type"),{value:k}=V("system_screen"),{value:E}=V("description");V("owner_id"),V("responsible_id");const{value:h}=V("observation");V("created_at"),V("expected_date"),V("finish_date");const{value:W}=V("priority_justification");V("status");const{value:F}=V("files");return re(P,_=>{_&&!$.value&&($.value=_)}),re(p,_=>{_&&!T.value&&(T.value=_)}),re($,_=>{console.log("priority_id changed to:",_),q.value||(W.value="")}),(_,a)=>(g(),O("div",null,[K.value?(g(),le(ul,{key:0,color:"error",class:"mb-2"},{default:l(()=>[j(X(K.value),1)]),_:1})):de("",!0),e(Ke,{onSubmit:He(t(R),["prevent"])},{default:l(()=>[e(Ae,null,{default:l(()=>[e(x,null,{default:l(()=>[e(u,{cols:"6"},{default:l(()=>[e(z,{modelValue:t(H),"onUpdate:modelValue":a[0]||(a[0]=s=>C(H)?H.value=s:null),"error-messages":t(w).segment,items:J,label:"Segmento","item-title":"label","item-value":"value"},null,8,["modelValue","error-messages"])]),_:1}),e(u,{cols:"6"},{default:l(()=>[e(z,{modelValue:t(A),"onUpdate:modelValue":a[1]||(a[1]=s=>C(A)?A.value=s:null),"error-messages":t(w).task_type,items:B,label:"Tipo de chamado","item-title":"label","item-value":"value"},null,8,["modelValue","error-messages"])]),_:1})]),_:1}),e(x,null,{default:l(()=>[e(u,{cols:"12"},{default:l(()=>[e(Z,{modelValue:t(G),"onUpdate:modelValue":a[2]||(a[2]=s=>C(G)?G.value=s:null),"error-messages":t(w).name,label:"Título",variant:"outlined",color:"primary",maxlength:"60",counter:""},null,8,["modelValue","error-messages"])]),_:1})]),_:1}),e(x,null,{default:l(()=>[e(u,{cols:"12"},{default:l(()=>[e(Z,{modelValue:t(k),"onUpdate:modelValue":a[3]||(a[3]=s=>C(k)?k.value=s:null),"error-messages":t(w).system_screen,label:"Tela",variant:"outlined",color:"primary",maxlength:"60",counter:""},null,8,["modelValue","error-messages"])]),_:1})]),_:1}),e(x,null,{default:l(()=>[e(u,{cols:"12"},{default:l(()=>[e(ie,{modelValue:t(E),"onUpdate:modelValue":a[4]||(a[4]=s=>C(E)?E.value=s:null),"error-messages":t(w).description,label:"Descrição",variant:"outlined",color:"primary",rows:"5",maxlength:"500",counter:""},null,8,["modelValue","error-messages"])]),_:1})]),_:1}),e(x,null,{default:l(()=>[e(u,{cols:"12"},{default:l(()=>[e(ie,{modelValue:t(h),"onUpdate:modelValue":a[5]||(a[5]=s=>C(h)?h.value=s:null),"error-messages":t(w).observation,label:"Observação",variant:"outlined",color:"primary",rows:"5",maxlength:"500",counter:""},null,8,["modelValue","error-messages"])]),_:1})]),_:1}),e(x,null,{default:l(()=>[e(u,{cols:"12",md:"12"},{default:l(()=>[e(z,{modelValue:t($),"onUpdate:modelValue":a[6]||(a[6]=s=>C($)?$.value=s:null),"error-messages":t(w).priority_id,items:t(m).priori,label:"Prioridade","item-title":"name","item-value":"id"},null,8,["modelValue","error-messages","items"])]),_:1})]),_:1}),t(q)?(g(),le(x,{key:0},{default:l(()=>[e(u,{cols:"12"},{default:l(()=>[e(ie,{modelValue:t(W),"onUpdate:modelValue":a[7]||(a[7]=s=>C(W)?W.value=s:null),"error-messages":t(w).priority_justification,label:"Justificativa da Prioridade",variant:"outlined",color:"primary",rows:"5",maxlength:"500",counter:""},null,8,["modelValue","error-messages"])]),_:1})]),_:1})):de("",!0),e(x,null,{default:l(()=>[e(u,{cols:"12"},{default:l(()=>[e(il,{modelValue:t(F),"onUpdate:modelValue":a[8]||(a[8]=s=>C(F)?F.value=s:null),label:"Anexos do chamado",multiple:"","error-messages":t(w).files,"show-size":""},null,8,["modelValue","error-messages"])]),_:1})]),_:1}),e(x,{justify:"end"},{default:l(()=>[e(u,{cols:"12",md:"auto"},{default:l(()=>[e(M,{flat:"",text:"Cancelar",onClick:a[9]||(a[9]=s=>I("cancel"))})]),_:1}),e(u,{cols:"12",md:"auto"},{default:l(()=>[e(M,{type:"submit",color:"primary",flat:"",loading:t(D),text:"Adicionar"},null,8,["loading"])]),_:1})]),_:1})]),_:1})]),_:1},8,["onSubmit"])]))}},Tt={props:{task:{type:Object,required:!0}},emits:["cancel","edit"],setup(S,{emit:I}){const n=S,m=Ce(),J=[{label:"Grãos",value:1},{label:"Proteína",value:2}],B=[{label:"Algo que funcionava, parou de funcionar?",value:1},{label:"Fazer uma solicitação, algo novo (melhoria)?",value:2}],{handleSubmit:P,errors:p,isSubmitting:H,setFieldValue:$,setErrors:T}=Xe({validationSchema:Le({segment:ue().required().label("Segmento"),task_type:ue().required().label("Tipo de chamado"),task_code:oe().required().label("Número do chamado"),name:oe().required().label("Título"),system_screen:oe().required().label("Tela"),sequence:ue().nullable().label("Sequência"),description:oe().required().label("Descrição"),owner_id:ue().required().label("Solicitante"),responsible_id:ue().required().label("Responsável"),task_status_id:ue().required().label("Status do Chamado"),priority_id:ue().required().label("Prioridade do Chamado"),complexity_id:ue().required().label("Complexidade do Chamado"),observation:oe().nullable().label("Observação"),created_at:Re().nullable().label("Data de Criação"),expected_date:Re().nullable().label("Data de Criação").transform((Q,r)=>r===""?null:Q),finish_date:Re().nullable().label("Data de Conclusão").transform((Q,r)=>r===""?null:Q),priority_justification:oe().nullable().label("Justificativa da Prioridade"),complexity_justification:oe().nullable().label("Justificativa da Complexidade"),status:ol().required().label("Status")}),initialValues:{segment:n.task.segment,task_type:n.task.task_type,task_code:n.task.task_code,name:n.task.name,description:n.task.description,owner_id:n.task.owner_id,responsible_id:n.task.responsible_id,task_status_id:n.task.task_status_id,system_screen:n.task.system_screen,sequence:n.task.sequence,observation:n.task.observation,priority_id:n.task.priority_id,complexity_id:n.task.complexity_id,priority_justification:n.task.priority_justification,complexity_justification:n.task.complexity_justification,finish_date:n.task.finish_date?n.task.finish_date.split("T")[0]:null,expected_date:n.task.expected_date?n.task.expected_date.split("T")[0]:null,created_at:n.task.created_at?n.task.created_at.split("T")[0]:null,status:n.task.status}}),q={complexityRef:i(null),complexityJustificationRef:i(null),responsibleRef:i(null)},N=()=>{p.responsible_id?Oe(()=>{q.responsibleRef.value.focus(),q.responsibleRef.value.$el.scrollIntoView({behavior:"smooth",block:"center"})}):p.complexity_id?Oe(()=>{q.complexityRef.value.focus(),q.complexityRef.value.$el.scrollIntoView({behavior:"smooth",block:"center"})}):p.complexity_justification&&Oe(()=>{q.complexityJustificationRef.value.focus(),q.complexityJustificationRef.value.$el.scrollIntoView({behavior:"smooth",block:"center"})})};re(p,Q=>{console.log(p),N()});const L=P(async Q=>{ae.value||delete Q.priority_justification,ce.value||(Q.expected_date=null),y.value||(Q.finish_date=null),console.log("Payload being sent to the backend:",Q),await m.updateTask(n.task.id,Q),I("edit")}),w=i(""),{value:D}=V("segment"),{value:R}=V("priority_id"),{value:K}=V("complexity_id"),{value:G}=V("name"),{value:A}=V("task_code"),{value:k}=V("task_type"),{value:E}=V("description"),{value:h}=V("owner_id"),{value:W}=V("responsible_id"),{value:F}=V("task_status_id"),{value:_}=V("system_screen"),{value:a}=V("sequence"),{value:s}=V("observation"),{value:se}=V("priority_justification"),{value:te}=V("complexity_justification"),{value:ce}=V("expected_date"),{value:y}=V("finish_date"),{value:U}=V("created_at"),{value:v}=V("status"),ae=Y(()=>{const Q=m.priori.find(r=>r.id===R.value);return Q&&Q.justify});return re(R,Q=>{ae.value?$("priority_justification",se.value||""):(se.value="",T({priority_justification:void 0}))}),(Q,r)=>(g(),O("div",null,[w.value?(g(),le(ul,{key:0,color:"error",class:"mb-2"},{default:l(()=>[j(X(w.value),1)]),_:1})):de("",!0),e(Ke,{onSubmit:He(t(L),["prevent"])},{default:l(()=>[e(Ae,null,{default:l(()=>[e(x,null,{default:l(()=>[e(u,{cols:"6"},{default:l(()=>[e(z,{modelValue:t(D),"onUpdate:modelValue":r[0]||(r[0]=f=>C(D)?D.value=f:null),"error-messages":t(p).segment,items:J,label:"Segmento","item-title":"label","item-value":"value"},null,8,["modelValue","error-messages"])]),_:1}),e(u,{cols:"6"},{default:l(()=>[e(z,{modelValue:t(k),"onUpdate:modelValue":r[1]||(r[1]=f=>C(k)?k.value=f:null),"error-messages":t(p).task_type,items:B,label:"Tipo de chamado","item-title":"label","item-value":"value"},null,8,["modelValue","error-messages"])]),_:1})]),_:1}),e(x,null,{default:l(()=>[e(u,{cols:"6"},{default:l(()=>[e(Z,{modelValue:t(A),"onUpdate:modelValue":r[2]||(r[2]=f=>C(A)?A.value=f:null),"error-messages":t(p).task_code,label:"Número do chamado",variant:"outlined",color:"primary",disabled:""},null,8,["modelValue","error-messages"])]),_:1}),e(u,{cols:"6"},{default:l(()=>[e(Z,{modelValue:t(G),"onUpdate:modelValue":r[3]||(r[3]=f=>C(G)?G.value=f:null),"error-messages":t(p).name,label:"Título",variant:"outlined",color:"primary",maxlength:"60",counter:""},null,8,["modelValue","error-messages"])]),_:1})]),_:1}),e(x,null,{default:l(()=>[e(u,{cols:"6"},{default:l(()=>[e(Z,{modelValue:t(_),"onUpdate:modelValue":r[4]||(r[4]=f=>C(_)?_.value=f:null),"error-messages":t(p).system_screen,label:"Tela",variant:"outlined",color:"primary",maxlength:"60",counter:""},null,8,["modelValue","error-messages"])]),_:1}),e(u,{cols:"6"},{default:l(()=>[e(Z,{modelValue:t(a),"onUpdate:modelValue":r[5]||(r[5]=f=>C(a)?a.value=f:null),"error-messages":t(p).sequence,label:"Sequência",variant:"outlined",color:"primary",maxlength:"10",counter:""},null,8,["modelValue","error-messages"])]),_:1})]),_:1}),e(x,null,{default:l(()=>[e(u,{cols:"12"},{default:l(()=>[e(ie,{modelValue:t(E),"onUpdate:modelValue":r[6]||(r[6]=f=>C(E)?E.value=f:null),"error-messages":t(p).description,label:"Descrição",variant:"outlined",color:"primary",rows:"5",maxlength:"500",counter:""},null,8,["modelValue","error-messages"])]),_:1})]),_:1}),e(x,null,{default:l(()=>[e(u,{cols:"6"},{default:l(()=>[e(z,{modelValue:t(h),"onUpdate:modelValue":r[7]||(r[7]=f=>C(h)?h.value=f:null),"error-messages":t(p).owner_id,items:t(m).users,label:"Solicitante","item-title":"first_name","item-value":"id",disabled:""},null,8,["modelValue","error-messages","items"])]),_:1}),e(u,{cols:"6"},{default:l(()=>[e(Z,{modelValue:t(U),"onUpdate:modelValue":r[8]||(r[8]=f=>C(U)?U.value=f:null),"error-messages":t(p).created_at,label:"Data de Criação",variant:"outlined",type:"date",disabled:""},null,8,["modelValue","error-messages"])]),_:1})]),_:1}),e(x,null,{default:l(()=>[e(u,{cols:"6"},{default:l(()=>[e(z,{modelValue:t(F),"onUpdate:modelValue":r[9]||(r[9]=f=>C(F)?F.value=f:null),"error-messages":t(p).task_status_id,items:t(m).taskStatus,label:"Status do Chamado","item-title":"name","item-value":"id"},null,8,["modelValue","error-messages","items"])]),_:1}),e(u,{cols:"6"},{default:l(()=>[e(z,{modelValue:t(W),"onUpdate:modelValue":r[10]||(r[10]=f=>C(W)?W.value=f:null),"error-messages":t(p).responsible_id,items:t(m).users,label:"Responsável","item-title":"first_name","item-value":"id",ref:"responsibleRef"},null,8,["modelValue","error-messages","items"])]),_:1})]),_:1}),e(x,null,{default:l(()=>[e(u,{cols:"12"},{default:l(()=>[e(ie,{modelValue:t(s),"onUpdate:modelValue":r[11]||(r[11]=f=>C(s)?s.value=f:null),"error-messages":t(p).observation,label:"Observação",variant:"outlined",color:"primary",rows:"5",maxlength:"500",counter:""},null,8,["modelValue","error-messages"])]),_:1})]),_:1}),e(x,null,{default:l(()=>[e(u,{cols:"6"},{default:l(()=>[e(Z,{modelValue:t(ce),"onUpdate:modelValue":r[12]||(r[12]=f=>C(ce)?ce.value=f:null),"error-messages":t(p).expected_date,label:"Data Esperada",variant:"outlined",type:"date"},null,8,["modelValue","error-messages"])]),_:1}),e(u,{cols:"6"},{default:l(()=>[e(Z,{modelValue:t(y),"onUpdate:modelValue":r[13]||(r[13]=f=>C(y)?y.value=f:null),"error-messages":t(p).finish_date,label:"Data de Conclusão",variant:"outlined",type:"date"},null,8,["modelValue","error-messages"])]),_:1})]),_:1}),e(x,null,{default:l(()=>[e(u,{cols:"6"},{default:l(()=>[e(z,{modelValue:t(R),"onUpdate:modelValue":r[14]||(r[14]=f=>C(R)?R.value=f:null),"error-messages":t(p).priority_id,items:t(m).priori,label:"Prioridade","item-title":"name","item-value":"id"},null,8,["modelValue","error-messages","items"])]),_:1}),e(u,{cols:"6"},{default:l(()=>[e(ie,{modelValue:t(se),"onUpdate:modelValue":r[15]||(r[15]=f=>C(se)?se.value=f:null),"error-messages":t(p).priority_justification,label:"Justificativa da Prioridade",variant:"outlined",color:"primary",rows:"5",maxlength:"500",counter:""},null,8,["modelValue","error-messages"])]),_:1})]),_:1}),e(x,null,{default:l(()=>[e(u,{cols:"6"},{default:l(()=>[e(z,{modelValue:t(K),"onUpdate:modelValue":r[16]||(r[16]=f=>C(K)?K.value=f:null),"error-messages":t(p).complexity_id,items:t(m).complexity,label:"Complexidade do Chamado","item-title":"name","item-value":"id",ref:"complexityRef"},null,8,["modelValue","error-messages","items"])]),_:1}),e(u,{cols:"6"},{default:l(()=>[e(ie,{modelValue:t(te),"onUpdate:modelValue":r[17]||(r[17]=f=>C(te)?te.value=f:null),"error-messages":t(p).complexity_justification,label:"Justificativa da Complexidade",variant:"outlined",color:"primary",rows:"5",ref:"complexityJustificationRef",maxlength:"500",counter:""},null,8,["modelValue","error-messages"])]),_:1})]),_:1}),e(x,null,{default:l(()=>[e(u,{cols:"12"},{default:l(()=>[e(dl,{modelValue:t(v),"onUpdate:modelValue":r[18]||(r[18]=f=>C(v)?v.value=f:null),label:t(v)?"Ativo":"Inativo",color:"primary",inset:""},null,8,["modelValue","label"])]),_:1})]),_:1}),e(x,{justify:"end"},{default:l(()=>[e(u,{cols:"12",md:"auto"},{default:l(()=>[e(M,{flat:"",text:"Cancelar",onClick:r[19]||(r[19]=f=>I("cancel"))})]),_:1}),e(u,{cols:"12",md:"auto"},{default:l(()=>[e(M,{type:"submit",color:"primary",flat:"",loading:t(H),text:"Editar"},null,8,["loading"])]),_:1})]),_:1})]),_:1})]),_:1},8,["onSubmit"])]))}},qt={props:{task:{type:Object,required:!0}},emits:["cancel"],setup(S,{emit:I}){const n=S,m=Ce(),J=[{label:"Grãos",value:1},{label:"Proteína",value:2}],B=[{label:"Algo que funcionava, parou de funcionar!",value:1},{label:"Fazer uma solicitação, algo novo (melhoria)!",value:2}],P=i(n.task.segment),p=i(n.task.task_type),H=i(n.task.task_code),$=i(n.task.name),T=i(n.task.description),q=i(n.task.owner_id),N=i(n.task.responsible_id),L=i(n.task.task_status_id),w=i(n.task.system_screen),D=i(n.task.sequence),R=i(n.task.observation),K=i(n.task.priority_id),G=i(n.task.complexity_id),A=i(n.task.priority_justification),k=i(n.task.complexity_justification),E=i(n.task.finish_date?n.task.finish_date.split("T")[0]:null),h=i(n.task.expected_date?n.task.expected_date.split("T")[0]:null),W=i(n.task.created_at?n.task.created_at.split("T")[0]:null),F=i(n.task.status);return(_,a)=>(g(),O("div",null,[e(Ae,null,{default:l(()=>[e(x,null,{default:l(()=>[e(u,{cols:"6"},{default:l(()=>[e(z,{modelValue:P.value,"onUpdate:modelValue":a[0]||(a[0]=s=>P.value=s),items:J,label:"Segmento","item-title":"label","item-value":"value",disabled:"",class:"custom-label"},null,8,["modelValue"])]),_:1}),e(u,{cols:"6"},{default:l(()=>[e(z,{modelValue:p.value,"onUpdate:modelValue":a[1]||(a[1]=s=>p.value=s),items:B,label:"Tipo de chamado","item-title":"label","item-value":"value",disabled:"",class:"custom-label"},null,8,["modelValue"])]),_:1})]),_:1}),e(x,null,{default:l(()=>[e(u,{cols:"6"},{default:l(()=>[e(Z,{modelValue:H.value,"onUpdate:modelValue":a[2]||(a[2]=s=>H.value=s),label:"Número do chamado",variant:"outlined",color:"primary",disabled:"",class:"custom-label"},null,8,["modelValue"])]),_:1}),e(u,{cols:"6"},{default:l(()=>[e(Z,{modelValue:$.value,"onUpdate:modelValue":a[3]||(a[3]=s=>$.value=s),label:"Título",variant:"outlined",color:"primary",readonly:"",class:"custom-label",rows:"2",maxlength:"60"},null,8,["modelValue"])]),_:1})]),_:1}),e(x,null,{default:l(()=>[e(u,{cols:"6"},{default:l(()=>[e(Z,{modelValue:w.value,"onUpdate:modelValue":a[4]||(a[4]=s=>w.value=s),label:"Tela",variant:"outlined",color:"primary",disabled:"",class:"custom-label"},null,8,["modelValue"])]),_:1}),e(u,{cols:"6"},{default:l(()=>[e(Z,{modelValue:D.value,"onUpdate:modelValue":a[5]||(a[5]=s=>D.value=s),label:"Sequência",variant:"outlined",color:"primary",maxlength:"10",counter:"",class:"custom-label"},null,8,["modelValue"])]),_:1})]),_:1}),e(x,null,{default:l(()=>[e(u,{cols:"12"},{default:l(()=>[e(ie,{modelValue:T.value,"onUpdate:modelValue":a[6]||(a[6]=s=>T.value=s),label:"Descrição",variant:"outlined",color:"primary",rows:"5",readonly:"",class:"custom-label",maxlength:"150",counter:""},null,8,["modelValue"])]),_:1})]),_:1}),e(x,null,{default:l(()=>[e(u,{cols:"6"},{default:l(()=>[e(z,{modelValue:q.value,"onUpdate:modelValue":a[7]||(a[7]=s=>q.value=s),items:t(m).users,label:"Solicitante","item-title":"first_name","item-value":"id",disabled:"",class:"custom-label"},null,8,["modelValue","items"])]),_:1}),e(u,{cols:"6"},{default:l(()=>[e(Z,{modelValue:W.value,"onUpdate:modelValue":a[8]||(a[8]=s=>W.value=s),label:"Data de Criação",variant:"outlined",type:"date",disabled:"",class:"custom-label"},null,8,["modelValue"])]),_:1})]),_:1}),e(x,null,{default:l(()=>[e(u,{cols:"6"},{default:l(()=>[e(z,{modelValue:L.value,"onUpdate:modelValue":a[9]||(a[9]=s=>L.value=s),items:t(m).taskStatus,label:"Status do Chamado","item-title":"name","item-value":"id",disabled:"",class:"custom-label"},null,8,["modelValue","items"])]),_:1}),e(u,{cols:"6"},{default:l(()=>[e(z,{modelValue:N.value,"onUpdate:modelValue":a[10]||(a[10]=s=>N.value=s),items:t(m).users,label:"Responsável","item-title":"first_name","item-value":"id",disabled:"",class:"custom-label"},null,8,["modelValue","items"])]),_:1})]),_:1}),e(x,null,{default:l(()=>[e(u,{cols:"12"},{default:l(()=>[e(ie,{modelValue:R.value,"onUpdate:modelValue":a[11]||(a[11]=s=>R.value=s),label:"Observação",variant:"outlined",color:"primary",rows:"5",readonly:"",class:"custom-label",maxlength:"500",counter:""},null,8,["modelValue"])]),_:1})]),_:1}),e(x,null,{default:l(()=>[e(u,{cols:"6"},{default:l(()=>[e(Z,{modelValue:h.value,"onUpdate:modelValue":a[12]||(a[12]=s=>h.value=s),label:"Data Esperada",variant:"outlined",type:"date",disabled:"",class:"custom-label"},null,8,["modelValue"])]),_:1}),e(u,{cols:"6"},{default:l(()=>[e(Z,{modelValue:E.value,"onUpdate:modelValue":a[13]||(a[13]=s=>E.value=s),label:"Data de Conclusão",variant:"outlined",type:"date",disabled:"",class:"custom-label"},null,8,["modelValue"])]),_:1})]),_:1}),e(x,null,{default:l(()=>[e(u,{cols:"6"},{default:l(()=>[e(z,{modelValue:K.value,"onUpdate:modelValue":a[14]||(a[14]=s=>K.value=s),items:t(m).priori,label:"Prioridade","item-title":"name","item-value":"id",disabled:"",class:"custom-label"},null,8,["modelValue","items"])]),_:1}),e(u,{cols:"6"},{default:l(()=>[e(ie,{modelValue:A.value,"onUpdate:modelValue":a[15]||(a[15]=s=>A.value=s),label:"Justificativa da Prioridade",variant:"outlined",color:"primary",rows:"5",readonly:"",class:"custom-label",maxlength:"500",counter:""},null,8,["modelValue"])]),_:1})]),_:1}),e(x,null,{default:l(()=>[e(u,{cols:"6"},{default:l(()=>[e(z,{modelValue:G.value,"onUpdate:modelValue":a[16]||(a[16]=s=>G.value=s),items:t(m).complexity,label:"Complexidade do Chamado","item-title":"name","item-value":"id",disabled:"",class:"custom-label"},null,8,["modelValue","items"])]),_:1}),e(u,{cols:"6"},{default:l(()=>[e(ie,{modelValue:k.value,"onUpdate:modelValue":a[17]||(a[17]=s=>k.value=s),label:"Justificativa da Complexidade",variant:"outlined",color:"primary",rows:"5",readonly:"",class:"custom-label",maxlength:"500",counter:""},null,8,["modelValue"])]),_:1})]),_:1}),e(x,null,{default:l(()=>[e(u,{cols:"12"},{default:l(()=>[e(dl,{modelValue:F.value,"onUpdate:modelValue":a[18]||(a[18]=s=>F.value=s),label:F.value?"Ativo":"Inativo",color:"primary",inset:"",disabled:""},null,8,["modelValue","label"])]),_:1})]),_:1}),e(x,{justify:"end"},{default:l(()=>[e(u,{cols:"12",md:"auto"},{default:l(()=>[e(M,{flat:"",text:"Fechar",onClick:a[19]||(a[19]=s=>_.$emit("cancel"))})]),_:1})]),_:1})]),_:1})]))}},rl=$l("chats",{state:()=>({messages:[]}),actions:{async fetchMessages(S){try{const I=await Ne.get(`/api/interactions/${S}`);this.messages=I.data}catch(I){console.error("Error fetching messages:",I)}},async createInteraction(S,I,n){try{return(await Ne.post("/api/interactions",{task_id:S,comment:I,user_id:n})).data}catch(m){console.error("Error creating interaction:",m)}},async uploadFile(S){try{return(await Ne.post("/api/interaction-file",S,{headers:{"Content-Type":"multipart/form-data"}})).data}catch(I){throw console.error("Error uploading file:",I),I}}}});function ml(S){return`https://syscall-api.devtest.com.br//storage/${S}`}const cl=S=>(Be("data-v-4ff77f2d"),S=S(),Ge(),S),At=cl(()=>d("span",{class:"text-h5"},"Notas de Trabalho",-1)),It={class:"comment-text"},Mt={key:0},jt=["href"],Ft={class:"text-right text-caption mt-2"},Pt={class:"email-text"},Dt=j(" - "),Rt={class:"email-text"},Ot=j("Adicionar Comentário"),Nt=j("Fechar"),Et=cl(()=>d("span",{class:"text-h5"},"Adicionar Comentário",-1)),zt=j("Cancelar"),Jt=j("Adicionar"),Bt={props:{taskId:{type:Number,required:!0},showChatModal:{type:Boolean,required:!0},userId:{type:Number,required:!0}},emits:["update:showChatModal"],setup(S,{emit:I}){const n=S,m=rl(),{messages:J}=Te(m),B=i(!1),P=i(!1),p=Le({comment:oe().required().label("Comentário"),files:sl().of(nl()).nullable()}),{handleSubmit:H,errors:$,isSubmitting:T,resetForm:q}=Xe({validationSchema:p,initialValues:{comment:"",files:[]}}),N=H(async A=>{try{const k=await m.createInteraction(n.taskId,A.comment,n.userId);if(A.files&&A.files.length>0){const E=new FormData;E.append("interaction_id",k.id);for(const h of A.files)E.append("files[]",h);await m.uploadFile(E)}await m.fetchMessages(n.taskId),P.value=!1,I("update:showChatModal",!1)}catch(k){console.error("Erro ao adicionar comentário ou fazer upload dos arquivos:",k)}}),{value:L}=V("comment"),{value:w}=V("files");re(()=>n.showChatModal,async A=>{A?(B.value=!0,await m.fetchMessages(n.taskId)):B.value=!1});const D=()=>{I("update:showChatModal",!1)},R=()=>{q(),P.value=!0},K=A=>{const k={year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"};return new Date(A).toLocaleDateString("pt-BR",k)},G=Y(()=>[...J.value].sort((A,k)=>k.id-A.id));return(A,k)=>{const E=Tl("v-list-item-content");return g(),le(_e,{modelValue:B.value,"onUpdate:modelValue":k[4]||(k[4]=h=>B.value=h),"max-width":"800px",persistent:""},{default:l(()=>[e(me,null,{default:l(()=>[e(Ve,null,{default:l(()=>[At]),_:1}),e(ve,null,{default:l(()=>[e(Ae,null,{default:l(()=>[e(x,null,{default:l(()=>[(g(!0),O(qe,null,je(t(G),(h,W)=>(g(),le(u,{key:W,cols:"12"},{default:l(()=>[e(me,{class:"mb-3"},{default:l(()=>[e(ve,null,{default:l(()=>[d("div",It,X(h.comment),1),h.interaction_files&&h.interaction_files.length?(g(),O("div",Mt,[e(we),e(ql,null,{default:l(()=>[(g(!0),O(qe,null,je(h.interaction_files,(F,_)=>(g(),le(ke,{key:_},{default:l(()=>[e(E,null,{default:l(()=>[e(Al,null,{default:l(()=>[d("a",{href:t(ml)(F.path),target:"_blank"},X(F.name),9,jt)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:2},1024)])):de("",!0),d("div",Ft,[d("span",Pt,X(h.user_email),1),Dt,d("span",Rt,X(K(h.created_at)),1)])]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})]),_:1}),e(Fe,null,{default:l(()=>[e(M,{color:"primary",onClick:R},{default:l(()=>[Ot]),_:1}),e(M,{color:"secondary",onClick:D},{default:l(()=>[Nt]),_:1})]),_:1})]),_:1}),e(_e,{modelValue:P.value,"onUpdate:modelValue":k[3]||(k[3]=h=>P.value=h),"max-width":"500px",persistent:""},{default:l(()=>[e(me,null,{default:l(()=>[e(Ve,null,{default:l(()=>[Et]),_:1}),e(ve,null,{default:l(()=>[e(Ke,{onSubmit:He(t(N),["prevent"])},{default:l(()=>[e(ie,{modelValue:t(L),"onUpdate:modelValue":k[0]||(k[0]=h=>C(L)?L.value=h:null),label:"Comentário","error-messages":t($).comment},null,8,["modelValue","error-messages"]),e(il,{modelValue:t(w),"onUpdate:modelValue":k[1]||(k[1]=h=>C(w)?w.value=h:null),label:"Selecionar Arquivos","error-messages":t($).files,"show-size":"",multiple:""},null,8,["modelValue","error-messages"])]),_:1},8,["onSubmit"])]),_:1}),e(Fe,null,{default:l(()=>[e(M,{color:"blue darken-1",text:"",onClick:k[2]||(k[2]=h=>P.value=!1)},{default:l(()=>[zt]),_:1}),e(M,{color:"blue darken-1",text:"",loading:t(T),onClick:t(N)},{default:l(()=>[Jt]),_:1},8,["loading","onClick"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1},8,["modelValue"])}}},ll=We(Bt,[["__scopeId","data-v-4ff77f2d"]]),Gt=d("span",{class:"text-h5"},"Anexos do Chamado",-1),Lt=["href"],Ht=j("Fechar"),Kt={props:{taskId:{type:Number,required:!0},showAttachmentsModal:{type:Boolean,required:!0}},emits:["update:showAttachmentsModal"],setup(S,{emit:I}){const n=S,m=Ce(),{taskFiles:J}=Te(m),B=i(!1);re(()=>n.showAttachmentsModal,async H=>{H?(await m.getTaskFiles(n.taskId),B.value=!0):B.value=!1});const P=()=>{I("update:showAttachmentsModal",!1)},p=async H=>{await m.deleteTaskFile(H),await m.getTaskFiles(n.taskId)};return(H,$)=>(g(),le(_e,{modelValue:B.value,"onUpdate:modelValue":$[0]||($[0]=T=>B.value=T),"max-width":"800px",persistent:""},{default:l(()=>[e(me,null,{default:l(()=>[e(Ve,null,{default:l(()=>[Gt]),_:1}),e(ve,null,{default:l(()=>[e(Ae,null,{default:l(()=>[e(x,null,{default:l(()=>[(g(!0),O(qe,null,je(t(J),(T,q)=>(g(),le(u,{key:q,cols:"12"},{default:l(()=>[e(me,{class:"mb-3"},{default:l(()=>[e(ve,null,{default:l(()=>[d("a",{href:t(ml)(T.path),target:"_blank"},X(T.name),9,Lt),e(M,{icon:"",onClick:N=>p(T.id)},{default:l(()=>[e(t(kl))]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})]),_:1}),e(Fe,null,{default:l(()=>[e(M,{color:"secondary",onClick:P},{default:l(()=>[Ht]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]))}};const vl=S=>(Be("data-v-d95a4dcb"),S=S(),Ge(),S),Wt={class:"mb-5 pb-5 border-b border-opacity-100"},Xt=vl(()=>d("label",{class:"mr-4"},"Segmento:",-1)),Qt=j("Novo Chamado"),Yt=j("Adicionar chamado"),Zt=j("Visualizar chamado"),ea=j("Editar chamado"),la=j("Cancelar"),ta=j("Deletar"),aa=vl(()=>d("span",{class:"text-h5"},"Adicionar Nota de Trabalho",-1)),oa=j("Cancelar"),sa=j("Adicionar"),na={setup(S){var ce;const I=al(),n=ze(),m=Ce(),{toShow:J,toEdit:B,toDelete:P}=Te(m),p=rl();Te(p);const{isLoading:H}=$e(m.getTasks());$e(m.getPriorities()),$e(m.getComplexities()),$e(m.getTasksStatus()),$e(m.getUsers());const $=Y({get(){return!!Object.keys(B.value).length},set(y){y||(B.value={})}}),T=Y({get(){return!!Object.keys(J.value).length},set(y){y||(J.value={})}}),q=Y({get(){return!!Object.keys(P.value).length},set(y){y||(P.value={})}}),N=i(!1);async function L(y){N.value=!0,await m.deleteTask(y.id),P.value={},N.value=!1}const w=i(!1),D=i(0),R=i(!1),K=i(""),G=i(n.user.id),A=y=>{y&&y.id&&(D.value=y.id,w.value=!0)},k=y=>{y&&y.id&&(D.value=y.id,R.value=!0)},E=async()=>{await p.addMessage(D.value,K.value,G.value),K.value="",R.value=!1},h=i(!1),W=y=>{y&&y.id&&(D.value=y.id,h.value=!0)},F=i(""),_=i(!1),a=i(((ce=n.user)==null?void 0:ce.default_segment)||"0");function s(y,U){let v;return function(...ae){clearTimeout(v),v=setTimeout(()=>y(...ae),U)}}const se=async()=>{try{await n.updateUserSegment(a.value),te()}catch(y){console.error("Failed to update user segment:",y)}},te=s(async()=>{const y=F.value||"";await m.getTasks(y,a.value)},2e3);return re(F,te),re(a,te),Je(()=>{const y=I.query.search||"";y?(_.value=!0,m.getTasks(y).then(()=>{_.value=!1})):te()}),re(F,y=>{m.getTasks(y)}),(y,U)=>(g(),O("div",null,[d("div",Wt,[e(x,{align:"center",justify:"space-between"},{default:l(()=>[e(u,{cols:"12",lg:"3",md:"4"},{default:l(()=>[e(Z,{density:"compact",modelValue:F.value,"onUpdate:modelValue":U[0]||(U[0]=v=>F.value=v),label:"Pesquisar Chamados","append-inner-icon":"mdi-magnify","hide-details":"",variant:"outlined"},null,8,["modelValue"])]),_:1}),e(u,{cols:"12",lg:"6",md:"4",class:"d-flex align-center"},{default:l(()=>[Xt,e(Il,{modelValue:a.value,"onUpdate:modelValue":U[1]||(U[1]=v=>a.value=v),onChange:se,row:"",inline:"",class:"radio-button"},{default:l(()=>[e(Ee,{label:"Todos",value:"0",class:"mr-2"}),e(Ee,{label:"Grãos",value:"1",class:"mr-2"}),e(Ee,{label:"Proteína",value:"2"})]),_:1},8,["modelValue"])]),_:1}),e(u,{cols:"12",lg:"3",md:"4",class:"text-right"},{default:l(()=>[e(_e,{width:"800",persistent:""},{activator:l(({props:v})=>[e(M,fe({flat:"",color:"primary"},v),{default:l(()=>[Qt]),_:2},1040)]),default:l(({isActive:v})=>[e(me,{width:"800"},{default:l(()=>[e(Ve,null,{default:l(()=>[Yt]),_:1}),e(ve,null,{default:l(()=>[e($t,{onAdd:ae=>v.value=!1,onCancel:ae=>v.value=!1},null,8,["onAdd","onCancel"])]),_:2},1024)]),_:2},1024)]),_:1})]),_:1})]),_:1})]),t(H)?(g(),le(jl,{key:0,width:3,color:"primary",indeterminate:""})):(g(),O(qe,{key:1},[e(Ut,{onOpenChat:A,onAddNote:k,onOpenAttachments:W}),e(_e,{modelValue:t(T),"onUpdate:modelValue":U[2]||(U[2]=v=>C(T)?T.value=v:null),width:"800",persistent:""},{default:l(({isActive:v})=>[e(me,{width:"800"},{default:l(()=>[e(Ve,null,{default:l(()=>[Zt]),_:1}),e(ve,null,{default:l(()=>[e(qt,{task:t(J),onCancel:ae=>v.value=!1,onShow:ae=>v.value=!1},null,8,["task","onCancel","onShow"])]),_:2},1024)]),_:2},1024)]),_:1},8,["modelValue"]),e(_e,{modelValue:t($),"onUpdate:modelValue":U[3]||(U[3]=v=>C($)?$.value=v:null),width:"800",persistent:""},{default:l(({isActive:v})=>[e(me,{width:"800"},{default:l(()=>[e(Ve,null,{default:l(()=>[ea]),_:1}),e(ve,null,{default:l(()=>[e(Tt,{task:t(B),onCancel:ae=>v.value=!1,onEdit:ae=>v.value=!1},null,8,["task","onCancel","onEdit"])]),_:2},1024)]),_:2},1024)]),_:1},8,["modelValue"]),e(_e,{modelValue:t(q),"onUpdate:modelValue":U[5]||(U[5]=v=>C(q)?q.value=v:null),width:"800",persistent:""},{default:l(({isActive:v})=>[e(me,{"prepend-icon":t(tl),title:"Você tem certeza que deseja deletar este chamado?"},{actions:l(()=>[e(Ml),e(M,{onClick:ae=>v.value=!1},{default:l(()=>[la]),_:2},1032,["onClick"]),e(M,{onClick:U[4]||(U[4]=ae=>L(t(P))),variant:"tonal",color:"error",loading:N.value},{default:l(()=>[ta]),_:1},8,["loading"])]),_:2},1032,["prepend-icon"])]),_:1},8,["modelValue"])],64)),e(ll,{taskId:D.value,showChatModal:w.value,userId:G.value,"onUpdate:showChatModal":U[6]||(U[6]=v=>w.value=v)},null,8,["taskId","showChatModal","userId"]),e(_e,{modelValue:R.value,"onUpdate:modelValue":U[9]||(U[9]=v=>R.value=v),"max-width":"500px",persistent:""},{default:l(()=>[e(me,null,{default:l(()=>[e(Ve,null,{default:l(()=>[aa]),_:1}),e(ve,null,{default:l(()=>[e(ll,{taskId:D.value,showChatModal:w.value,userId:G.value,"onUpdate:showChatModal":U[7]||(U[7]=v=>w.value=v)},null,8,["taskId","showChatModal","userId"])]),_:1}),e(Fe,null,{default:l(()=>[e(M,{color:"blue darken-1",text:"",onClick:U[8]||(U[8]=v=>R.value=!1)},{default:l(()=>[oa]),_:1}),e(M,{color:"blue darken-1",text:"",onClick:E},{default:l(()=>[sa]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(Kt,{taskId:D.value,showAttachmentsModal:h.value,"onUpdate:showAttachmentsModal":U[10]||(U[10]=v=>h.value=v)},null,8,["taskId","showAttachmentsModal"])]))}},ca=We(na,[["__scopeId","data-v-d95a4dcb"]]);export{ca as default};
