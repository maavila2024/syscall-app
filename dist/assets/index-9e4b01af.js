import{F as pe,P as Oe,i as qe,N as ze,j as Je,k as Be}from"./vue-tabler-icons.es-99a3f75e.js";import{a3 as Me,a4 as Q,a5 as _e,L as U,B as Y,o as y,e as ee,w as t,a as n,b as e,y as l,V as $,c as D,an as H,l as me,q as ye,ao as Le,t as X,i as We,M as Se,N as Te,p as ne,ap as $e,z as de,F as ve,a6 as Ge,d as N,u as Fe,aq as He,a7 as xe,ar as Z,a8 as K,ak as Ae,as as Ie,at as je,Q as ue,a9 as Pe,a0 as ke,ai as x,_ as v,ab as k,aa as ae,au as oe,av as Ee,S as Re,ac as we,aw as be,al as Qe,ax as Ve,r as Ke,ag as ce,ah as ie,af as se,I as Xe,G as Ye,m as Ze,j as et,ay as ge,ae as re,ad as fe,T as tt,aj as lt}from"./index-85f9b6c3.js";import{a as f,u as Ce}from"./vee-validate.esm-e5128efb.js";const he=Me("tasks",{state:()=>({tasks:[],priori:[],complexity:[],users:[],taskStatus:[],toEdit:{},toDelete:{},toShowChat:{},toAddChat:{},taskFiles:[]}),actions:{async getTasks(){try{const s=await Q.get("api/tasks");this.tasks=s.data.data}catch(s){console.error("Error fetching tasks:",s)}},async getPriorities(){try{const s=await Q.get("api/priorities");this.priori=s.data.data}catch(s){console.error("Error fetching priorities:",s)}},async getComplexities(){try{const s=await Q.get("api/complexities");this.complexity=s.data.data}catch(s){console.error("Error fetching complexities:",s)}},async getUsers(){try{const s=await Q.get("api/users");this.users=s.data.data}catch(s){console.error("Error fetching users:",s)}},async getTasksStatus(){try{const s=await Q.get("api/tasks-status");this.taskStatus=s.data.data}catch(s){console.error("Error fetching task statuses:",s)}},async storeTask(s,o){try{const d=(await Q.post("api/tasks",s)).data;if(await this.getTasks(),console.log("task",d),o&&o.length>0){const O=new FormData;O.append("task_id",d.id);for(const P of o)O.append("files[]",P);await this.uploadTaskFile(O)}return d}catch(a){console.error("Error storing task:",a)}},async updateTask(s,o){try{const d=(await Q.put(`api/tasks/${s}`,o)).data.data,O=this.tasks.findIndex(P=>P.id===s);this.tasks.splice(O,1,d),await this.getTasks()}catch(a){console.error("Error updating task:",a)}},async deleteTask(s){try{await Q.delete(`api/tasks/${s}`);const o=this.tasks.findIndex(a=>a.id===s);this.tasks.splice(o,1)}catch(o){console.error("Error deleting task:",o)}},async uploadTaskFile(s){console.log("upload",s);try{return(await Q.post("api/task-file",s,{headers:{"Content-Type":"multipart/form-data"}})).data}catch(o){throw console.error("Error uploading task file:",o),o}},async getTaskFiles(s){try{const o=await Q.get(`api/task-file/${s}`);this.taskFiles=o.data.data}catch(o){console.error("Error fetching task files:",o)}},async deleteTaskFile(s){try{await Q.delete(`api/task-file/${s}`);const o=this.taskFiles.findIndex(a=>a.id===s);o!==-1&&this.taskFiles.splice(o,1)}catch(o){console.error("Error deleting task file:",o)}}}});const at=n("th",{class:"text-left",style:{width:"100px"}},"Chamado",-1),st=n("th",{class:"text-left",style:{width:"150px"}},"Título",-1),ot=n("th",{class:"text-left",style:{width:"200px"}},"Descrição",-1),it={class:"text-left",style:{width:"120px"}},nt=N("Solicitante "),rt={class:"text-left",style:{width:"150px"}},ut=N("Responsável "),dt={class:"text-left",style:{width:"120px"}},ct=N("Status "),mt={class:"text-left",style:{width:"120px"}},pt=N("Prioridade "),ft={class:"text-left",style:{width:"150px"}},_t=N("Complexidade "),vt=n("th",{class:"text-left",style:{width:"100px"}},"Ações",-1),ht=n("th",null,null,-1),yt={key:0},gt=n("td",null,null,-1),kt=n("td",null,null,-1),bt=n("td",null,null,-1),Vt={key:0},xt={key:1},wt={key:2},Ct={key:3},St={key:4},Tt={key:5},$t={key:6},Ut={key:7},qt={key:8},Mt={key:9},Ft=n("td",null,null,-1),At=n("td",null,null,-1),It={class:"text-clamp"},jt=N(" Default "),Pt={class:"text-clamp"},Et={class:"text-clamp"},Rt={class:"text-clamp"},Dt={class:"text-clamp"},Nt={class:"text-right"},Ot={class:"d-flex align-center"},zt={class:"text-clamp"},Jt={class:"text-right"},Bt={class:"d-flex align-center"},Lt={class:"text-clamp"},Wt={class:"text-right"},Gt={class:"d-flex align-center"},Ht={setup(s){const o=he(),{tasks:a,toEdit:d,toDelete:O,taskFiles:P}=_e(o),M=U([]),u=U([]),F=U([]),V=U([]),A=U([]),T=U(!1),E=U(!1),J=U(!1),j=U(!1),B=U(!1),R=Y(()=>{const c=a.value.map(i=>i.task_status.name);return["Todos",...[...new Set(c)]]}),w=Y(()=>{const c=a.value.map(i=>i.user_owner.first_name);return["Todos",...[...new Set(c)]]}),z=Y(()=>{const c=a.value.map(i=>{var te;return((te=i.user_responsible)==null?void 0:te.first_name)||"Nenhum responsável"});return["Todos",...[...new Set(c)]]}),g=Y(()=>{const c=a.value.map(i=>i.priority.name);return["Todos",...[...new Set(c)]]}),G=Y(()=>{const c=a.value.map(i=>i.complexity.name);return["Todos",...[...new Set(c)]]}),C=c=>{(c.includes("Todos")||M.value.length===0)&&(M.value=R.value.slice(1))},b=c=>{(c.includes("Todos")||u.value.length===0)&&(u.value=w.value.slice(1))},_=c=>{(c.includes("Todos")||F.value.length===0)&&(F.value=z.value.slice(1))},L=c=>{(c.includes("Todos")||V.value.length===0)&&(V.value=g.value.slice(1))},I=c=>{(c.includes("Todos")||A.value.length===0)&&(A.value=G.value.slice(1))},m=Y(()=>a.value.filter(c=>{var q;const h=M.value.length===0||M.value.includes(c.task_status.name),i=u.value.length===0||u.value.includes(c.user_owner.first_name),te=F.value.length===0||F.value.includes(((q=c.user_responsible)==null?void 0:q.first_name)||"Nenhum responsável"),le=V.value.length===0||V.value.includes(c.priority.name),W=A.value.length===0||A.value.includes(c.complexity.name);return h&&i&&te&&le&&W})),S=c=>({color:c.color});return(c,h)=>(y(),ee(Ge,{class:"border-opacity-100"},{default:t(()=>[n("thead",null,[n("tr",null,[at,st,ot,n("th",it,[nt,e($,{icon:"",onClick:h[0]||(h[0]=i=>E.value=!E.value)},{default:t(()=>[e(l(pe))]),_:1})]),n("th",rt,[ut,e($,{icon:"",onClick:h[1]||(h[1]=i=>J.value=!J.value)},{default:t(()=>[e(l(pe))]),_:1})]),n("th",dt,[ct,e($,{icon:"",onClick:h[2]||(h[2]=i=>T.value=!T.value)},{default:t(()=>[e(l(pe))]),_:1})]),n("th",mt,[pt,e($,{icon:"",onClick:h[3]||(h[3]=i=>j.value=!j.value)},{default:t(()=>[e(l(pe))]),_:1})]),n("th",ft,[_t,e($,{icon:"",onClick:h[4]||(h[4]=i=>B.value=!B.value)},{default:t(()=>[e(l(pe))]),_:1})]),vt,ht])]),n("tbody",null,[E.value||J.value||T.value||j.value||B.value?(y(),D("tr",yt,[gt,kt,bt,E.value?(y(),D("td",Vt,[e(H,{modelValue:u.value,"onUpdate:modelValue":h[5]||(h[5]=i=>u.value=i),items:l(w),label:"Filtro Solicitante",multiple:"",onChange:b},null,8,["modelValue","items"])])):(y(),D("td",xt)),J.value?(y(),D("td",wt,[e(H,{modelValue:F.value,"onUpdate:modelValue":h[6]||(h[6]=i=>F.value=i),items:l(z),label:"Filtro Responsável",multiple:"",onChange:_},null,8,["modelValue","items"])])):(y(),D("td",Ct)),T.value?(y(),D("td",St,[e(H,{modelValue:M.value,"onUpdate:modelValue":h[7]||(h[7]=i=>M.value=i),items:l(R),label:"Filtro Status",multiple:"",onChange:C},null,8,["modelValue","items"])])):(y(),D("td",Tt)),j.value?(y(),D("td",$t,[e(H,{modelValue:V.value,"onUpdate:modelValue":h[8]||(h[8]=i=>V.value=i),items:l(g),label:"Filtro Prioridade",multiple:"",onChange:L},null,8,["modelValue","items"])])):(y(),D("td",Ut)),B.value?(y(),D("td",qt,[e(H,{modelValue:A.value,"onUpdate:modelValue":h[9]||(h[9]=i=>A.value=i),items:l(G),label:"Filtro Complexidade",multiple:"",onChange:I},null,8,["modelValue","items"])])):(y(),D("td",Mt)),Ft,At])):me("",!0),(y(!0),D(ve,null,ye(l(m),(i,te)=>{var le;return y(),D("tr",{key:te,style:Le(S(i.task_status))},[n("td",null,X(i.task_code),1),n("td",null,[n("div",It,X(i.name),1),i.default?(y(),ee(We,{key:0,size:"small",variant:"tonal",color:"primary",class:"ml-2"},{default:t(()=>[jt]),_:1})):me("",!0)]),n("td",null,[n("div",Pt,X(i.description),1)]),n("td",null,[n("div",Et,X(i.user_owner.first_name),1)]),n("td",null,[n("div",Rt,X(((le=i.user_responsible)==null?void 0:le.first_name)||"Nenhum responsável"),1)]),n("td",null,[n("div",Dt,X(i.task_status.name),1)]),n("td",Nt,[n("div",Ot,[e(de,{text:i.priority_justification},{activator:t(({props:W})=>[e($,Se(Te(W)),{default:t(()=>[n("span",ne(c.attrs,$e(c.on)),[n("div",zt,X(i.priority.name),1)],16)]),_:2},1040)]),_:2},1032,["text"])])]),n("td",Jt,[n("div",Bt,[e(de,{text:i.complexity_justification||"Aguardando análise"},{activator:t(({props:W})=>[e($,Se(Te(W)),{default:t(()=>{var q;return[n("span",ne(c.attrs,$e(c.on)),[n("div",Lt,X(((q=i.complexity)==null?void 0:q.name)||"Aguardando análise"),1)],16)]}),_:2},1040)]),_:2},1032,["text"])])]),n("td",Wt,[n("div",Gt,[e(de,{text:"Editar Chamado"},{activator:t(({props:W})=>[e($,ne({icon:"",flat:"",onClick:q=>d.value=i},W),{default:t(()=>[e(l(Oe),{"stroke-width":"1.5",size:"20",class:"text-primary"})]),_:2},1040,["onClick"])]),_:2},1024),e(de,{text:"Deletar Chamado"},{activator:t(({props:W})=>[e($,ne({icon:"",flat:"",onClick:q=>O.value=i},W),{default:t(()=>[e(l(qe),{"stroke-width":"1.5",size:"20",class:"text-error"})]),_:2},1040,["onClick"])]),_:2},1024),e(de,{text:"Consultar Notas de Trabalho"},{activator:t(({props:W})=>[e($,ne({icon:"",flat:"",onClick:q=>c.$emit("openChat",i)},W),{default:t(()=>[e(l(ze),{"stroke-width":"1.5",size:"20",class:"text-primary"})]),_:2},1040,["onClick"])]),_:2},1024),e(de,{text:"Anexos"},{activator:t(({props:W})=>[e($,ne({icon:"",flat:"",onClick:q=>c.$emit("openAttachments",i)},W),{default:t(()=>[e(l(Je),{"stroke-width":"1.5",size:"20",class:"text-primary"})]),_:2},1040,["onClick"])]),_:2},1024)])])],4)}),128))])]),_:1}))}},Qt={emits:["cancel","add"],setup(s,{emit:o}){const a=Fe(),d=he();U([]);const O=[{label:"Grãos",value:1},{label:"Proteína",value:2}],P=[{label:"Algo que funcionava, parou de funcionar?",value:1},{label:"Fazer uma solicitação, algo novo (melhoria)?",value:2}],M=Y(()=>{var I;return((I=d.priori.find(m=>m.is_default))==null?void 0:I.id)||null}),u=Y(()=>{var I;return((I=d.taskStatus.find(m=>m.is_default))==null?void 0:I.id)||null}),{value:F}=f("segment",2),{value:V}=f("priority_id"),{value:A}=f("task_status_id");He(()=>{M.value&&!V.value&&(V.value=M.value),u.value&&!A.value&&(A.value=u.value)});const T=Y(()=>{const I=d.priori.find(m=>m.id===V.value);return I&&I.justify}),E=Y(()=>xe({segment:Z().required().label("Segmento"),task_type:Z().required().label("Tipo de chamado"),name:K().required().label("Título"),system_screen:K().required().label("Tela"),description:K().required().label("Descrição"),owner_id:Z().required().label("Solicitante"),task_status_id:Z().required().label("Status do Chamado"),priority_id:Z().required().label("Prioridade"),observation:K().nullable().label("Observação"),priority_justification:T.value?K().required().label("Justificativa da Prioridade"):K().label("Justificativa da Prioridade"),status:Ae().required().label("Status"),files:Ie().of(je()).nullable()})),{handleSubmit:J,errors:j,isSubmitting:B}=Ce({validationSchema:E,initialValues:{segment:1,task_type:"",name:"",system_screen:"",description:"",owner_id:a.user.id,responsible_id:"",task_status_id:u.value,priority_id:M.value,observation:"",created_at:"",expected_date:"",finish_date:"",priority_justification:"",status:!0,files:[]}}),R=J(async I=>{console.log("values",I);try{const m=L.value,S=await d.storeTask(I,m);o("add")}catch(m){console.error("Erro ao adicionar comentário ou fazer upload dos arquivos:",m)}}),w=U(""),{value:z}=f("name"),{value:g}=f("task_type"),{value:G}=f("system_screen"),{value:C}=f("description");f("owner_id"),f("responsible_id");const{value:b}=f("observation");f("created_at"),f("expected_date"),f("finish_date");const{value:_}=f("priority_justification");f("status");const{value:L}=f("files");return ue(M,I=>{I&&!V.value&&(V.value=I)}),ue(u,I=>{I&&!A.value&&(A.value=I)}),ue(V,()=>{T.value||(_.value="")}),(I,m)=>(y(),D("div",null,[w.value?(y(),ee(Pe,{key:0,color:"error",class:"mb-2"},{default:t(()=>[N(X(w.value),1)]),_:1})):me("",!0),e(we,{onSubmit:Re(l(R),["prevent"])},{default:t(()=>[e(ke,null,{default:t(()=>[e(x,null,{default:t(()=>[e(v,{cols:"12"},{default:t(()=>[e(H,{modelValue:l(F),"onUpdate:modelValue":m[0]||(m[0]=S=>k(F)?F.value=S:null),"error-messages":l(j).segment,items:O,label:"Segmento","item-title":"label","item-value":"value"},null,8,["modelValue","error-messages"])]),_:1})]),_:1}),e(x,null,{default:t(()=>[e(v,{cols:"12"},{default:t(()=>[e(H,{modelValue:l(g),"onUpdate:modelValue":m[1]||(m[1]=S=>k(g)?g.value=S:null),"error-messages":l(j).task_type,items:P,label:"Tipo de chamado","item-title":"label","item-value":"value"},null,8,["modelValue","error-messages"])]),_:1})]),_:1}),e(x,null,{default:t(()=>[e(v,{cols:"12"},{default:t(()=>[e(ae,{modelValue:l(z),"onUpdate:modelValue":m[2]||(m[2]=S=>k(z)?z.value=S:null),"error-messages":l(j).name,label:"Título",variant:"outlined",color:"primary"},null,8,["modelValue","error-messages"])]),_:1})]),_:1}),e(x,null,{default:t(()=>[e(v,{cols:"12"},{default:t(()=>[e(ae,{modelValue:l(G),"onUpdate:modelValue":m[3]||(m[3]=S=>k(G)?G.value=S:null),"error-messages":l(j).system_screen,label:"Tela",variant:"outlined",color:"primary"},null,8,["modelValue","error-messages"])]),_:1})]),_:1}),e(x,null,{default:t(()=>[e(v,{cols:"12"},{default:t(()=>[e(oe,{modelValue:l(C),"onUpdate:modelValue":m[4]||(m[4]=S=>k(C)?C.value=S:null),"error-messages":l(j).description,label:"Descrição",variant:"outlined",color:"primary",rows:"5"},null,8,["modelValue","error-messages"])]),_:1})]),_:1}),e(x,null,{default:t(()=>[e(v,{cols:"12"},{default:t(()=>[e(oe,{modelValue:l(b),"onUpdate:modelValue":m[5]||(m[5]=S=>k(b)?b.value=S:null),"error-messages":l(j).observation,label:"Observação",variant:"outlined",color:"primary",rows:"5"},null,8,["modelValue","error-messages"])]),_:1})]),_:1}),e(x,null,{default:t(()=>[e(v,{cols:"12",md:"12"},{default:t(()=>[e(H,{modelValue:l(V),"onUpdate:modelValue":m[6]||(m[6]=S=>k(V)?V.value=S:null),"error-messages":l(j).priority_id,items:l(d).priori,label:"Prioridade","item-title":"name","item-value":"id"},null,8,["modelValue","error-messages","items"])]),_:1})]),_:1}),l(T)?(y(),ee(x,{key:0},{default:t(()=>[e(v,{cols:"12"},{default:t(()=>[e(oe,{modelValue:l(_),"onUpdate:modelValue":m[7]||(m[7]=S=>k(_)?_.value=S:null),"error-messages":l(j).priority_justification,label:"Justificativa da Prioridade",variant:"outlined",color:"primary",rows:"5"},null,8,["modelValue","error-messages"])]),_:1})]),_:1})):me("",!0),e(x,null,{default:t(()=>[e(v,{cols:"12"},{default:t(()=>[e(Ee,{modelValue:l(L),"onUpdate:modelValue":m[8]||(m[8]=S=>k(L)?L.value=S:null),label:"Anexos do chamado",multiple:"","error-messages":l(j).files,"show-size":""},null,8,["modelValue","error-messages"])]),_:1})]),_:1}),e(x,{justify:"end"},{default:t(()=>[e(v,{cols:"12",md:"auto"},{default:t(()=>[e($,{flat:"",text:"Cancelar",onClick:m[9]||(m[9]=S=>o("cancel"))})]),_:1}),e(v,{cols:"12",md:"auto"},{default:t(()=>[e($,{type:"submit",color:"primary",flat:"",loading:l(B),text:"Adicionar"},null,8,["loading"])]),_:1})]),_:1})]),_:1})]),_:1},8,["onSubmit"])]))}},Kt={props:{task:{type:Object,required:!0}},emits:["cancel","edit"],setup(s,{emit:o}){const a=s,d=he(),O=[{label:"Grãos",value:1},{label:"Proteína",value:2}],P=[{label:"É uma melhoria ?",value:1},{label:"É algo novo ?",value:2}],{handleSubmit:M,errors:u,isSubmitting:F,setFieldValue:V,setErrors:A}=Ce({validationSchema:xe({segment:Z().required().label("Segmento"),task_type:Z().required().label("Tipo de chamado"),task_code:K().required().label("Número do chamado"),name:K().required().label("Título"),system_screen:K().required().label("Tela"),description:K().required().label("Descrição"),owner_id:Z().required().label("Solicitante"),responsible_id:Z().required().label("Responsável"),task_status_id:Z().required().label("Status do Chamado"),priority_id:Z().required().label("Prioridade do Chamado"),complexity_id:Z().required().label("Complexidade do Chamado"),observation:K().nullable().label("Observação"),created_at:be().nullable().label("Data de Criação"),expected_date:be().nullable().label("Data de Criação").transform((q,r)=>r===""?null:q),finish_date:be().nullable().label("Data de Conclusão").transform((q,r)=>r===""?null:q),priority_justification:K().nullable().label("Justificativa da Prioridade"),complexity_justification:K().nullable().label("Justificativa da Complexidade"),status:Ae().required().label("Status")}),initialValues:{segment:a.task.segment,task_type:a.task.task_type,task_code:a.task.task_code,name:a.task.name,description:a.task.description,owner_id:a.task.owner_id,responsible_id:a.task.responsible_id,task_status_id:a.task.task_status_id,system_screen:a.task.system_screen,observation:a.task.observation,priority_id:a.task.priority_id,complexity_id:a.task.complexity_id,priority_justification:a.task.priority_justification,complexity_justification:a.task.complexity_justification,finish_date:a.task.finish_date?a.task.finish_date.split("T")[0]:null,expected_date:a.task.expected_date?a.task.expected_date.split("T")[0]:null,created_at:a.task.created_at?a.task.created_at.split("T")[0]:null,status:a.task.status}}),T={complexityRef:U(null),complexityJustificationRef:U(null),responsibleRef:U(null)},E=()=>{u.responsible_id?Ve(()=>{T.responsibleRef.value.focus(),T.responsibleRef.value.$el.scrollIntoView({behavior:"smooth",block:"center"})}):u.complexity_id?Ve(()=>{T.complexityRef.value.focus(),T.complexityRef.value.$el.scrollIntoView({behavior:"smooth",block:"center"})}):u.complexity_justification&&Ve(()=>{T.complexityJustificationRef.value.focus(),T.complexityJustificationRef.value.$el.scrollIntoView({behavior:"smooth",block:"center"})})};ue(u,q=>{console.log(u),E()});const J=M(async q=>{W.value||delete q.priority_justification,h.value||(q.expected_date=null),i.value||(q.finish_date=null),console.log("Payload being sent to the backend:",q),await d.updateTask(a.task.id,q),o("edit")}),j=U(""),{value:B}=f("segment"),{value:R}=f("priority_id"),{value:w}=f("complexity_id"),{value:z}=f("name"),{value:g}=f("task_code"),{value:G}=f("task_type"),{value:C}=f("description"),{value:b}=f("owner_id"),{value:_}=f("responsible_id"),{value:L}=f("task_status_id"),{value:I}=f("system_screen"),{value:m}=f("observation"),{value:S}=f("priority_justification"),{value:c}=f("complexity_justification"),{value:h}=f("expected_date"),{value:i}=f("finish_date"),{value:te}=f("created_at"),{value:le}=f("status"),W=Y(()=>{const q=d.priori.find(r=>r.id===R.value);return q&&q.is_justify});return ue(R,q=>{W.value?V("priority_justification",S.value||""):(S.value="",A({priority_justification:void 0}))}),(q,r)=>(y(),D("div",null,[j.value?(y(),ee(Pe,{key:0,color:"error",class:"mb-2"},{default:t(()=>[N(X(j.value),1)]),_:1})):me("",!0),e(we,{onSubmit:Re(l(J),["prevent"])},{default:t(()=>[e(ke,null,{default:t(()=>[e(x,null,{default:t(()=>[e(v,{cols:"12"},{default:t(()=>[e(H,{modelValue:l(B),"onUpdate:modelValue":r[0]||(r[0]=p=>k(B)?B.value=p:null),"error-messages":l(u).segment,items:O,label:"Segmento","item-title":"label","item-value":"value"},null,8,["modelValue","error-messages"])]),_:1})]),_:1}),e(x,null,{default:t(()=>[e(v,{cols:"12"},{default:t(()=>[e(H,{modelValue:l(G),"onUpdate:modelValue":r[1]||(r[1]=p=>k(G)?G.value=p:null),"error-messages":l(u).task_type,items:P,label:"Tipo de chamado","item-title":"label","item-value":"value"},null,8,["modelValue","error-messages"])]),_:1})]),_:1}),e(x,null,{default:t(()=>[e(v,{cols:"12"},{default:t(()=>[e(ae,{modelValue:l(g),"onUpdate:modelValue":r[2]||(r[2]=p=>k(g)?g.value=p:null),"error-messages":l(u).task_code,label:"Número do chamado",variant:"outlined",color:"primary",disabled:""},null,8,["modelValue","error-messages"])]),_:1})]),_:1}),e(x,null,{default:t(()=>[e(v,{cols:"12"},{default:t(()=>[e(ae,{modelValue:l(z),"onUpdate:modelValue":r[3]||(r[3]=p=>k(z)?z.value=p:null),"error-messages":l(u).name,label:"Título",variant:"outlined",color:"primary"},null,8,["modelValue","error-messages"])]),_:1})]),_:1}),e(x,null,{default:t(()=>[e(v,{cols:"12"},{default:t(()=>[e(ae,{modelValue:l(I),"onUpdate:modelValue":r[4]||(r[4]=p=>k(I)?I.value=p:null),"error-messages":l(u).system_screen,label:"Tela",variant:"outlined",color:"primary"},null,8,["modelValue","error-messages"])]),_:1})]),_:1}),e(x,null,{default:t(()=>[e(v,{cols:"12"},{default:t(()=>[e(oe,{modelValue:l(C),"onUpdate:modelValue":r[5]||(r[5]=p=>k(C)?C.value=p:null),"error-messages":l(u).description,label:"Descrição",variant:"outlined",color:"primary",rows:"5"},null,8,["modelValue","error-messages"])]),_:1})]),_:1}),e(x,null,{default:t(()=>[e(v,{cols:"12",md:"6"},{default:t(()=>[e(H,{modelValue:l(b),"onUpdate:modelValue":r[6]||(r[6]=p=>k(b)?b.value=p:null),"error-messages":l(u).owner_id,items:l(d).users,label:"Solicitante","item-title":"first_name","item-value":"id",disabled:""},null,8,["modelValue","error-messages","items"])]),_:1}),e(v,{cols:"12",md:"6"},{default:t(()=>[e(ae,{modelValue:l(te),"onUpdate:modelValue":r[7]||(r[7]=p=>k(te)?te.value=p:null),"error-messages":l(u).created_at,label:"Data de Criação",variant:"outlined",type:"date",disabled:""},null,8,["modelValue","error-messages"])]),_:1})]),_:1}),e(x,null,{default:t(()=>[e(v,{cols:"12",md:"6"},{default:t(()=>[e(H,{modelValue:l(L),"onUpdate:modelValue":r[8]||(r[8]=p=>k(L)?L.value=p:null),"error-messages":l(u).task_status_id,items:l(d).taskStatus,label:"Status do Chamado","item-title":"name","item-value":"id"},null,8,["modelValue","error-messages","items"])]),_:1}),e(v,{cols:"12",md:"6"},{default:t(()=>[e(H,{modelValue:l(_),"onUpdate:modelValue":r[9]||(r[9]=p=>k(_)?_.value=p:null),"error-messages":l(u).responsible_id,items:l(d).users,label:"Responsável","item-title":"first_name","item-value":"id",ref:"responsibleRef"},null,8,["modelValue","error-messages","items"])]),_:1})]),_:1}),e(x,null,{default:t(()=>[e(v,{cols:"12"},{default:t(()=>[e(oe,{modelValue:l(m),"onUpdate:modelValue":r[10]||(r[10]=p=>k(m)?m.value=p:null),"error-messages":l(u).observation,label:"Observação",variant:"outlined",color:"primary",rows:"5"},null,8,["modelValue","error-messages"])]),_:1})]),_:1}),e(x,null,{default:t(()=>[e(v,{cols:"12",md:"6"},{default:t(()=>[e(ae,{modelValue:l(h),"onUpdate:modelValue":r[11]||(r[11]=p=>k(h)?h.value=p:null),"error-messages":l(u).expected_date,label:"Data Esperada",variant:"outlined",type:"date"},null,8,["modelValue","error-messages"])]),_:1}),e(v,{cols:"12",md:"6"},{default:t(()=>[e(ae,{modelValue:l(i),"onUpdate:modelValue":r[12]||(r[12]=p=>k(i)?i.value=p:null),"error-messages":l(u).finish_date,label:"Data de Conclusão",variant:"outlined",type:"date"},null,8,["modelValue","error-messages"])]),_:1})]),_:1}),e(x,null,{default:t(()=>[e(v,{cols:"12",md:"12"},{default:t(()=>[e(H,{modelValue:l(R),"onUpdate:modelValue":r[13]||(r[13]=p=>k(R)?R.value=p:null),"error-messages":l(u).priority_id,items:l(d).priori,label:"Prioridade","item-title":"name","item-value":"id"},null,8,["modelValue","error-messages","items"])]),_:1})]),_:1}),e(x,null,{default:t(()=>[e(v,{cols:"12"},{default:t(()=>[e(oe,{modelValue:l(S),"onUpdate:modelValue":r[14]||(r[14]=p=>k(S)?S.value=p:null),"error-messages":l(u).priority_justification,label:"Justificativa da Prioridade",variant:"outlined",color:"primary",rows:"5"},null,8,["modelValue","error-messages"])]),_:1})]),_:1}),e(x,null,{default:t(()=>[e(v,{cols:"12",md:"12"},{default:t(()=>[e(H,{modelValue:l(w),"onUpdate:modelValue":r[15]||(r[15]=p=>k(w)?w.value=p:null),"error-messages":l(u).complexity_id,items:l(d).complexity,label:"Complexidade do Chamado","item-title":"name","item-value":"id",ref:"complexityRef"},null,8,["modelValue","error-messages","items"])]),_:1})]),_:1}),e(x,null,{default:t(()=>[e(v,{cols:"12"},{default:t(()=>[e(oe,{modelValue:l(c),"onUpdate:modelValue":r[16]||(r[16]=p=>k(c)?c.value=p:null),"error-messages":l(u).complexity_justification,label:"Justificativa da Complexidade",variant:"outlined",color:"primary",rows:"5",ref:"complexityJustificationRef"},null,8,["modelValue","error-messages"])]),_:1})]),_:1}),e(x,null,{default:t(()=>[e(v,{cols:"12"},{default:t(()=>[e(Qe,{modelValue:l(le),"onUpdate:modelValue":r[17]||(r[17]=p=>k(le)?le.value=p:null),label:l(le)?"Ativo":"Inativo",color:"primary",inset:""},null,8,["modelValue","label"])]),_:1})]),_:1}),e(x,{justify:"end"},{default:t(()=>[e(v,{cols:"12",md:"auto"},{default:t(()=>[e($,{flat:"",text:"Cancelar",onClick:r[18]||(r[18]=p=>o("cancel"))})]),_:1}),e(v,{cols:"12",md:"auto"},{default:t(()=>[e($,{type:"submit",color:"primary",flat:"",loading:l(F),text:"Editar"},null,8,["loading"])]),_:1})]),_:1})]),_:1})]),_:1},8,["onSubmit"])]))}},De=Me("chats",{state:()=>({messages:[]}),actions:{async fetchMessages(s){try{const o=await Q.get(`/api/interactions/${s}`);this.messages=o.data}catch(o){console.error("Error fetching messages:",o)}},async createInteraction(s,o,a){try{return(await Q.post("/api/interactions",{task_id:s,comment:o,user_id:a})).data}catch(d){console.error("Error creating interaction:",d)}},async uploadFile(s){try{return(await Q.post("/api/interaction-file",s,{headers:{"Content-Type":"multipart/form-data"}})).data}catch(o){throw console.error("Error uploading file:",o),o}}}});function Ne(s){return`https://syscall-api.devtest.com.br//storage/${s}`}const Xt=n("span",{class:"text-h5"},"Notas de Trabalho",-1),Yt={key:0},Zt=["href"],el=N("Adicionar Comentário"),tl=N("Fechar"),ll=n("span",{class:"text-h5"},"Adicionar Comentário",-1),al=N("Cancelar"),sl=N("Adicionar"),Ue={props:{taskId:{type:Number,required:!0},showChatModal:{type:Boolean,required:!0},userId:{type:Number,required:!0}},emits:["update:showChatModal"],setup(s,{emit:o}){const a=s,d=De(),{messages:O}=_e(d),P=U(!1),M=U(!1),u=xe({comment:K().required().label("Comentário"),files:Ie().of(je()).nullable()}),{handleSubmit:F,errors:V,isSubmitting:A}=Ce({validationSchema:u,initialValues:{comment:"",files:[]}}),T=F(async R=>{try{const w=await d.createInteraction(a.taskId,R.comment,a.userId);if(R.files&&R.files.length>0){const z=new FormData;z.append("interaction_id",w.id);for(const g of R.files)z.append("files[]",g);await d.uploadFile(z)}await d.fetchMessages(a.taskId),M.value=!1,o("update:showChatModal",!1)}catch(w){console.error("Erro ao adicionar comentário ou fazer upload dos arquivos:",w)}}),{value:E}=f("comment"),{value:J}=f("files");ue(()=>a.showChatModal,async R=>{R?(P.value=!0,await d.fetchMessages(a.taskId)):P.value=!1});const j=()=>{o("update:showChatModal",!1)},B=()=>{M.value=!0};return(R,w)=>{const z=Ke("v-list-item-content");return y(),ee(re,{modelValue:P.value,"onUpdate:modelValue":w[4]||(w[4]=g=>P.value=g),"max-width":"800px"},{default:t(()=>[e(se,null,{default:t(()=>[e(ce,null,{default:t(()=>[Xt]),_:1}),e(ie,null,{default:t(()=>[e(ke,null,{default:t(()=>[e(x,null,{default:t(()=>[(y(!0),D(ve,null,ye(l(O),(g,G)=>(y(),ee(v,{key:G,cols:"12"},{default:t(()=>[e(se,{class:"mb-3"},{default:t(()=>[e(ie,null,{default:t(()=>[N(X(g.comment)+" ",1),g.interaction_files&&g.interaction_files.length?(y(),D("div",Yt,[e(Xe),e(Ye,null,{default:t(()=>[(y(!0),D(ve,null,ye(g.interaction_files,(C,b)=>(y(),ee(Ze,{key:b},{default:t(()=>[e(z,null,{default:t(()=>[e(et,null,{default:t(()=>[n("a",{href:l(Ne)(C.path),target:"_blank"},X(C.name),9,Zt)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:2},1024)])):me("",!0)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})]),_:1}),e(ge,null,{default:t(()=>[e($,{color:"primary",onClick:B},{default:t(()=>[el]),_:1}),e($,{color:"secondary",onClick:j},{default:t(()=>[tl]),_:1})]),_:1})]),_:1}),e(re,{modelValue:M.value,"onUpdate:modelValue":w[3]||(w[3]=g=>M.value=g),"max-width":"500px"},{default:t(()=>[e(se,null,{default:t(()=>[e(ce,null,{default:t(()=>[ll]),_:1}),e(ie,null,{default:t(()=>[e(we,{onSubmit:l(T)},{default:t(()=>[e(oe,{modelValue:l(E),"onUpdate:modelValue":w[0]||(w[0]=g=>k(E)?E.value=g:null),label:"Comentário","error-messages":l(V).comment},null,8,["modelValue","error-messages"]),e(Ee,{modelValue:l(J),"onUpdate:modelValue":w[1]||(w[1]=g=>k(J)?J.value=g:null),label:"Selecionar Arquivos","error-messages":l(V).files,"show-size":"",multiple:""},null,8,["modelValue","error-messages"])]),_:1},8,["onSubmit"])]),_:1}),e(ge,null,{default:t(()=>[e($,{color:"blue darken-1",text:"",onClick:w[2]||(w[2]=g=>M.value=!1)},{default:t(()=>[al]),_:1}),e($,{color:"blue darken-1",text:"",loading:l(A),onClick:l(T)},{default:t(()=>[sl]),_:1},8,["loading","onClick"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1},8,["modelValue"])}}},ol=n("span",{class:"text-h5"},"Anexos do Chamado",-1),il=["href"],nl=N("Fechar"),rl={props:{taskId:{type:Number,required:!0},showAttachmentsModal:{type:Boolean,required:!0}},emits:["update:showAttachmentsModal"],setup(s,{emit:o}){const a=s,d=he(),{taskFiles:O}=_e(d),P=U(!1);ue(()=>a.showAttachmentsModal,async F=>{F?(await d.getTaskFiles(a.taskId),P.value=!0):P.value=!1});const M=()=>{o("update:showAttachmentsModal",!1)},u=async F=>{await d.deleteTaskFile(F),await d.getTaskFiles(a.taskId)};return(F,V)=>(y(),ee(re,{modelValue:P.value,"onUpdate:modelValue":V[0]||(V[0]=A=>P.value=A),"max-width":"800px"},{default:t(()=>[e(se,null,{default:t(()=>[e(ce,null,{default:t(()=>[ol]),_:1}),e(ie,null,{default:t(()=>[e(ke,null,{default:t(()=>[e(x,null,{default:t(()=>[(y(!0),D(ve,null,ye(l(O),(A,T)=>(y(),ee(v,{key:T,cols:"12"},{default:t(()=>[e(se,{class:"mb-3"},{default:t(()=>[e(ie,null,{default:t(()=>[n("a",{href:l(Ne)(A.path),target:"_blank"},X(A.name),9,il),e($,{icon:"",onClick:E=>u(A.id)},{default:t(()=>[e(l(Be))]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})]),_:1}),e(ge,null,{default:t(()=>[e($,{color:"secondary",onClick:M},{default:t(()=>[nl]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]))}},ul={class:"mb-5 pb-5 border-b border-opacity-100"},dl=N("Novo Chamado"),cl=N("Adicionar chamado"),ml=N("Editar chamado"),pl=N("Cancelar"),fl=N("Deletar"),_l=n("span",{class:"text-h5"},"Adicionar Nota de Trabalho",-1),vl=N("Cancelar"),hl=N("Adicionar"),bl={setup(s){const o=Fe(),a=he(),{toEdit:d,toDelete:O}=_e(a),P=De();_e(P);const{isLoading:M}=fe(a.getTasks());fe(a.getPriorities()),fe(a.getComplexities()),fe(a.getTasksStatus()),fe(a.getUsers());const u=Y({get(){return!!Object.keys(d.value).length},set(C){C||(d.value={})}}),F=Y({get(){return!!Object.keys(O.value).length},set(C){C||(O.value={})}}),V=U(!1);async function A(C){V.value=!0,await a.deleteTask(C.id),O.value={},V.value=!1}const T=U(!1),E=U(null),J=U(!1),j=U(""),B=U(o.user.id),R=C=>{E.value=C.id,T.value=!0},w=C=>{E.value=C.id,J.value=!0},z=async()=>{await P.addMessage(E.value,j.value,B.value),j.value="",J.value=!1},g=U(!1),G=C=>{E.value=C.id,g.value=!0};return(C,b)=>(y(),D("div",null,[n("div",ul,[e(x,null,{default:t(()=>[e(v,{cols:"12",lg:"4",md:"6"},{default:t(()=>[e(ae,{density:"compact",modelValue:C.search,"onUpdate:modelValue":b[0]||(b[0]=_=>C.search=_),label:"Search Contacts","append-inner-icon":"mdi-magnify","hide-details":"",variant:"outlined"},null,8,["modelValue"])]),_:1}),e(v,{class:"text-right"},{default:t(()=>[e(re,{width:"auto"},{activator:t(({props:_})=>[e($,ne({flat:"",color:"primary"},_),{default:t(()=>[dl]),_:2},1040)]),default:t(({isActive:_})=>[e(se,{width:"400"},{default:t(()=>[e(ce,null,{default:t(()=>[cl]),_:1}),e(ie,null,{default:t(()=>[e(Qt,{onAdd:L=>_.value=!1,onCancel:L=>_.value=!1},null,8,["onAdd","onCancel"])]),_:2},1024)]),_:2},1024)]),_:1})]),_:1})]),_:1})]),l(M)?(y(),ee(lt,{key:0,width:3,color:"primary",indeterminate:""})):(y(),D(ve,{key:1},[e(Ht,{onOpenChat:R,onAddNote:w,onOpenAttachments:G}),e(re,{modelValue:l(u),"onUpdate:modelValue":b[1]||(b[1]=_=>k(u)?u.value=_:null),width:"auto"},{default:t(({isActive:_})=>[e(se,{width:"400"},{default:t(()=>[e(ce,null,{default:t(()=>[ml]),_:1}),e(ie,null,{default:t(()=>[e(Kt,{task:l(d),onCancel:L=>_.value=!1,onEdit:L=>_.value=!1},null,8,["task","onCancel","onEdit"])]),_:2},1024)]),_:2},1024)]),_:1},8,["modelValue"]),e(re,{modelValue:l(F),"onUpdate:modelValue":b[3]||(b[3]=_=>k(F)?F.value=_:null),width:"auto"},{default:t(({isActive:_})=>[e(se,{"prepend-icon":l(qe),title:"Você tem certeza que deseja deletar este chamado?"},{actions:t(()=>[e(tt),e($,{onClick:L=>_.value=!1},{default:t(()=>[pl]),_:2},1032,["onClick"]),e($,{onClick:b[2]||(b[2]=L=>A(l(O))),variant:"tonal",color:"error",loading:V.value},{default:t(()=>[fl]),_:1},8,["loading"])]),_:2},1032,["prepend-icon"])]),_:1},8,["modelValue"])],64)),e(Ue,{taskId:E.value,showChatModal:T.value,userId:B.value,"onUpdate:showChatModal":b[4]||(b[4]=_=>T.value=_)},null,8,["taskId","showChatModal","userId"]),e(re,{modelValue:J.value,"onUpdate:modelValue":b[7]||(b[7]=_=>J.value=_),"max-width":"500px"},{default:t(()=>[e(se,null,{default:t(()=>[e(ce,null,{default:t(()=>[_l]),_:1}),e(ie,null,{default:t(()=>[e(Ue,{taskId:E.value,showChatModal:T.value,userId:B.value,"onUpdate:showChatModal":b[5]||(b[5]=_=>T.value=_)},null,8,["taskId","showChatModal","userId"])]),_:1}),e(ge,null,{default:t(()=>[e($,{color:"blue darken-1",text:"",onClick:b[6]||(b[6]=_=>J.value=!1)},{default:t(()=>[vl]),_:1}),e($,{color:"blue darken-1",text:"",onClick:z},{default:t(()=>[hl]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(rl,{taskId:E.value,showAttachmentsModal:g.value,"onUpdate:showAttachmentsModal":b[8]||(b[8]=_=>g.value=_)},null,8,["taskId","showAttachmentsModal"])]))}};export{bl as default};
