import{F as Se,E as hl,i as xl,j as ol,N as kl,k as wl,l as Cl,m as Sl}from"./vue-tabler-icons.es-74382ebb.js";import{u as ze,at as sl,I as Ul,ac as Te,B as Z,J as i,K as Je,U as re,o as V,c as z,a as r,b as e,w as l,e as le,d as F,t as Q,au as De,l as de,V as j,y as t,aa as L,m as ke,av as Ue,P as we,F as qe,q as je,i as $l,aw as Tl,z as _e,S as el,T as ll,p as ve,ax as tl,af as ql,N as Be,O as Le,ag as Ge,ay as ue,ah as oe,aq as nl,az as ul,aA as il,ai as dl,a3 as Ae,ab as x,a1 as u,ak as C,aj as ee,aB as ie,aC as rl,W as He,al as Ke,aD as Re,ar as ml,aE as Ee,ad as Al,ae as Oe,r as Il,a9 as ge,ao as pe,a7 as me,G as Ml,j as jl,aF as Fe,an as be,am as $e,aG as Fl,aH as Ne,X as Pl,ap as Dl}from"./index-aa79366d.js";import{u as Ce}from"./tasks-80d01680.js";import{_ as We}from"./_plugin-vue_export-helper-c27b6911.js";import{a as g,u as Xe}from"./vee-validate.esm-1181447b.js";function Rl(S,q){const s=["Chamado","Sequência","Título","Solicitante","Responsável","Status","Prioridade","Complexidade"],m=S.map(d=>{var J,U,$,T,P;return[d.task_code,d.sequence,d.name,(J=d.user_owner)==null?void 0:J.first_name,((U=d.user_responsible)==null?void 0:U.first_name)||"Nenhum responsável",($=d.task_status)==null?void 0:$.name,(T=d.priority)==null?void 0:T.name,((P=d.complexity)==null?void 0:P.name)||"Aguardando análise"]}),R=[s,...m].map(d=>d.join(",")).join(`
`),E=new Blob([R],{type:"text/csv;charset=utf-8;"}),A=document.createElement("a");A.href=URL.createObjectURL(E),A.setAttribute("download",q),document.body.appendChild(A),A.click(),document.body.removeChild(A)}const he=S=>(Be("data-v-d26ec618"),S=S(),Le(),S),El={class:"tasks-table-container"},Ol={class:"table-wrapper"},Nl=F(" Chamado "),zl=F(" Sequência "),Jl=F(" Título "),Bl={class:"text-left",style:{width:"175px"}},Ll=F(" Solicitante "),Gl={class:"text-left",style:{width:"185px"}},Hl=F(" Responsável "),Kl={class:"text-left",style:{width:"135px"}},Wl=F(" Status "),Xl={class:"text-left",style:{width:"165px"}},Ql=F(" Prioridade "),Yl={class:"text-left",style:{width:"235px"}},Zl=F(" Complexidade "),et=he(()=>r("th",{class:"text-left",style:{width:"100px"}},"Ações",-1)),lt=he(()=>r("th",null,null,-1)),tt={key:0},at=he(()=>r("td",null,null,-1)),ot=he(()=>r("td",null,null,-1)),st=he(()=>r("td",null,null,-1)),nt={key:0},ut={key:1},it={key:2},dt={key:3},rt={key:4},mt={key:5},ct={key:6},vt={key:7},pt={key:8},ft={key:9},_t=he(()=>r("td",null,null,-1)),bt=he(()=>r("td",null,null,-1)),yt={class:"text-clamp"},Vt=F("Default"),gt={class:"text-clamp"},ht={class:"text-clamp"},xt={class:"text-right"},kt={class:"d-flex align-center"},wt={class:"text-clamp"},Ct={class:"text-right"},St={class:"d-flex align-center"},Ut={class:"text-clamp"},$t={class:"text-right"},Tt={class:"d-flex align-center"},qt={setup(S){const q=ze(),s=Ce(),m=sl();Ul();const{tasks:R,toShow:E,toEdit:A,toDelete:d,taskFiles:J}=Te(s),U=Z(()=>q.user.teams.some(b=>b.is_admin)),$=i([]),T=i([]),P=i([]),H=i([]),w=i([]),O=i(!1),N=i(!1),K=i(!1),G=i(!1),M=i(!1),k=Z(()=>[...new Set(R.value.map(b=>b.task_status.name))]),B=Z(()=>[...new Set(R.value.map(b=>b.user_owner.first_name))]),h=Z(()=>[...new Set(R.value.map(b=>{var v;return((v=b.user_responsible)==null?void 0:v.first_name)||"Nenhum responsável"}))]),W=Z(()=>[...new Set(R.value.map(b=>b.priority.name))]),D=Z(()=>[...new Set(R.value.map(b=>{var v;return((v=b.complexity)==null?void 0:v.name)||"Em análise"}))]),_=i(!1),a=i(!1),n=i(!1),se=i(!1),te=i(!1),ce=()=>{_.value=$.value.length===k.value.length},y=()=>{a.value=T.value.length===B.value.length},I=()=>{n.value=P.value.length===h.value.length},p=()=>{se.value=H.value.length===W.value.length},ae=()=>{te.value=w.value.length===D.value.length},Y=()=>{_.value?$.value=[]:$.value=[...k.value]},c=()=>{a.value?T.value=[]:T.value=[...B.value]},f=()=>{n.value?P.value=[]:P.value=[...h.value]},_l=()=>{se.value?H.value=[]:H.value=[...W.value]},bl=()=>{te.value?w.value=[]:w.value=[...D.value]},ye=i(""),fe=i("asc"),Pe=b=>{ye.value===b?fe.value=fe.value==="asc"?"desc":"asc":(ye.value=b,fe.value="asc")},yl=Z(()=>{const b=[...R.value];return b.sort((v,o)=>{const xe=v[ye.value],Ve=o[ye.value];return xe<Ve?fe.value==="asc"?-1:1:xe>Ve?fe.value==="asc"?1:-1:0}),b}),Qe=Z(()=>R.value?yl.value.filter(b=>{var X,ne,Ye,Ze;if(!b)return!1;const v=$.value.length===0||$.value.includes(b.task_status.name),o=T.value.length===0||T.value.includes(b.user_owner.first_name),xe=P.value.length===0||P.value.includes(((X=b.user_responsible)==null?void 0:X.first_name)||"Nenhum responsável"),Ve=H.value.length===0||H.value.includes(b.priority.name),Ie=w.value.length===0||w.value.includes(((ne=b.complexity)==null?void 0:ne.name)||"Em análise"),Me=((Ye=q.user)==null?void 0:Ye.default_segment)==0||b.segment==((Ze=q.user)==null?void 0:Ze.default_segment);return v&&o&&xe&&Ve&&Ie&&Me}):[]),Vl=b=>({color:b.color});Je(()=>{const b=m.query.search||"";b&&s.getTasks(b)}),re(()=>m.query.search,b=>{const v=b||"";s.getTasks(v)});const gl=()=>{Rl(Qe.value,"tasks.csv")};return(b,v)=>(V(),z("div",El,[r("div",Ol,[e(ql,{class:"border-opacity-100"},{default:l(()=>[r("thead",null,[r("tr",null,[r("th",{class:"text-left",style:{width:"50px"},onClick:v[0]||(v[0]=o=>Pe("task_code"))},[Nl,ye.value==="task_code"?(V(),le(De,{key:0},{default:l(()=>[F(Q(fe.value==="asc"?"mdi-arrow-up":"mdi-arrow-down"),1)]),_:1})):de("",!0)]),r("th",{class:"text-left",style:{width:"50px"},onClick:v[1]||(v[1]=o=>Pe("sequence"))},[zl,ye.value==="sequence"?(V(),le(De,{key:0},{default:l(()=>[F(Q(fe.value==="asc"?"mdi-arrow-up":"mdi-arrow-down"),1)]),_:1})):de("",!0)]),r("th",{class:"text-left",style:{width:"250px"},onClick:v[2]||(v[2]=o=>Pe("name"))},[Jl,ye.value==="name"?(V(),le(De,{key:0},{default:l(()=>[F(Q(fe.value==="asc"?"mdi-arrow-up":"mdi-arrow-down"),1)]),_:1})):de("",!0)]),r("th",Bl,[Ll,e(j,{icon:"",onClick:v[3]||(v[3]=o=>N.value=!N.value)},{default:l(()=>[e(t(Se))]),_:1})]),r("th",Gl,[Hl,e(j,{icon:"",onClick:v[4]||(v[4]=o=>K.value=!K.value)},{default:l(()=>[e(t(Se))]),_:1})]),r("th",Kl,[Wl,e(j,{icon:"",onClick:v[5]||(v[5]=o=>O.value=!O.value)},{default:l(()=>[e(t(Se))]),_:1})]),r("th",Xl,[Ql,e(j,{icon:"",onClick:v[6]||(v[6]=o=>G.value=!G.value)},{default:l(()=>[e(t(Se))]),_:1})]),r("th",Yl,[Zl,e(j,{icon:"",onClick:v[7]||(v[7]=o=>M.value=!M.value)},{default:l(()=>[e(t(Se))]),_:1})]),et,lt])]),r("tbody",null,[N.value||K.value||O.value||G.value||M.value?(V(),z("tr",tt,[at,ot,st,N.value?(V(),z("td",nt,[e(L,{modelValue:T.value,"onUpdate:modelValue":v[9]||(v[9]=o=>T.value=o),items:t(B),label:"Filtro Solicitante",multiple:"",onChange:y},{"prepend-item":l(()=>[e(ke,null,{default:l(()=>[e(Ue,{modelValue:a.value,"onUpdate:modelValue":v[8]||(v[8]=o=>a.value=o),label:a.value?"Desmarcar todos":"Selecionar todos",onChange:c},null,8,["modelValue","label"])]),_:1}),e(we)]),_:1},8,["modelValue","items"])])):(V(),z("td",ut)),K.value?(V(),z("td",it,[e(L,{modelValue:P.value,"onUpdate:modelValue":v[11]||(v[11]=o=>P.value=o),items:t(h),label:"Filtro Responsável",multiple:"",onChange:I},{"prepend-item":l(()=>[e(ke,null,{default:l(()=>[e(Ue,{modelValue:n.value,"onUpdate:modelValue":v[10]||(v[10]=o=>n.value=o),label:n.value?"Desmarcar todos":"Selecionar todos",onChange:f},null,8,["modelValue","label"])]),_:1}),e(we)]),_:1},8,["modelValue","items"])])):(V(),z("td",dt)),O.value?(V(),z("td",rt,[e(L,{modelValue:$.value,"onUpdate:modelValue":v[13]||(v[13]=o=>$.value=o),items:t(k),label:"Filtro Status",multiple:"",onChange:ce},{"prepend-item":l(()=>[e(ke,null,{default:l(()=>[e(Ue,{modelValue:_.value,"onUpdate:modelValue":v[12]||(v[12]=o=>_.value=o),label:_.value?"Desmarcar todos":"Selecionar todos",onChange:Y},null,8,["modelValue","label"])]),_:1}),e(we)]),_:1},8,["modelValue","items"])])):(V(),z("td",mt)),G.value?(V(),z("td",ct,[e(L,{modelValue:H.value,"onUpdate:modelValue":v[15]||(v[15]=o=>H.value=o),items:t(W),label:"Filtro Prioridade",multiple:"",onChange:p},{"prepend-item":l(()=>[e(ke,null,{default:l(()=>[e(Ue,{modelValue:se.value,"onUpdate:modelValue":v[14]||(v[14]=o=>se.value=o),label:se.value?"Desmarcar todos":"Selecionar todos",onChange:_l},null,8,["modelValue","label"])]),_:1}),e(we)]),_:1},8,["modelValue","items"])])):(V(),z("td",vt)),M.value?(V(),z("td",pt,[e(L,{modelValue:w.value,"onUpdate:modelValue":v[17]||(v[17]=o=>w.value=o),items:t(D),label:"Filtro Complexidade",multiple:"",onChange:ae},{"prepend-item":l(()=>[e(ke,null,{default:l(()=>[e(Ue,{modelValue:te.value,"onUpdate:modelValue":v[16]||(v[16]=o=>te.value=o),label:te.value?"Desmarcar todos":"Selecionar todos",onChange:bl},null,8,["modelValue","label"])]),_:1}),e(we)]),_:1},8,["modelValue","items"])])):(V(),z("td",ft)),_t,bt])):de("",!0),(V(!0),z(qe,null,je(t(Qe),(o,xe)=>{var Ve,Ie,Me;return V(),z("tr",{key:(o==null?void 0:o.id)||xe},[r("td",null,Q(o==null?void 0:o.task_code),1),r("td",null,Q(o==null?void 0:o.sequence),1),r("td",null,[r("div",yt,Q(o==null?void 0:o.name),1),o!=null&&o.default?(V(),le($l,{key:0,size:"small",variant:"tonal",color:"primary",class:"ml-2"},{default:l(()=>[Vt]),_:1})):de("",!0)]),r("td",null,[r("div",gt,Q((Ve=o==null?void 0:o.user_owner)==null?void 0:Ve.first_name),1)]),r("td",null,[r("div",ht,Q(((Ie=o==null?void 0:o.user_responsible)==null?void 0:Ie.first_name)||"Nenhum responsável"),1)]),r("td",null,[r("div",{class:"text-clamp",style:Tl(Vl(o==null?void 0:o.task_status))},Q((Me=o==null?void 0:o.task_status)==null?void 0:Me.name),5)]),r("td",xt,[r("div",kt,[e(_e,{text:o==null?void 0:o.priority_justification},{activator:l(({props:X})=>[e(j,el(ll(X)),{default:l(()=>{var ne;return[r("span",ve(b.attrs,tl(b.on)),[r("div",wt,Q((ne=o==null?void 0:o.priority)==null?void 0:ne.name),1)],16)]}),_:2},1040)]),_:2},1032,["text"])])]),r("td",Ct,[r("div",St,[e(_e,{text:(o==null?void 0:o.complexity_justification)||"Em análise"},{activator:l(({props:X})=>[e(j,el(ll(X)),{default:l(()=>{var ne;return[r("span",ve(b.attrs,tl(b.on)),[r("div",Ut,Q(((ne=o==null?void 0:o.complexity)==null?void 0:ne.name)||"Em análise"),1)],16)]}),_:2},1040)]),_:2},1032,["text"])])]),r("td",$t,[r("div",Tt,[e(_e,{text:"Visualizar Chamado"},{activator:l(({props:X})=>[e(j,ve({icon:"",flat:"",onClick:ne=>E.value=o},X),{default:l(()=>[e(t(hl),{"stroke-width":"1.5",size:"20",class:"text-primary"})]),_:2},1040,["onClick"])]),_:2},1024),t(U)?(V(),le(_e,{key:0,text:"Editar Chamado"},{activator:l(({props:X})=>[e(j,ve({icon:"",flat:"",onClick:ne=>A.value=o},X),{default:l(()=>[e(t(xl),{"stroke-width":"1.5",size:"20",class:"text-primary"})]),_:2},1040,["onClick"])]),_:2},1024)):de("",!0),t(U)?(V(),le(_e,{key:1,text:"Deletar Chamado"},{activator:l(({props:X})=>[e(j,ve({icon:"",flat:"",onClick:ne=>d.value=o},X),{default:l(()=>[e(t(ol),{"stroke-width":"1.5",size:"20",class:"text-error"})]),_:2},1040,["onClick"])]),_:2},1024)):de("",!0),e(_e,{text:"Consultar Notas de Trabalho"},{activator:l(({props:X})=>[e(j,ve({icon:"",flat:"",onClick:ne=>b.$emit("openChat",o)},X),{default:l(()=>[e(t(kl),{"stroke-width":"1.5",size:"20",class:"text-primary"})]),_:2},1040,["onClick"])]),_:2},1024),e(_e,{text:"Anexos"},{activator:l(({props:X})=>[e(j,ve({icon:"",flat:"",onClick:ne=>b.$emit("openAttachments",o)},X),{default:l(()=>[e(t(wl),{"stroke-width":"1.5",size:"20",class:"text-primary"})]),_:2},1040,["onClick"])]),_:2},1024),e(_e,{text:"Exportar CSV"},{activator:l(({props:X})=>[e(j,ve({icon:"",flat:"",onClick:gl},X),{default:l(()=>[e(t(Cl),{"stroke-width":"1.5",size:"20",class:"text-primary"})]),_:2},1040)]),_:1})])])])}),128))])]),_:1})])]))}},At=We(qt,[["__scopeId","data-v-d26ec618"]]),It={emits:["cancel","add"],setup(S,{emit:q}){const s=ze(),m=Ce();i([]);const R=[{label:"Grãos",value:1},{label:"Proteína",value:2}],E=[{label:"Algo que funcionava, parou de funcionar?",value:1},{label:"Fazer uma solicitação, algo novo (melhoria)?",value:2}],A=Z(()=>{var _;return((_=m.priori.find(a=>a.is_default))==null?void 0:_.id)||null}),d=Z(()=>{var _;return((_=m.taskStatus.find(a=>a.is_default))==null?void 0:_.id)||null}),{value:J}=g("segment",2),{value:U}=g("priority_id"),{value:$}=g("task_status_id");Je(()=>{A.value&&!U.value&&(U.value=A.value),d.value&&!$.value&&($.value=d.value)});const T=Z(()=>{const _=m.priori.find(a=>a.id===U.value);return _&&_.justify}),P=Z(()=>Ge({segment:ue().required().label("Segmento"),task_type:ue().required().label("Tipo de chamado"),name:oe().required().label("Título"),system_screen:oe().required().label("Tela"),description:oe().required().label("Descrição"),owner_id:ue().required().label("Solicitante"),task_status_id:ue().required().label("Status do Chamado"),priority_id:ue().required().label("Prioridade"),observation:oe().nullable().label("Observação"),priority_justification:T.value?oe().required().label("Justificativa da Prioridade"):oe().label("Justificativa da Prioridade"),status:nl().required().label("Status"),files:ul().of(il()).nullable()})),{handleSubmit:H,errors:w,isSubmitting:O}=Xe({validationSchema:P,initialValues:{segment:1,task_type:"",name:"",system_screen:"",description:"",owner_id:s.user.id,responsible_id:"",task_status_id:d.value,priority_id:A.value,observation:"",created_at:"",expected_date:"",finish_date:"",priority_justification:"",status:!0,files:[]}}),N=H(async _=>{console.log("priority_id at submit:",U.value),console.log("values before sending:",_),_.priority_id=U.value,_.segment=J.value;try{const a=D.value,n=await m.storeTask(_,a);q("add")}catch(a){console.error("Erro ao adicionar comentário ou fazer upload dos arquivos:",a)}}),K=i(""),{value:G}=g("name"),{value:M}=g("task_type"),{value:k}=g("system_screen"),{value:B}=g("description");g("owner_id"),g("responsible_id");const{value:h}=g("observation");g("created_at"),g("expected_date"),g("finish_date");const{value:W}=g("priority_justification");g("status");const{value:D}=g("files");return re(A,_=>{_&&!U.value&&(U.value=_)}),re(d,_=>{_&&!$.value&&($.value=_)}),re(U,_=>{console.log("priority_id changed to:",_),T.value||(W.value="")}),(_,a)=>(V(),z("div",null,[K.value?(V(),le(dl,{key:0,color:"error",class:"mb-2"},{default:l(()=>[F(Q(K.value),1)]),_:1})):de("",!0),e(Ke,{onSubmit:He(t(N),["prevent"])},{default:l(()=>[e(Ae,null,{default:l(()=>[e(x,null,{default:l(()=>[e(u,{cols:"6"},{default:l(()=>[e(L,{modelValue:t(J),"onUpdate:modelValue":a[0]||(a[0]=n=>C(J)?J.value=n:null),"error-messages":t(w).segment,items:R,label:"Segmento","item-title":"label","item-value":"value"},null,8,["modelValue","error-messages"])]),_:1}),e(u,{cols:"6"},{default:l(()=>[e(L,{modelValue:t(M),"onUpdate:modelValue":a[1]||(a[1]=n=>C(M)?M.value=n:null),"error-messages":t(w).task_type,items:E,label:"Tipo de chamado","item-title":"label","item-value":"value"},null,8,["modelValue","error-messages"])]),_:1})]),_:1}),e(x,null,{default:l(()=>[e(u,{cols:"12"},{default:l(()=>[e(ee,{modelValue:t(G),"onUpdate:modelValue":a[2]||(a[2]=n=>C(G)?G.value=n:null),"error-messages":t(w).name,label:"Título",variant:"outlined",color:"primary",maxlength:"60",counter:""},null,8,["modelValue","error-messages"])]),_:1})]),_:1}),e(x,null,{default:l(()=>[e(u,{cols:"12"},{default:l(()=>[e(ee,{modelValue:t(k),"onUpdate:modelValue":a[3]||(a[3]=n=>C(k)?k.value=n:null),"error-messages":t(w).system_screen,label:"Tela",variant:"outlined",color:"primary",maxlength:"60",counter:""},null,8,["modelValue","error-messages"])]),_:1})]),_:1}),e(x,null,{default:l(()=>[e(u,{cols:"12"},{default:l(()=>[e(ie,{modelValue:t(B),"onUpdate:modelValue":a[4]||(a[4]=n=>C(B)?B.value=n:null),"error-messages":t(w).description,label:"Descrição",variant:"outlined",color:"primary",rows:"5",maxlength:"500",counter:""},null,8,["modelValue","error-messages"])]),_:1})]),_:1}),e(x,null,{default:l(()=>[e(u,{cols:"12"},{default:l(()=>[e(ie,{modelValue:t(h),"onUpdate:modelValue":a[5]||(a[5]=n=>C(h)?h.value=n:null),"error-messages":t(w).observation,label:"Observação",variant:"outlined",color:"primary",rows:"5",maxlength:"500",counter:""},null,8,["modelValue","error-messages"])]),_:1})]),_:1}),e(x,null,{default:l(()=>[e(u,{cols:"12",md:"12"},{default:l(()=>[e(L,{modelValue:t(U),"onUpdate:modelValue":a[6]||(a[6]=n=>C(U)?U.value=n:null),"error-messages":t(w).priority_id,items:t(m).priori,label:"Prioridade","item-title":"name","item-value":"id"},null,8,["modelValue","error-messages","items"])]),_:1})]),_:1}),t(T)?(V(),le(x,{key:0},{default:l(()=>[e(u,{cols:"12"},{default:l(()=>[e(ie,{modelValue:t(W),"onUpdate:modelValue":a[7]||(a[7]=n=>C(W)?W.value=n:null),"error-messages":t(w).priority_justification,label:"Justificativa da Prioridade",variant:"outlined",color:"primary",rows:"5",maxlength:"500",counter:""},null,8,["modelValue","error-messages"])]),_:1})]),_:1})):de("",!0),e(x,null,{default:l(()=>[e(u,{cols:"12"},{default:l(()=>[e(rl,{modelValue:t(D),"onUpdate:modelValue":a[8]||(a[8]=n=>C(D)?D.value=n:null),label:"Anexos do chamado",multiple:"","error-messages":t(w).files,"show-size":""},null,8,["modelValue","error-messages"])]),_:1})]),_:1}),e(x,{justify:"end"},{default:l(()=>[e(u,{cols:"12",md:"auto"},{default:l(()=>[e(j,{flat:"",text:"Cancelar",onClick:a[9]||(a[9]=n=>q("cancel"))})]),_:1}),e(u,{cols:"12",md:"auto"},{default:l(()=>[e(j,{type:"submit",color:"primary",flat:"",loading:t(O),text:"Adicionar"},null,8,["loading"])]),_:1})]),_:1})]),_:1})]),_:1},8,["onSubmit"])]))}},Mt={props:{task:{type:Object,required:!0}},emits:["cancel","edit"],setup(S,{emit:q}){const s=S,m=Ce(),R=[{label:"Grãos",value:1},{label:"Proteína",value:2}],E=[{label:"Algo que funcionava, parou de funcionar?",value:1},{label:"Fazer uma solicitação, algo novo (melhoria)?",value:2}],{handleSubmit:A,errors:d,isSubmitting:J,setFieldValue:U,setErrors:$}=Xe({validationSchema:Ge({segment:ue().required().label("Segmento"),task_type:ue().required().label("Tipo de chamado"),task_code:oe().required().label("Número do chamado"),name:oe().required().label("Título"),system_screen:oe().required().label("Tela"),sequence:ue().nullable().label("Sequência"),description:oe().required().label("Descrição"),owner_id:ue().required().label("Solicitante"),responsible_id:ue().required().label("Responsável"),task_status_id:ue().required().label("Status do Chamado"),priority_id:ue().required().label("Prioridade do Chamado"),complexity_id:ue().required().label("Complexidade do Chamado"),observation:oe().nullable().label("Observação"),created_at:Re().nullable().label("Data de Criação"),expected_date:Re().nullable().label("Data de Criação").transform((Y,c)=>c===""?null:Y),finish_date:Re().nullable().label("Data de Conclusão").transform((Y,c)=>c===""?null:Y),priority_justification:oe().nullable().label("Justificativa da Prioridade"),complexity_justification:oe().nullable().label("Justificativa da Complexidade"),status:nl().required().label("Status")}),initialValues:{segment:s.task.segment,task_type:s.task.task_type,task_code:s.task.task_code,name:s.task.name,description:s.task.description,owner_id:s.task.owner_id,responsible_id:s.task.responsible_id,task_status_id:s.task.task_status_id,system_screen:s.task.system_screen,sequence:s.task.sequence,observation:s.task.observation,priority_id:s.task.priority_id,complexity_id:s.task.complexity_id,priority_justification:s.task.priority_justification,complexity_justification:s.task.complexity_justification,finish_date:s.task.finish_date?s.task.finish_date.split("T")[0]:null,expected_date:s.task.expected_date?s.task.expected_date.split("T")[0]:null,created_at:s.task.created_at?s.task.created_at.split("T")[0]:null,status:s.task.status}}),T={complexityRef:i(null),complexityJustificationRef:i(null),responsibleRef:i(null)},P=()=>{d.responsible_id?Ee(()=>{T.responsibleRef.value.focus(),T.responsibleRef.value.$el.scrollIntoView({behavior:"smooth",block:"center"})}):d.complexity_id?Ee(()=>{T.complexityRef.value.focus(),T.complexityRef.value.$el.scrollIntoView({behavior:"smooth",block:"center"})}):d.complexity_justification&&Ee(()=>{T.complexityJustificationRef.value.focus(),T.complexityJustificationRef.value.$el.scrollIntoView({behavior:"smooth",block:"center"})})};re(d,Y=>{console.log(d),P()});const H=A(async Y=>{ae.value||delete Y.priority_justification,ce.value||(Y.expected_date=null),y.value||(Y.finish_date=null),console.log("Payload being sent to the backend:",Y),await m.updateTask(s.task.id,Y),q("edit")}),w=i(""),{value:O}=g("segment"),{value:N}=g("priority_id"),{value:K}=g("complexity_id"),{value:G}=g("name"),{value:M}=g("task_code"),{value:k}=g("task_type"),{value:B}=g("description"),{value:h}=g("owner_id"),{value:W}=g("responsible_id"),{value:D}=g("task_status_id"),{value:_}=g("system_screen"),{value:a}=g("sequence"),{value:n}=g("observation"),{value:se}=g("priority_justification"),{value:te}=g("complexity_justification"),{value:ce}=g("expected_date"),{value:y}=g("finish_date"),{value:I}=g("created_at"),{value:p}=g("status"),ae=Z(()=>{const Y=m.priori.find(c=>c.id===N.value);return Y&&Y.justify});return re(N,Y=>{ae.value?U("priority_justification",se.value||""):(se.value="",$({priority_justification:void 0}))}),(Y,c)=>(V(),z("div",null,[w.value?(V(),le(dl,{key:0,color:"error",class:"mb-2"},{default:l(()=>[F(Q(w.value),1)]),_:1})):de("",!0),e(Ke,{onSubmit:He(t(H),["prevent"])},{default:l(()=>[e(Ae,null,{default:l(()=>[e(x,null,{default:l(()=>[e(u,{cols:"6"},{default:l(()=>[e(L,{modelValue:t(O),"onUpdate:modelValue":c[0]||(c[0]=f=>C(O)?O.value=f:null),"error-messages":t(d).segment,items:R,label:"Segmento","item-title":"label","item-value":"value"},null,8,["modelValue","error-messages"])]),_:1}),e(u,{cols:"6"},{default:l(()=>[e(L,{modelValue:t(k),"onUpdate:modelValue":c[1]||(c[1]=f=>C(k)?k.value=f:null),"error-messages":t(d).task_type,items:E,label:"Tipo de chamado","item-title":"label","item-value":"value"},null,8,["modelValue","error-messages"])]),_:1})]),_:1}),e(x,null,{default:l(()=>[e(u,{cols:"6"},{default:l(()=>[e(ee,{modelValue:t(M),"onUpdate:modelValue":c[2]||(c[2]=f=>C(M)?M.value=f:null),"error-messages":t(d).task_code,label:"Número do chamado",variant:"outlined",color:"primary",disabled:""},null,8,["modelValue","error-messages"])]),_:1}),e(u,{cols:"6"},{default:l(()=>[e(ee,{modelValue:t(G),"onUpdate:modelValue":c[3]||(c[3]=f=>C(G)?G.value=f:null),"error-messages":t(d).name,label:"Título",variant:"outlined",color:"primary",maxlength:"60",counter:""},null,8,["modelValue","error-messages"])]),_:1})]),_:1}),e(x,null,{default:l(()=>[e(u,{cols:"6"},{default:l(()=>[e(ee,{modelValue:t(_),"onUpdate:modelValue":c[4]||(c[4]=f=>C(_)?_.value=f:null),"error-messages":t(d).system_screen,label:"Tela",variant:"outlined",color:"primary",maxlength:"60",counter:""},null,8,["modelValue","error-messages"])]),_:1}),e(u,{cols:"6"},{default:l(()=>[e(ee,{modelValue:t(a),"onUpdate:modelValue":c[5]||(c[5]=f=>C(a)?a.value=f:null),"error-messages":t(d).sequence,label:"Sequência",variant:"outlined",color:"primary",maxlength:"10",counter:""},null,8,["modelValue","error-messages"])]),_:1})]),_:1}),e(x,null,{default:l(()=>[e(u,{cols:"12"},{default:l(()=>[e(ie,{modelValue:t(B),"onUpdate:modelValue":c[6]||(c[6]=f=>C(B)?B.value=f:null),"error-messages":t(d).description,label:"Descrição",variant:"outlined",color:"primary",rows:"5",maxlength:"500",counter:""},null,8,["modelValue","error-messages"])]),_:1})]),_:1}),e(x,null,{default:l(()=>[e(u,{cols:"6"},{default:l(()=>[e(L,{modelValue:t(h),"onUpdate:modelValue":c[7]||(c[7]=f=>C(h)?h.value=f:null),"error-messages":t(d).owner_id,items:t(m).users,label:"Solicitante","item-title":"first_name","item-value":"id",disabled:""},null,8,["modelValue","error-messages","items"])]),_:1}),e(u,{cols:"6"},{default:l(()=>[e(ee,{modelValue:t(I),"onUpdate:modelValue":c[8]||(c[8]=f=>C(I)?I.value=f:null),"error-messages":t(d).created_at,label:"Data de Criação",variant:"outlined",type:"date",disabled:""},null,8,["modelValue","error-messages"])]),_:1})]),_:1}),e(x,null,{default:l(()=>[e(u,{cols:"6"},{default:l(()=>[e(L,{modelValue:t(D),"onUpdate:modelValue":c[9]||(c[9]=f=>C(D)?D.value=f:null),"error-messages":t(d).task_status_id,items:t(m).taskStatus,label:"Status do Chamado","item-title":"name","item-value":"id"},null,8,["modelValue","error-messages","items"])]),_:1}),e(u,{cols:"6"},{default:l(()=>[e(L,{modelValue:t(W),"onUpdate:modelValue":c[10]||(c[10]=f=>C(W)?W.value=f:null),"error-messages":t(d).responsible_id,items:t(m).users,label:"Responsável","item-title":"first_name","item-value":"id",ref:"responsibleRef"},null,8,["modelValue","error-messages","items"])]),_:1})]),_:1}),e(x,null,{default:l(()=>[e(u,{cols:"12"},{default:l(()=>[e(ie,{modelValue:t(n),"onUpdate:modelValue":c[11]||(c[11]=f=>C(n)?n.value=f:null),"error-messages":t(d).observation,label:"Observação",variant:"outlined",color:"primary",rows:"5",maxlength:"500",counter:""},null,8,["modelValue","error-messages"])]),_:1})]),_:1}),e(x,null,{default:l(()=>[e(u,{cols:"6"},{default:l(()=>[e(ee,{modelValue:t(ce),"onUpdate:modelValue":c[12]||(c[12]=f=>C(ce)?ce.value=f:null),"error-messages":t(d).expected_date,label:"Data Esperada",variant:"outlined",type:"date"},null,8,["modelValue","error-messages"])]),_:1}),e(u,{cols:"6"},{default:l(()=>[e(ee,{modelValue:t(y),"onUpdate:modelValue":c[13]||(c[13]=f=>C(y)?y.value=f:null),"error-messages":t(d).finish_date,label:"Data de Conclusão",variant:"outlined",type:"date"},null,8,["modelValue","error-messages"])]),_:1})]),_:1}),e(x,null,{default:l(()=>[e(u,{cols:"6"},{default:l(()=>[e(L,{modelValue:t(N),"onUpdate:modelValue":c[14]||(c[14]=f=>C(N)?N.value=f:null),"error-messages":t(d).priority_id,items:t(m).priori,label:"Prioridade","item-title":"name","item-value":"id"},null,8,["modelValue","error-messages","items"])]),_:1}),e(u,{cols:"6"},{default:l(()=>[e(ie,{modelValue:t(se),"onUpdate:modelValue":c[15]||(c[15]=f=>C(se)?se.value=f:null),"error-messages":t(d).priority_justification,label:"Justificativa da Prioridade",variant:"outlined",color:"primary",rows:"5",maxlength:"500",counter:""},null,8,["modelValue","error-messages"])]),_:1})]),_:1}),e(x,null,{default:l(()=>[e(u,{cols:"6"},{default:l(()=>[e(L,{modelValue:t(K),"onUpdate:modelValue":c[16]||(c[16]=f=>C(K)?K.value=f:null),"error-messages":t(d).complexity_id,items:t(m).complexity,label:"Complexidade do Chamado","item-title":"name","item-value":"id",ref:"complexityRef"},null,8,["modelValue","error-messages","items"])]),_:1}),e(u,{cols:"6"},{default:l(()=>[e(ie,{modelValue:t(te),"onUpdate:modelValue":c[17]||(c[17]=f=>C(te)?te.value=f:null),"error-messages":t(d).complexity_justification,label:"Justificativa da Complexidade",variant:"outlined",color:"primary",rows:"5",ref:"complexityJustificationRef",maxlength:"500",counter:""},null,8,["modelValue","error-messages"])]),_:1})]),_:1}),e(x,null,{default:l(()=>[e(u,{cols:"12"},{default:l(()=>[e(ml,{modelValue:t(p),"onUpdate:modelValue":c[18]||(c[18]=f=>C(p)?p.value=f:null),label:t(p)?"Ativo":"Inativo",color:"primary",inset:""},null,8,["modelValue","label"])]),_:1})]),_:1}),e(x,{justify:"end"},{default:l(()=>[e(u,{cols:"12",md:"auto"},{default:l(()=>[e(j,{flat:"",text:"Cancelar",onClick:c[19]||(c[19]=f=>q("cancel"))})]),_:1}),e(u,{cols:"12",md:"auto"},{default:l(()=>[e(j,{type:"submit",color:"primary",flat:"",loading:t(J),text:"Editar"},null,8,["loading"])]),_:1})]),_:1})]),_:1})]),_:1},8,["onSubmit"])]))}},jt={props:{task:{type:Object,required:!0}},emits:["cancel"],setup(S,{emit:q}){const s=S,m=Ce(),R=[{label:"Grãos",value:1},{label:"Proteína",value:2}],E=[{label:"Algo que funcionava, parou de funcionar!",value:1},{label:"Fazer uma solicitação, algo novo (melhoria)!",value:2}],A=i(s.task.segment),d=i(s.task.task_type),J=i(s.task.task_code),U=i(s.task.name),$=i(s.task.description),T=i(s.task.owner_id),P=i(s.task.responsible_id),H=i(s.task.task_status_id),w=i(s.task.system_screen),O=i(s.task.sequence),N=i(s.task.observation),K=i(s.task.priority_id),G=i(s.task.complexity_id),M=i(s.task.priority_justification),k=i(s.task.complexity_justification),B=i(s.task.finish_date?s.task.finish_date.split("T")[0]:null),h=i(s.task.expected_date?s.task.expected_date.split("T")[0]:null),W=i(s.task.created_at?s.task.created_at.split("T")[0]:null),D=i(s.task.status);return(_,a)=>(V(),z("div",null,[e(Ae,null,{default:l(()=>[e(x,null,{default:l(()=>[e(u,{cols:"6"},{default:l(()=>[e(L,{modelValue:A.value,"onUpdate:modelValue":a[0]||(a[0]=n=>A.value=n),items:R,label:"Segmento","item-title":"label","item-value":"value",disabled:"",class:"custom-label"},null,8,["modelValue"])]),_:1}),e(u,{cols:"6"},{default:l(()=>[e(L,{modelValue:d.value,"onUpdate:modelValue":a[1]||(a[1]=n=>d.value=n),items:E,label:"Tipo de chamado","item-title":"label","item-value":"value",disabled:"",class:"custom-label"},null,8,["modelValue"])]),_:1})]),_:1}),e(x,null,{default:l(()=>[e(u,{cols:"6"},{default:l(()=>[e(ee,{modelValue:J.value,"onUpdate:modelValue":a[2]||(a[2]=n=>J.value=n),label:"Número do chamado",variant:"outlined",color:"primary",disabled:"",class:"custom-label"},null,8,["modelValue"])]),_:1}),e(u,{cols:"6"},{default:l(()=>[e(ee,{modelValue:U.value,"onUpdate:modelValue":a[3]||(a[3]=n=>U.value=n),label:"Título",variant:"outlined",color:"primary",readonly:"",class:"custom-label",rows:"2",maxlength:"60"},null,8,["modelValue"])]),_:1})]),_:1}),e(x,null,{default:l(()=>[e(u,{cols:"6"},{default:l(()=>[e(ee,{modelValue:w.value,"onUpdate:modelValue":a[4]||(a[4]=n=>w.value=n),label:"Tela",variant:"outlined",color:"primary",disabled:"",class:"custom-label"},null,8,["modelValue"])]),_:1}),e(u,{cols:"6"},{default:l(()=>[e(ee,{modelValue:O.value,"onUpdate:modelValue":a[5]||(a[5]=n=>O.value=n),label:"Sequência",variant:"outlined",color:"primary",maxlength:"10",counter:"",class:"custom-label"},null,8,["modelValue"])]),_:1})]),_:1}),e(x,null,{default:l(()=>[e(u,{cols:"12"},{default:l(()=>[e(ie,{modelValue:$.value,"onUpdate:modelValue":a[6]||(a[6]=n=>$.value=n),label:"Descrição",variant:"outlined",color:"primary",rows:"5",readonly:"",class:"custom-label",maxlength:"150",counter:""},null,8,["modelValue"])]),_:1})]),_:1}),e(x,null,{default:l(()=>[e(u,{cols:"6"},{default:l(()=>[e(L,{modelValue:T.value,"onUpdate:modelValue":a[7]||(a[7]=n=>T.value=n),items:t(m).users,label:"Solicitante","item-title":"first_name","item-value":"id",disabled:"",class:"custom-label"},null,8,["modelValue","items"])]),_:1}),e(u,{cols:"6"},{default:l(()=>[e(ee,{modelValue:W.value,"onUpdate:modelValue":a[8]||(a[8]=n=>W.value=n),label:"Data de Criação",variant:"outlined",type:"date",disabled:"",class:"custom-label"},null,8,["modelValue"])]),_:1})]),_:1}),e(x,null,{default:l(()=>[e(u,{cols:"6"},{default:l(()=>[e(L,{modelValue:H.value,"onUpdate:modelValue":a[9]||(a[9]=n=>H.value=n),items:t(m).taskStatus,label:"Status do Chamado","item-title":"name","item-value":"id",disabled:"",class:"custom-label"},null,8,["modelValue","items"])]),_:1}),e(u,{cols:"6"},{default:l(()=>[e(L,{modelValue:P.value,"onUpdate:modelValue":a[10]||(a[10]=n=>P.value=n),items:t(m).users,label:"Responsável","item-title":"first_name","item-value":"id",disabled:"",class:"custom-label"},null,8,["modelValue","items"])]),_:1})]),_:1}),e(x,null,{default:l(()=>[e(u,{cols:"12"},{default:l(()=>[e(ie,{modelValue:N.value,"onUpdate:modelValue":a[11]||(a[11]=n=>N.value=n),label:"Observação",variant:"outlined",color:"primary",rows:"5",readonly:"",class:"custom-label",maxlength:"500",counter:""},null,8,["modelValue"])]),_:1})]),_:1}),e(x,null,{default:l(()=>[e(u,{cols:"6"},{default:l(()=>[e(ee,{modelValue:h.value,"onUpdate:modelValue":a[12]||(a[12]=n=>h.value=n),label:"Data Esperada",variant:"outlined",type:"date",disabled:"",class:"custom-label"},null,8,["modelValue"])]),_:1}),e(u,{cols:"6"},{default:l(()=>[e(ee,{modelValue:B.value,"onUpdate:modelValue":a[13]||(a[13]=n=>B.value=n),label:"Data de Conclusão",variant:"outlined",type:"date",disabled:"",class:"custom-label"},null,8,["modelValue"])]),_:1})]),_:1}),e(x,null,{default:l(()=>[e(u,{cols:"6"},{default:l(()=>[e(L,{modelValue:K.value,"onUpdate:modelValue":a[14]||(a[14]=n=>K.value=n),items:t(m).priori,label:"Prioridade","item-title":"name","item-value":"id",disabled:"",class:"custom-label"},null,8,["modelValue","items"])]),_:1}),e(u,{cols:"6"},{default:l(()=>[e(ie,{modelValue:M.value,"onUpdate:modelValue":a[15]||(a[15]=n=>M.value=n),label:"Justificativa da Prioridade",variant:"outlined",color:"primary",rows:"5",readonly:"",class:"custom-label",maxlength:"500",counter:""},null,8,["modelValue"])]),_:1})]),_:1}),e(x,null,{default:l(()=>[e(u,{cols:"6"},{default:l(()=>[e(L,{modelValue:G.value,"onUpdate:modelValue":a[16]||(a[16]=n=>G.value=n),items:t(m).complexity,label:"Complexidade do Chamado","item-title":"name","item-value":"id",disabled:"",class:"custom-label"},null,8,["modelValue","items"])]),_:1}),e(u,{cols:"6"},{default:l(()=>[e(ie,{modelValue:k.value,"onUpdate:modelValue":a[17]||(a[17]=n=>k.value=n),label:"Justificativa da Complexidade",variant:"outlined",color:"primary",rows:"5",readonly:"",class:"custom-label",maxlength:"500",counter:""},null,8,["modelValue"])]),_:1})]),_:1}),e(x,null,{default:l(()=>[e(u,{cols:"12"},{default:l(()=>[e(ml,{modelValue:D.value,"onUpdate:modelValue":a[18]||(a[18]=n=>D.value=n),label:D.value?"Ativo":"Inativo",color:"primary",inset:"",disabled:""},null,8,["modelValue","label"])]),_:1})]),_:1}),e(x,{justify:"end"},{default:l(()=>[e(u,{cols:"12",md:"auto"},{default:l(()=>[e(j,{flat:"",text:"Fechar",onClick:a[19]||(a[19]=n=>_.$emit("cancel"))})]),_:1})]),_:1})]),_:1})]))}},cl=Al("chats",{state:()=>({messages:[]}),actions:{async fetchMessages(S){try{const q=await Oe.get(`/api/interactions/${S}`);this.messages=q.data}catch(q){console.error("Error fetching messages:",q)}},async createInteraction(S,q,s){try{return(await Oe.post("/api/interactions",{task_id:S,comment:q,user_id:s})).data}catch(m){console.error("Error creating interaction:",m)}},async uploadFile(S){try{return(await Oe.post("/api/interaction-file",S,{headers:{"Content-Type":"multipart/form-data"}})).data}catch(q){throw console.error("Error uploading file:",q),q}}}});function vl(S){return`https://syscall-api.devtest.com.br//storage/${S}`}const pl=S=>(Be("data-v-4ff77f2d"),S=S(),Le(),S),Ft=pl(()=>r("span",{class:"text-h5"},"Notas de Trabalho",-1)),Pt={class:"comment-text"},Dt={key:0},Rt=["href"],Et={class:"text-right text-caption mt-2"},Ot={class:"email-text"},Nt=F(" - "),zt={class:"email-text"},Jt=F("Adicionar Comentário"),Bt=F("Fechar"),Lt=pl(()=>r("span",{class:"text-h5"},"Adicionar Comentário",-1)),Gt=F("Cancelar"),Ht=F("Adicionar"),Kt={props:{taskId:{type:Number,required:!0},showChatModal:{type:Boolean,required:!0},userId:{type:Number,required:!0}},emits:["update:showChatModal"],setup(S,{emit:q}){const s=S,m=cl(),{messages:R}=Te(m),E=i(!1),A=i(!1),d=Ge({comment:oe().required().label("Comentário"),files:ul().of(il()).nullable()}),{handleSubmit:J,errors:U,isSubmitting:$,resetForm:T}=Xe({validationSchema:d,initialValues:{comment:"",files:[]}}),P=J(async M=>{try{const k=await m.createInteraction(s.taskId,M.comment,s.userId);if(M.files&&M.files.length>0){const B=new FormData;B.append("interaction_id",k.id);for(const h of M.files)B.append("files[]",h);await m.uploadFile(B)}await m.fetchMessages(s.taskId),A.value=!1,q("update:showChatModal",!1)}catch(k){console.error("Erro ao adicionar comentário ou fazer upload dos arquivos:",k)}}),{value:H}=g("comment"),{value:w}=g("files");re(()=>s.showChatModal,async M=>{M?(E.value=!0,await m.fetchMessages(s.taskId)):E.value=!1});const O=()=>{q("update:showChatModal",!1)},N=()=>{T(),A.value=!0},K=M=>{const k={year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"};return new Date(M).toLocaleDateString("pt-BR",k)},G=Z(()=>[...R.value].sort((M,k)=>k.id-M.id));return(M,k)=>{const B=Il("v-list-item-content");return V(),le(be,{modelValue:E.value,"onUpdate:modelValue":k[4]||(k[4]=h=>E.value=h),"max-width":"800px",persistent:""},{default:l(()=>[e(me,null,{default:l(()=>[e(ge,null,{default:l(()=>[Ft]),_:1}),e(pe,null,{default:l(()=>[e(Ae,null,{default:l(()=>[e(x,null,{default:l(()=>[(V(!0),z(qe,null,je(t(G),(h,W)=>(V(),le(u,{key:W,cols:"12"},{default:l(()=>[e(me,{class:"mb-3"},{default:l(()=>[e(pe,null,{default:l(()=>[r("div",Pt,Q(h.comment),1),h.interaction_files&&h.interaction_files.length?(V(),z("div",Dt,[e(we),e(Ml,null,{default:l(()=>[(V(!0),z(qe,null,je(h.interaction_files,(D,_)=>(V(),le(ke,{key:_},{default:l(()=>[e(B,null,{default:l(()=>[e(jl,null,{default:l(()=>[r("a",{href:t(vl)(D.path),target:"_blank"},Q(D.name),9,Rt)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:2},1024)])):de("",!0),r("div",Et,[r("span",Ot,Q(h.user_email),1),Nt,r("span",zt,Q(K(h.created_at)),1)])]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})]),_:1}),e(Fe,null,{default:l(()=>[e(j,{color:"primary",onClick:N},{default:l(()=>[Jt]),_:1}),e(j,{color:"secondary",onClick:O},{default:l(()=>[Bt]),_:1})]),_:1})]),_:1}),e(be,{modelValue:A.value,"onUpdate:modelValue":k[3]||(k[3]=h=>A.value=h),"max-width":"500px",persistent:""},{default:l(()=>[e(me,null,{default:l(()=>[e(ge,null,{default:l(()=>[Lt]),_:1}),e(pe,null,{default:l(()=>[e(Ke,{onSubmit:He(t(P),["prevent"])},{default:l(()=>[e(ie,{modelValue:t(H),"onUpdate:modelValue":k[0]||(k[0]=h=>C(H)?H.value=h:null),label:"Comentário","error-messages":t(U).comment},null,8,["modelValue","error-messages"]),e(rl,{modelValue:t(w),"onUpdate:modelValue":k[1]||(k[1]=h=>C(w)?w.value=h:null),label:"Selecionar Arquivos","error-messages":t(U).files,"show-size":"",multiple:""},null,8,["modelValue","error-messages"])]),_:1},8,["onSubmit"])]),_:1}),e(Fe,null,{default:l(()=>[e(j,{color:"blue darken-1",text:"",onClick:k[2]||(k[2]=h=>A.value=!1)},{default:l(()=>[Gt]),_:1}),e(j,{color:"blue darken-1",text:"",loading:t($),onClick:t(P)},{default:l(()=>[Ht]),_:1},8,["loading","onClick"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1},8,["modelValue"])}}},al=We(Kt,[["__scopeId","data-v-4ff77f2d"]]),Wt=r("span",{class:"text-h5"},"Anexos do Chamado",-1),Xt=["href"],Qt=F("Fechar"),Yt={props:{taskId:{type:Number,required:!0},showAttachmentsModal:{type:Boolean,required:!0}},emits:["update:showAttachmentsModal"],setup(S,{emit:q}){const s=S,m=Ce(),{taskFiles:R}=Te(m),E=i(!1);re(()=>s.showAttachmentsModal,async J=>{J?(await m.getTaskFiles(s.taskId),E.value=!0):E.value=!1});const A=()=>{q("update:showAttachmentsModal",!1)},d=async J=>{await m.deleteTaskFile(J),await m.getTaskFiles(s.taskId)};return(J,U)=>(V(),le(be,{modelValue:E.value,"onUpdate:modelValue":U[0]||(U[0]=$=>E.value=$),"max-width":"800px",persistent:""},{default:l(()=>[e(me,null,{default:l(()=>[e(ge,null,{default:l(()=>[Wt]),_:1}),e(pe,null,{default:l(()=>[e(Ae,null,{default:l(()=>[e(x,null,{default:l(()=>[(V(!0),z(qe,null,je(t(R),($,T)=>(V(),le(u,{key:T,cols:"12"},{default:l(()=>[e(me,{class:"mb-3"},{default:l(()=>[e(pe,null,{default:l(()=>[r("a",{href:t(vl)($.path),target:"_blank"},Q($.name),9,Xt),e(j,{icon:"",onClick:P=>d($.id)},{default:l(()=>[e(t(Sl))]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})]),_:1}),e(Fe,null,{default:l(()=>[e(j,{color:"secondary",onClick:A},{default:l(()=>[Qt]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]))}};const fl=S=>(Be("data-v-d95a4dcb"),S=S(),Le(),S),Zt={class:"mb-5 pb-5 border-b border-opacity-100"},ea=fl(()=>r("label",{class:"mr-4"},"Segmento:",-1)),la=F("Novo Chamado"),ta=F("Adicionar chamado"),aa=F("Visualizar chamado"),oa=F("Editar chamado"),sa=F("Cancelar"),na=F("Deletar"),ua=fl(()=>r("span",{class:"text-h5"},"Adicionar Nota de Trabalho",-1)),ia=F("Cancelar"),da=F("Adicionar"),ra={setup(S){var ce;const q=sl(),s=ze(),m=Ce(),{toShow:R,toEdit:E,toDelete:A}=Te(m),d=cl();Te(d);const{isLoading:J}=$e(m.getTasks());$e(m.getPriorities()),$e(m.getComplexities()),$e(m.getTasksStatus()),$e(m.getUsers());const U=Z({get(){return!!Object.keys(E.value).length},set(y){y||(E.value={})}}),$=Z({get(){return!!Object.keys(R.value).length},set(y){y||(R.value={})}}),T=Z({get(){return!!Object.keys(A.value).length},set(y){y||(A.value={})}}),P=i(!1);async function H(y){P.value=!0,await m.deleteTask(y.id),A.value={},P.value=!1}const w=i(!1),O=i(0),N=i(!1),K=i(""),G=i(s.user.id),M=y=>{y&&y.id&&(O.value=y.id,w.value=!0)},k=y=>{y&&y.id&&(O.value=y.id,N.value=!0)},B=async()=>{await d.addMessage(O.value,K.value,G.value),K.value="",N.value=!1},h=i(!1),W=y=>{y&&y.id&&(O.value=y.id,h.value=!0)},D=i(""),_=i(!1),a=i(((ce=s.user)==null?void 0:ce.default_segment)||"0");function n(y,I){let p;return function(...ae){clearTimeout(p),p=setTimeout(()=>y(...ae),I)}}const se=async()=>{try{await s.updateUserSegment(a.value),te()}catch(y){console.error("Failed to update user segment:",y)}},te=n(async()=>{const y=D.value||"";await m.getTasks(y,a.value)},2e3);return re(D,te),re(a,te),Je(()=>{const y=q.query.search||"";y?(_.value=!0,m.getTasks(y).then(()=>{_.value=!1})):te()}),re(D,y=>{m.getTasks(y)}),(y,I)=>(V(),z("div",null,[r("div",Zt,[e(x,{align:"center",justify:"space-between"},{default:l(()=>[e(u,{cols:"12",lg:"3",md:"4"},{default:l(()=>[e(ee,{density:"compact",modelValue:D.value,"onUpdate:modelValue":I[0]||(I[0]=p=>D.value=p),label:"Pesquisar Chamados","append-inner-icon":"mdi-magnify","hide-details":"",variant:"outlined"},null,8,["modelValue"])]),_:1}),e(u,{cols:"12",lg:"6",md:"4",class:"d-flex align-center"},{default:l(()=>[ea,e(Fl,{modelValue:a.value,"onUpdate:modelValue":I[1]||(I[1]=p=>a.value=p),onChange:se,row:"",inline:"",class:"radio-button"},{default:l(()=>[e(Ne,{label:"Todos",value:"0",class:"mr-2"}),e(Ne,{label:"Grãos",value:"1",class:"mr-2"}),e(Ne,{label:"Proteína",value:"2"})]),_:1},8,["modelValue"])]),_:1}),e(u,{cols:"12",lg:"3",md:"4",class:"text-right"},{default:l(()=>[e(be,{width:"800",persistent:""},{activator:l(({props:p})=>[e(j,ve({flat:"",color:"primary"},p),{default:l(()=>[la]),_:2},1040)]),default:l(({isActive:p})=>[e(me,{width:"800"},{default:l(()=>[e(ge,null,{default:l(()=>[ta]),_:1}),e(pe,null,{default:l(()=>[e(It,{onAdd:ae=>p.value=!1,onCancel:ae=>p.value=!1},null,8,["onAdd","onCancel"])]),_:2},1024)]),_:2},1024)]),_:1})]),_:1})]),_:1})]),t(J)?(V(),le(Dl,{key:0,width:3,color:"primary",indeterminate:""})):(V(),z(qe,{key:1},[e(At,{onOpenChat:M,onAddNote:k,onOpenAttachments:W}),e(be,{modelValue:t($),"onUpdate:modelValue":I[2]||(I[2]=p=>C($)?$.value=p:null),width:"800",persistent:""},{default:l(({isActive:p})=>[e(me,{width:"800"},{default:l(()=>[e(ge,null,{default:l(()=>[aa]),_:1}),e(pe,null,{default:l(()=>[e(jt,{task:t(R),onCancel:ae=>p.value=!1,onShow:ae=>p.value=!1},null,8,["task","onCancel","onShow"])]),_:2},1024)]),_:2},1024)]),_:1},8,["modelValue"]),e(be,{modelValue:t(U),"onUpdate:modelValue":I[3]||(I[3]=p=>C(U)?U.value=p:null),width:"800",persistent:""},{default:l(({isActive:p})=>[e(me,{width:"800"},{default:l(()=>[e(ge,null,{default:l(()=>[oa]),_:1}),e(pe,null,{default:l(()=>[e(Mt,{task:t(E),onCancel:ae=>p.value=!1,onEdit:ae=>p.value=!1},null,8,["task","onCancel","onEdit"])]),_:2},1024)]),_:2},1024)]),_:1},8,["modelValue"]),e(be,{modelValue:t(T),"onUpdate:modelValue":I[5]||(I[5]=p=>C(T)?T.value=p:null),width:"800",persistent:""},{default:l(({isActive:p})=>[e(me,{"prepend-icon":t(ol),title:"Você tem certeza que deseja deletar este chamado?"},{actions:l(()=>[e(Pl),e(j,{onClick:ae=>p.value=!1},{default:l(()=>[sa]),_:2},1032,["onClick"]),e(j,{onClick:I[4]||(I[4]=ae=>H(t(A))),variant:"tonal",color:"error",loading:P.value},{default:l(()=>[na]),_:1},8,["loading"])]),_:2},1032,["prepend-icon"])]),_:1},8,["modelValue"])],64)),e(al,{taskId:O.value,showChatModal:w.value,userId:G.value,"onUpdate:showChatModal":I[6]||(I[6]=p=>w.value=p)},null,8,["taskId","showChatModal","userId"]),e(be,{modelValue:N.value,"onUpdate:modelValue":I[9]||(I[9]=p=>N.value=p),"max-width":"500px",persistent:""},{default:l(()=>[e(me,null,{default:l(()=>[e(ge,null,{default:l(()=>[ua]),_:1}),e(pe,null,{default:l(()=>[e(al,{taskId:O.value,showChatModal:w.value,userId:G.value,"onUpdate:showChatModal":I[7]||(I[7]=p=>w.value=p)},null,8,["taskId","showChatModal","userId"])]),_:1}),e(Fe,null,{default:l(()=>[e(j,{color:"blue darken-1",text:"",onClick:I[8]||(I[8]=p=>N.value=!1)},{default:l(()=>[ia]),_:1}),e(j,{color:"blue darken-1",text:"",onClick:B},{default:l(()=>[da]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(Yt,{taskId:O.value,showAttachmentsModal:h.value,"onUpdate:showAttachmentsModal":I[10]||(I[10]=p=>h.value=p)},null,8,["taskId","showAttachmentsModal"])]))}},_a=We(ra,[["__scopeId","data-v-d95a4dcb"]]);export{_a as default};
