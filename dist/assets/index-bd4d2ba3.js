import{F as Re,E as Vl,i as hl,j as ul,N as xl,k as kl,l as Cl,m as wl}from"./vue-tabler-icons.es-e8343748.js";import{u as He,at as nl,I as Sl,ac as Ue,B as Z,J as n,U as ne,K as Ke,o as h,c as N,a as d,b as e,w as l,d as U,e as le,au as Ee,t as X,l as de,V as F,y as t,ab as L,m as we,av as $e,P as Se,F as Te,q as Ne,i as Ul,aw as Tl,z as xe,S as ql,T as $l,p as ye,ax as Al,af as Il,N as We,O as Xe,ag as Qe,ay as ue,ah as oe,aq as il,az as rl,aA as dl,ai as ml,a3 as Me,a7 as C,a0 as r,ak as M,aj as ee,aB as me,aC as cl,W as Ye,al as Ze,aD as Je,ar as el,aE as Be,ad as Ml,ae as Le,r as Dl,aa as Ve,ao as pe,a8 as ce,G as jl,j as Fl,aF as Ie,an as _e,am as Ae,aG as Pl,aH as Ge,X as Rl,ap as El}from"./index-fc9b34ed.js";import{u as qe}from"./tasks-7a8de7d7.js";import{_ as ll}from"./_plugin-vue_export-helper-c27b6911.js";import{a as k,u as tl}from"./vee-validate.esm-a02ea01b.js";function vl(w){return`https://syscall-api.devtest.com.br//storage/${w}`}function Oe(w){return w?new Date(w).toLocaleDateString("pt-BR"):"Data não disponível"}function Ol(w,$){const o=["Chamado","Sequência","Título","Solicitante","Responsável","Status","Prioridade","Complexidade","Data Criação","Data Esperada","Data Conclusão"],m=w.map(i=>{var G,R,O,S,q;return[i.task_code,i.sequence,i.name,(G=i.user_owner)==null?void 0:G.first_name,((R=i.user_responsible)==null?void 0:R.first_name)||"Nenhum responsável",(O=i.task_status)==null?void 0:O.name,(S=i.priority)==null?void 0:S.name,((q=i.complexity)==null?void 0:q.name)||"Aguardando análise",Oe(i.created_at),Oe(i.expected_date),Oe(i.finish_date)]}),z=[o,...m].map(i=>i.join(",")).join(`
`),D=new Blob([z],{type:"text/csv;charset=utf-8;"}),T=document.createElement("a");T.href=URL.createObjectURL(D),T.setAttribute("download",$),document.body.appendChild(T),T.click(),document.body.removeChild(T)}const be=w=>(We("data-v-c784669e"),w=w(),Xe(),w),Nl={class:"tasks-table-container"},zl={class:"table-wrapper"},Jl={class:"text-left",style:{width:"175px"}},Bl={class:"text-left",style:{width:"185px"}},Ll={class:"text-left",style:{width:"135px"}},Gl={class:"text-left",style:{width:"165px"}},Hl=be(()=>d("th",{class:"text-left",style:{width:"100px"}},"Ações",-1)),Kl=be(()=>d("th",null,null,-1)),Wl={key:0},Xl=be(()=>d("td",null,null,-1)),Ql=be(()=>d("td",null,null,-1)),Yl=be(()=>d("td",null,null,-1)),Zl={key:0},et={key:1},lt={key:2},tt={key:3},at={key:4},ot={key:5},st={key:6},ut={key:7},nt={key:8},it={key:9},rt=be(()=>d("td",null,null,-1)),dt=be(()=>d("td",null,null,-1)),mt={class:"text-clamp"},ct={class:"text-clamp"},vt={class:"text-clamp"},pt={class:"text-right"},ft={class:"d-flex align-center"},_t={class:"text-clamp"},bt={class:"text-right"},gt={class:"d-flex align-center"},yt={colspan:"8",class:"text-right"},Vt=be(()=>d("strong",{class:"totalizer"},"Total de Chamados:",-1)),ht={class:"totalizer-number"},xt={class:"text-left"},kt=be(()=>d("span",{class:"ml-2"},"Exportar CSV",-1)),Ct={__name:"TasksTable",emits:["update:filters"],setup(w,{emit:$}){const o=He(),m=qe(),z=nl();Sl();const{tasks:D,toShow:T,toEdit:i,toDelete:G,taskFiles:R}=Ue(m),O=Z(()=>o.user.teams.some(V=>V.is_admin)),S=n([]),q=n([]),A=n([]),_=n([]),I=n([]),E=n(!1),J=n(!1),K=n(!1),H=n(!1),j=n(!1),x=Z(()=>[...new Set(D.value.map(V=>V.task_status.name))]),B=Z(()=>[...new Set(D.value.map(V=>V.user_owner.first_name))]),y=Z(()=>[...new Set(D.value.map(V=>{var v;return((v=V.user_responsible)==null?void 0:v.first_name)||"Nenhum responsável"}))]),W=Z(()=>[...new Set(D.value.map(V=>V.priority.name))]),b=Z(()=>[...new Set(D.value.map(V=>{var v;return((v=V.complexity)==null?void 0:v.name)||"Em análise"}))]),a=n(!1),s=n(!1),te=n(!1),ie=n(!1),se=n(!1),fe=()=>{a.value=S.value.length===x.value.length,console.log("Emitting status filters:",S.value),$("update:filters",{taskStatus:S.value})},ge=()=>{s.value=q.value.length===B.value.length,console.log("Emitting status filters:",q.value),$("update:filters",{userOwner:q.value})},re=()=>{te.value=A.value.length===y.value.length,console.log("Emitting status filters:",A.value),$("update:filters",{userResponsible:A.value})},ke=()=>{console.log("handlePriorityChange called"),ie.value=_.value.length===W.value.length,console.log("Emitting status filters:",_.value),$("update:filters",{priority:_.value})},Q=()=>{se.value=I.value.length===b.value.length,console.log("Emitting status filters:",I.value),$("update:filters",{complexity:I.value})},c=()=>{a.value?S.value=[]:S.value=[...x.value]},p=()=>{s.value?q.value=[]:q.value=[...B.value]},De=()=>{te.value?A.value=[]:A.value=[...y.value]};ne(_,V=>{console.log("Selected priorities changed:",V)});const g=()=>{ie.value?_.value=[]:_.value=[...W.value]},P=()=>{se.value?I.value=[]:I.value=[...b.value]},f=n(""),Y=n("asc"),je=V=>{f.value===V?Y.value=Y.value==="asc"?"desc":"asc":(f.value=V,Y.value="asc")},bl=Z(()=>{const V=[...D.value];return V.sort((v,u)=>{const Ce=v[f.value],he=u[f.value];return Ce<he?Y.value==="asc"?-1:1:Ce>he?Y.value==="asc"?1:-1:0}),V}),ze=Z(()=>D.value?bl.value.filter(V=>{var ae,ve,al,ol;if(!V)return!1;const v=S.value.length===0||S.value.includes(V.task_status.name),u=q.value.length===0||q.value.includes(V.user_owner.first_name),Ce=A.value.length===0||A.value.includes(((ae=V.user_responsible)==null?void 0:ae.first_name)||"Nenhum responsável"),he=_.value.length===0||_.value.includes(V.priority.name),Fe=I.value.length===0||I.value.includes(((ve=V.complexity)==null?void 0:ve.name)||"Em análise"),Pe=((al=o.user)==null?void 0:al.default_segment)==0||V.segment==((ol=o.user)==null?void 0:ol.default_segment);return v&&u&&Ce&&he&&Fe&&Pe}):[]),gl=V=>({color:V.color});Ke(()=>{const V=z.query.search||"";V&&m.getTasks(V)}),ne(()=>z.query.search,V=>{const v=V||"";m.getTasks(v)});const yl=()=>{Ol(ze.value,"tasks.csv")};return(V,v)=>(h(),N("div",Nl,[d("div",zl,[e(Il,{class:"border-opacity-100"},{default:l(()=>[d("thead",null,[d("tr",null,[d("th",{class:"text-left",style:{width:"50px"},onClick:v[0]||(v[0]=u=>je("task_code"))},[U(" Chamado "),f.value==="task_code"?(h(),le(Ee,{key:0},{default:l(()=>[U(X(Y.value==="asc"?"mdi-arrow-up":"mdi-arrow-down"),1)]),_:1})):de("",!0)]),d("th",{class:"text-left",style:{width:"50px"},onClick:v[1]||(v[1]=u=>je("sequence"))},[U(" Sequência "),f.value==="sequence"?(h(),le(Ee,{key:0},{default:l(()=>[U(X(Y.value==="asc"?"mdi-arrow-up":"mdi-arrow-down"),1)]),_:1})):de("",!0)]),d("th",{class:"text-left",style:{width:"250px"},onClick:v[2]||(v[2]=u=>je("name"))},[U(" Título "),f.value==="name"?(h(),le(Ee,{key:0},{default:l(()=>[U(X(Y.value==="asc"?"mdi-arrow-up":"mdi-arrow-down"),1)]),_:1})):de("",!0)]),d("th",{class:"text-left",style:{width:"250px"},onClick:v[3]||(v[3]=u=>je("expected_date"))},[U(" Data Prevista "),f.value==="expected_date"?(h(),le(Ee,{key:0},{default:l(()=>[U(X(Y.value==="asc"?"mdi-arrow-up":"mdi-arrow-down"),1)]),_:1})):de("",!0)]),d("th",Jl,[U(" Solicitante "),e(F,{icon:"",onClick:v[4]||(v[4]=u=>J.value=!J.value)},{default:l(()=>[e(t(Re))]),_:1})]),d("th",Bl,[U(" Responsável "),e(F,{icon:"",onClick:v[5]||(v[5]=u=>K.value=!K.value)},{default:l(()=>[e(t(Re))]),_:1})]),d("th",Ll,[U(" Status "),e(F,{icon:"",onClick:v[6]||(v[6]=u=>E.value=!E.value)},{default:l(()=>[e(t(Re))]),_:1})]),d("th",Gl,[U(" Prioridade "),e(F,{icon:"",onClick:v[7]||(v[7]=u=>H.value=!H.value)},{default:l(()=>[e(t(Re))]),_:1})]),Hl,Kl])]),d("tbody",null,[J.value||K.value||E.value||H.value||j.value?(h(),N("tr",Wl,[Xl,Ql,Yl,J.value?(h(),N("td",Zl,[e(L,{modelValue:q.value,"onUpdate:modelValue":v[9]||(v[9]=u=>q.value=u),items:B.value,label:"Filtro Solicitante",multiple:"",onChange:ge},{"prepend-item":l(()=>[e(we,null,{default:l(()=>[e($e,{modelValue:s.value,"onUpdate:modelValue":v[8]||(v[8]=u=>s.value=u),label:s.value?"Desmarcar todos":"Selecionar todos",onChange:p},null,8,["modelValue","label"])]),_:1}),e(Se)]),_:1},8,["modelValue","items"])])):(h(),N("td",et)),K.value?(h(),N("td",lt,[e(L,{modelValue:A.value,"onUpdate:modelValue":v[11]||(v[11]=u=>A.value=u),items:y.value,label:"Filtro Responsável",multiple:"",onChange:re},{"prepend-item":l(()=>[e(we,null,{default:l(()=>[e($e,{modelValue:te.value,"onUpdate:modelValue":v[10]||(v[10]=u=>te.value=u),label:te.value?"Desmarcar todos":"Selecionar todos",onChange:De},null,8,["modelValue","label"])]),_:1}),e(Se)]),_:1},8,["modelValue","items"])])):(h(),N("td",tt)),E.value?(h(),N("td",at,[e(L,{modelValue:S.value,"onUpdate:modelValue":v[13]||(v[13]=u=>S.value=u),items:x.value,label:"Filtro Status",multiple:"",onChange:fe},{"prepend-item":l(()=>[e(we,null,{default:l(()=>[e($e,{modelValue:a.value,"onUpdate:modelValue":v[12]||(v[12]=u=>a.value=u),label:a.value?"Desmarcar todos":"Selecionar todos",onChange:c},null,8,["modelValue","label"])]),_:1}),e(Se)]),_:1},8,["modelValue","items"])])):(h(),N("td",ot)),H.value?(h(),N("td",st,[e(L,{modelValue:_.value,"onUpdate:modelValue":v[15]||(v[15]=u=>_.value=u),items:W.value,label:"Filtro Prioridade",multiple:"",onChange:ke},{"prepend-item":l(()=>[e(we,null,{default:l(()=>[e($e,{modelValue:ie.value,"onUpdate:modelValue":v[14]||(v[14]=u=>ie.value=u),label:ie.value?"Desmarcar todos":"Selecionar todos",onChange:g},null,8,["modelValue","label"])]),_:1}),e(Se)]),_:1},8,["modelValue","items"])])):(h(),N("td",ut)),j.value?(h(),N("td",nt,[e(L,{modelValue:I.value,"onUpdate:modelValue":v[17]||(v[17]=u=>I.value=u),items:b.value,label:"Filtro Complexidade",multiple:"",onChange:Q},{"prepend-item":l(()=>[e(we,null,{default:l(()=>[e($e,{modelValue:se.value,"onUpdate:modelValue":v[16]||(v[16]=u=>se.value=u),label:se.value?"Desmarcar todos":"Selecionar todos",onChange:P},null,8,["modelValue","label"])]),_:1}),e(Se)]),_:1},8,["modelValue","items"])])):(h(),N("td",it)),rt,dt])):de("",!0),(h(!0),N(Te,null,Ne(ze.value,(u,Ce)=>{var he,Fe,Pe;return h(),N("tr",{key:(u==null?void 0:u.id)||Ce},[d("td",null,X(u==null?void 0:u.task_code),1),d("td",null,X(u==null?void 0:u.sequence),1),d("td",null,[d("div",mt,X(u==null?void 0:u.name),1),u!=null&&u.default?(h(),le(Ul,{key:0,size:"small",variant:"tonal",color:"primary",class:"ml-2"},{default:l(()=>[U("Default")]),_:1})):de("",!0)]),d("td",null,X(t(Oe)(u==null?void 0:u.expected_date)),1),d("td",null,[d("div",ct,X((he=u==null?void 0:u.user_owner)==null?void 0:he.first_name),1)]),d("td",null,[d("div",vt,X(((Fe=u==null?void 0:u.user_responsible)==null?void 0:Fe.first_name)||"Nenhum responsável"),1)]),d("td",null,[d("div",{class:"text-clamp",style:Tl(gl(u==null?void 0:u.task_status))},X((Pe=u==null?void 0:u.task_status)==null?void 0:Pe.name),5)]),d("td",pt,[d("div",ft,[e(xe,{text:u==null?void 0:u.priority_justification},{activator:l(({props:ae})=>[e(F,ql($l(ae)),{default:l(()=>{var ve;return[d("span",ye(V.attrs,Al(V.on,!0)),[d("div",_t,X((ve=u==null?void 0:u.priority)==null?void 0:ve.name),1)],16)]}),_:2},1040)]),_:2},1032,["text"])])]),d("td",bt,[d("div",gt,[e(xe,{text:"Visualizar Chamado"},{activator:l(({props:ae})=>[e(F,ye({icon:"",flat:"",onClick:ve=>T.value=u},ae),{default:l(()=>[e(t(Vl),{"stroke-width":"1.5",size:"20",class:"text-primary"})]),_:2},1040,["onClick"])]),_:2},1024),O.value?(h(),le(xe,{key:0,text:"Editar Chamado"},{activator:l(({props:ae})=>[e(F,ye({icon:"",flat:"",onClick:ve=>i.value=u},ae),{default:l(()=>[e(t(hl),{"stroke-width":"1.5",size:"20",class:"text-primary"})]),_:2},1040,["onClick"])]),_:2},1024)):de("",!0),O.value?(h(),le(xe,{key:1,text:"Deletar Chamado"},{activator:l(({props:ae})=>[e(F,ye({icon:"",flat:"",onClick:ve=>G.value=u},ae),{default:l(()=>[e(t(ul),{"stroke-width":"1.5",size:"20",class:"text-error"})]),_:2},1040,["onClick"])]),_:2},1024)):de("",!0),e(xe,{text:"Consultar Notas de Trabalho"},{activator:l(({props:ae})=>[e(F,ye({icon:"",flat:"",onClick:ve=>V.$emit("openChat",u)},ae),{default:l(()=>[e(t(xl),{"stroke-width":"1.5",size:"20",class:"text-primary"})]),_:2},1040,["onClick"])]),_:2},1024),e(xe,{text:"Anexos"},{activator:l(({props:ae})=>[e(F,ye({icon:"",flat:"",onClick:ve=>V.$emit("openAttachments",u)},ae),{default:l(()=>[e(t(kl),{"stroke-width":"1.5",size:"20",class:"text-primary"})]),_:2},1040,["onClick"])]),_:2},1024)])])])}),128))]),d("tfoot",null,[d("tr",null,[d("td",yt,[Vt,d("span",ht,X(ze.value.length),1)]),d("td",xt,[kt,e(xe,{text:"Exportar CSV"},{activator:l(({props:u})=>[e(F,ye({icon:"",flat:"",onClick:yl},u),{default:l(()=>[e(t(Cl),{"stroke-width":"1.5",size:"20",class:"text-primary"})]),_:2},1040)]),_:1})])])])]),_:1})])]))}},wt=ll(Ct,[["__scopeId","data-v-c784669e"]]),St={__name:"TaskAddForm",emits:["cancel","add"],setup(w,{emit:$}){const o=He(),m=qe();n([]);const z=[{label:"Grãos",value:1},{label:"Proteína",value:2}],D=[{label:"Algo que funcionava, parou de funcionar?",value:1},{label:"Fazer uma solicitação, algo novo (melhoria)?",value:2}],T=Z(()=>{var b;return((b=m.priori.find(a=>a.is_default))==null?void 0:b.id)||null}),i=Z(()=>{var b;return((b=m.taskStatus.find(a=>a.is_default))==null?void 0:b.id)||null}),{value:G}=k("segment",2),{value:R}=k("priority_id"),{value:O}=k("task_status_id");Ke(()=>{T.value&&!R.value&&(R.value=T.value),i.value&&!O.value&&(O.value=i.value)});const S=Z(()=>{const b=m.priori.find(a=>a.id===R.value);return b&&b.justify}),q=Z(()=>Qe({segment:ue().required().label("Segmento"),task_type:ue().required("Tipo de chamado é obrigatório").typeError("Tipo de chamado é obrigatório"),name:oe().required().label("Título"),system_screen:oe().required().label("Tela"),description:oe().required().label("Descrição"),owner_id:ue().required().label("Solicitante"),task_status_id:ue().required().label("Status do Chamado"),priority_id:ue().required().label("Prioridade"),observation:oe().nullable().label("Observação"),priority_justification:S.value?oe().required().label("Justificativa da Prioridade"):oe().label("Justificativa da Prioridade"),status:il().required().label("Status"),files:rl().of(dl()).nullable()})),{handleSubmit:A,errors:_,isSubmitting:I}=tl({validationSchema:q,initialValues:{segment:1,task_type:"",name:"",system_screen:"",description:"",owner_id:o.user.id,responsible_id:"",task_status_id:i.value,priority_id:T.value,observation:"",created_at:"",expected_date:"",finish_date:"",priority_justification:"",status:!0,files:[]}}),E=A(async b=>{console.log("priority_id at submit:",R.value),console.log("values before sending:",b),b.priority_id=R.value,b.segment=G.value;try{const a=W.value,s=await m.storeTask(b,a);$("add")}catch(a){console.error("Erro ao adicionar comentário ou fazer upload dos arquivos:",a)}}),J=n(""),{value:K}=k("name"),{value:H}=k("task_type"),{value:j}=k("system_screen"),{value:x}=k("description");k("owner_id"),k("responsible_id");const{value:B}=k("observation");k("created_at"),k("expected_date"),k("finish_date");const{value:y}=k("priority_justification");k("status");const{value:W}=k("files");return ne(T,b=>{b&&!R.value&&(R.value=b)}),ne(i,b=>{b&&!O.value&&(O.value=b)}),ne(R,b=>{console.log("priority_id changed to:",b),S.value||(y.value="")}),(b,a)=>(h(),N("div",null,[J.value?(h(),le(ml,{key:0,color:"error",class:"mb-2"},{default:l(()=>[U(X(J.value),1)]),_:1})):de("",!0),e(Ze,{onSubmit:Ye(t(E),["prevent"])},{default:l(()=>[e(Me,null,{default:l(()=>[e(C,null,{default:l(()=>[e(r,{cols:"6"},{default:l(()=>[e(L,{modelValue:t(G),"onUpdate:modelValue":a[0]||(a[0]=s=>M(G)?G.value=s:null),"error-messages":t(_).segment,items:z,label:"Segmento","item-title":"label","item-value":"value"},null,8,["modelValue","error-messages"])]),_:1}),e(r,{cols:"6"},{default:l(()=>[e(L,{modelValue:t(H),"onUpdate:modelValue":a[1]||(a[1]=s=>M(H)?H.value=s:null),"error-messages":t(_).task_type,items:D,label:"Tipo de chamado","item-title":"label","item-value":"value"},null,8,["modelValue","error-messages"])]),_:1})]),_:1}),e(C,null,{default:l(()=>[e(r,{cols:"12"},{default:l(()=>[e(ee,{modelValue:t(K),"onUpdate:modelValue":a[2]||(a[2]=s=>M(K)?K.value=s:null),"error-messages":t(_).name,label:"Título",variant:"outlined",color:"primary",maxlength:"60",counter:""},null,8,["modelValue","error-messages"])]),_:1})]),_:1}),e(C,null,{default:l(()=>[e(r,{cols:"12"},{default:l(()=>[e(ee,{modelValue:t(j),"onUpdate:modelValue":a[3]||(a[3]=s=>M(j)?j.value=s:null),"error-messages":t(_).system_screen,label:"Tela",variant:"outlined",color:"primary",maxlength:"60",counter:""},null,8,["modelValue","error-messages"])]),_:1})]),_:1}),e(C,null,{default:l(()=>[e(r,{cols:"12"},{default:l(()=>[e(me,{modelValue:t(x),"onUpdate:modelValue":a[4]||(a[4]=s=>M(x)?x.value=s:null),"error-messages":t(_).description,label:"Descrição",variant:"outlined",color:"primary",rows:"5",maxlength:"500",counter:""},null,8,["modelValue","error-messages"])]),_:1})]),_:1}),e(C,null,{default:l(()=>[e(r,{cols:"12"},{default:l(()=>[e(me,{modelValue:t(B),"onUpdate:modelValue":a[5]||(a[5]=s=>M(B)?B.value=s:null),"error-messages":t(_).observation,label:"Observação",variant:"outlined",color:"primary",rows:"5",maxlength:"500",counter:""},null,8,["modelValue","error-messages"])]),_:1})]),_:1}),e(C,null,{default:l(()=>[e(r,{cols:"12",md:"12"},{default:l(()=>[e(L,{modelValue:t(R),"onUpdate:modelValue":a[6]||(a[6]=s=>M(R)?R.value=s:null),"error-messages":t(_).priority_id,items:t(m).priori,label:"Prioridade","item-title":"name","item-value":"id"},null,8,["modelValue","error-messages","items"])]),_:1})]),_:1}),S.value?(h(),le(C,{key:0},{default:l(()=>[e(r,{cols:"12"},{default:l(()=>[e(me,{modelValue:t(y),"onUpdate:modelValue":a[7]||(a[7]=s=>M(y)?y.value=s:null),"error-messages":t(_).priority_justification,label:"Justificativa da Prioridade",variant:"outlined",color:"primary",rows:"5",maxlength:"500",counter:""},null,8,["modelValue","error-messages"])]),_:1})]),_:1})):de("",!0),e(C,null,{default:l(()=>[e(r,{cols:"12"},{default:l(()=>[e(cl,{modelValue:t(W),"onUpdate:modelValue":a[8]||(a[8]=s=>M(W)?W.value=s:null),label:"Anexos do chamado",multiple:"","error-messages":t(_).files,"show-size":""},null,8,["modelValue","error-messages"])]),_:1})]),_:1}),e(C,{justify:"end"},{default:l(()=>[e(r,{cols:"12",md:"auto"},{default:l(()=>[e(F,{flat:"",text:"Cancelar",onClick:a[9]||(a[9]=s=>$("cancel"))})]),_:1}),e(r,{cols:"12",md:"auto"},{default:l(()=>[e(F,{type:"submit",color:"primary",flat:"",loading:t(I),text:"Adicionar"},null,8,["loading"])]),_:1})]),_:1})]),_:1})]),_:1},8,["onSubmit"])]))}},Ut={__name:"TaskEditForm",props:{task:{type:Object,required:!0}},emits:["cancel","edit"],setup(w,{emit:$}){const o=w,m=qe(),z=[{label:"Grãos",value:1},{label:"Proteína",value:2}],D=[{label:"Algo que funcionava, parou de funcionar?",value:1},{label:"Fazer uma solicitação, algo novo (melhoria)?",value:2}],{handleSubmit:T,errors:i,isSubmitting:G,setFieldValue:R,setErrors:O}=tl({validationSchema:Qe({segment:ue().required().label("Segmento"),task_type:ue().required().label("Tipo de chamado"),task_code:oe().required().label("Número do chamado"),name:oe().required().label("Título"),system_screen:oe().required().label("Tela"),sequence:ue().nullable().label("Sequência"),description:oe().required().label("Descrição"),owner_id:ue().required().label("Solicitante"),responsible_id:ue().required("Responsável é obrigatório").typeError("Responsável é obrigatório"),task_status_id:ue().required().label("Status do Chamado"),priority_id:ue().required().label("Prioridade do Chamado"),complexity_id:ue().nullable().label("Complexidade do Chamado"),observation:oe().nullable().label("Observação"),created_at:Je().nullable().label("Data de Criação"),expected_date:Je().nullable().label("Data de Criação").transform((Q,c)=>c===""?null:Q),finish_date:Je().nullable().label("Data de Conclusão").transform((Q,c)=>c===""?null:Q),priority_justification:oe().nullable().label("Justificativa da Prioridade"),complexity_justification:oe().nullable().label("Justificativa da Complexidade"),status:il().required().label("Status")}),initialValues:{segment:o.task.segment,task_type:o.task.task_type,task_code:o.task.task_code,name:o.task.name,description:o.task.description,owner_id:o.task.owner_id,responsible_id:o.task.responsible_id,task_status_id:o.task.task_status_id,system_screen:o.task.system_screen,sequence:o.task.sequence,observation:o.task.observation,priority_id:o.task.priority_id,complexity_id:o.task.complexity_id,priority_justification:o.task.priority_justification,complexity_justification:o.task.complexity_justification,finish_date:o.task.finish_date?o.task.finish_date.split("T")[0]:null,expected_date:o.task.expected_date?o.task.expected_date.split("T")[0]:null,created_at:o.task.created_at?o.task.created_at.split("T")[0]:null,status:o.task.status}}),S={complexityRef:n(null),complexityJustificationRef:n(null),responsibleRef:n(null)},q=()=>{i.responsible_id?Be(()=>{S.responsibleRef.value.focus(),S.responsibleRef.value.$el.scrollIntoView({behavior:"smooth",block:"center"})}):i.complexity_id?Be(()=>{S.complexityRef.value.focus(),S.complexityRef.value.$el.scrollIntoView({behavior:"smooth",block:"center"})}):i.complexity_justification&&Be(()=>{S.complexityJustificationRef.value.focus(),S.complexityJustificationRef.value.$el.scrollIntoView({behavior:"smooth",block:"center"})})};ne(i,Q=>{console.log(i),q()});const A=T(async Q=>{ke.value||delete Q.priority_justification,se.value||(Q.expected_date=null),fe.value||(Q.finish_date=null),console.log("Payload being sent to the backend:",Q),await m.updateTask(o.task.id,Q),$("edit")}),_=n(""),{value:I}=k("segment"),{value:E}=k("priority_id"),{value:J}=k("complexity_id"),{value:K}=k("name"),{value:H}=k("task_code"),{value:j}=k("task_type"),{value:x}=k("description"),{value:B}=k("owner_id"),{value:y}=k("responsible_id"),{value:W}=k("task_status_id"),{value:b}=k("system_screen"),{value:a}=k("sequence"),{value:s}=k("observation"),{value:te}=k("priority_justification"),{value:ie}=k("complexity_justification"),{value:se}=k("expected_date"),{value:fe}=k("finish_date"),{value:ge}=k("created_at"),{value:re}=k("status"),ke=Z(()=>{const Q=m.priori.find(c=>c.id===E.value);return Q&&Q.justify});return ne(E,Q=>{ke.value?R("priority_justification",te.value||""):(te.value="",O({priority_justification:void 0}))}),(Q,c)=>(h(),N("div",null,[_.value?(h(),le(ml,{key:0,color:"error",class:"mb-2"},{default:l(()=>[U(X(_.value),1)]),_:1})):de("",!0),e(Ze,{onSubmit:Ye(t(A),["prevent"])},{default:l(()=>[e(Me,null,{default:l(()=>[e(C,null,{default:l(()=>[e(r,{cols:"6"},{default:l(()=>[e(L,{modelValue:t(I),"onUpdate:modelValue":c[0]||(c[0]=p=>M(I)?I.value=p:null),"error-messages":t(i).segment,items:z,label:"Segmento","item-title":"label","item-value":"value"},null,8,["modelValue","error-messages"])]),_:1}),e(r,{cols:"6"},{default:l(()=>[e(L,{modelValue:t(j),"onUpdate:modelValue":c[1]||(c[1]=p=>M(j)?j.value=p:null),"error-messages":t(i).task_type,items:D,label:"Tipo de chamado","item-title":"label","item-value":"value"},null,8,["modelValue","error-messages"])]),_:1})]),_:1}),e(C,null,{default:l(()=>[e(r,{cols:"6"},{default:l(()=>[e(ee,{modelValue:t(H),"onUpdate:modelValue":c[2]||(c[2]=p=>M(H)?H.value=p:null),"error-messages":t(i).task_code,label:"Número do chamado",variant:"outlined",color:"primary",disabled:""},null,8,["modelValue","error-messages"])]),_:1}),e(r,{cols:"6"},{default:l(()=>[e(ee,{modelValue:t(K),"onUpdate:modelValue":c[3]||(c[3]=p=>M(K)?K.value=p:null),"error-messages":t(i).name,label:"Título",variant:"outlined",color:"primary",maxlength:"60",counter:""},null,8,["modelValue","error-messages"])]),_:1})]),_:1}),e(C,null,{default:l(()=>[e(r,{cols:"6"},{default:l(()=>[e(ee,{modelValue:t(b),"onUpdate:modelValue":c[4]||(c[4]=p=>M(b)?b.value=p:null),"error-messages":t(i).system_screen,label:"Tela",variant:"outlined",color:"primary",maxlength:"60",counter:""},null,8,["modelValue","error-messages"])]),_:1}),e(r,{cols:"6"},{default:l(()=>[e(ee,{modelValue:t(a),"onUpdate:modelValue":c[5]||(c[5]=p=>M(a)?a.value=p:null),"error-messages":t(i).sequence,label:"Sequência",variant:"outlined",color:"primary",maxlength:"10",counter:""},null,8,["modelValue","error-messages"])]),_:1})]),_:1}),e(C,null,{default:l(()=>[e(r,{cols:"12"},{default:l(()=>[e(me,{modelValue:t(x),"onUpdate:modelValue":c[6]||(c[6]=p=>M(x)?x.value=p:null),"error-messages":t(i).description,label:"Descrição",variant:"outlined",color:"primary",rows:"5",maxlength:"500",counter:""},null,8,["modelValue","error-messages"])]),_:1})]),_:1}),e(C,null,{default:l(()=>[e(r,{cols:"6"},{default:l(()=>[e(L,{modelValue:t(B),"onUpdate:modelValue":c[7]||(c[7]=p=>M(B)?B.value=p:null),"error-messages":t(i).owner_id,items:t(m).users,label:"Solicitante","item-title":"first_name","item-value":"id",disabled:""},null,8,["modelValue","error-messages","items"])]),_:1}),e(r,{cols:"6"},{default:l(()=>[e(ee,{modelValue:t(ge),"onUpdate:modelValue":c[8]||(c[8]=p=>M(ge)?ge.value=p:null),"error-messages":t(i).created_at,label:"Data de Criação",variant:"outlined",type:"date",disabled:""},null,8,["modelValue","error-messages"])]),_:1})]),_:1}),e(C,null,{default:l(()=>[e(r,{cols:"6"},{default:l(()=>[e(L,{modelValue:t(W),"onUpdate:modelValue":c[9]||(c[9]=p=>M(W)?W.value=p:null),"error-messages":t(i).task_status_id,items:t(m).taskStatus,label:"Status do Chamado","item-title":"name","item-value":"id"},null,8,["modelValue","error-messages","items"])]),_:1}),e(r,{cols:"6"},{default:l(()=>[e(L,{modelValue:t(y),"onUpdate:modelValue":c[10]||(c[10]=p=>M(y)?y.value=p:null),"error-messages":t(i).responsible_id,items:t(m).users,label:"Responsável","item-title":"first_name","item-value":"id",ref:"responsibleRef"},null,8,["modelValue","error-messages","items"])]),_:1})]),_:1}),e(C,null,{default:l(()=>[e(r,{cols:"12"},{default:l(()=>[e(me,{modelValue:t(s),"onUpdate:modelValue":c[11]||(c[11]=p=>M(s)?s.value=p:null),"error-messages":t(i).observation,label:"Observação",variant:"outlined",color:"primary",rows:"5",maxlength:"500",counter:""},null,8,["modelValue","error-messages"])]),_:1})]),_:1}),e(C,null,{default:l(()=>[e(r,{cols:"6"},{default:l(()=>[e(ee,{modelValue:t(se),"onUpdate:modelValue":c[12]||(c[12]=p=>M(se)?se.value=p:null),"error-messages":t(i).expected_date,label:"Data Esperada",variant:"outlined",type:"date"},null,8,["modelValue","error-messages"])]),_:1}),e(r,{cols:"6"},{default:l(()=>[e(ee,{modelValue:t(fe),"onUpdate:modelValue":c[13]||(c[13]=p=>M(fe)?fe.value=p:null),"error-messages":t(i).finish_date,label:"Data de Conclusão",variant:"outlined",type:"date"},null,8,["modelValue","error-messages"])]),_:1})]),_:1}),e(C,null,{default:l(()=>[e(r,{cols:"6"},{default:l(()=>[e(L,{modelValue:t(E),"onUpdate:modelValue":c[14]||(c[14]=p=>M(E)?E.value=p:null),"error-messages":t(i).priority_id,items:t(m).priori,label:"Prioridade","item-title":"name","item-value":"id"},null,8,["modelValue","error-messages","items"])]),_:1}),e(r,{cols:"6"},{default:l(()=>[e(me,{modelValue:t(te),"onUpdate:modelValue":c[15]||(c[15]=p=>M(te)?te.value=p:null),"error-messages":t(i).priority_justification,label:"Justificativa da Prioridade",variant:"outlined",color:"primary",rows:"5",maxlength:"500",counter:""},null,8,["modelValue","error-messages"])]),_:1})]),_:1}),e(C,null,{default:l(()=>[e(r,{cols:"6"},{default:l(()=>[e(L,{modelValue:t(J),"onUpdate:modelValue":c[16]||(c[16]=p=>M(J)?J.value=p:null),"error-messages":t(i).complexity_id,items:t(m).complexity,label:"Complexidade do Chamado","item-title":"name","item-value":"id",ref:"complexityRef"},null,8,["modelValue","error-messages","items"])]),_:1}),e(r,{cols:"6"},{default:l(()=>[e(me,{modelValue:t(ie),"onUpdate:modelValue":c[17]||(c[17]=p=>M(ie)?ie.value=p:null),"error-messages":t(i).complexity_justification,label:"Justificativa da Complexidade",variant:"outlined",color:"primary",rows:"5",ref:"complexityJustificationRef",maxlength:"500",counter:""},null,8,["modelValue","error-messages"])]),_:1})]),_:1}),e(C,null,{default:l(()=>[e(r,{cols:"12"},{default:l(()=>[e(el,{modelValue:t(re),"onUpdate:modelValue":c[18]||(c[18]=p=>M(re)?re.value=p:null),label:t(re)?"Ativo":"Inativo",color:"primary",inset:""},null,8,["modelValue","label"])]),_:1})]),_:1}),e(C,{justify:"end"},{default:l(()=>[e(r,{cols:"12",md:"auto"},{default:l(()=>[e(F,{flat:"",text:"Cancelar",onClick:c[19]||(c[19]=p=>$("cancel"))})]),_:1}),e(r,{cols:"12",md:"auto"},{default:l(()=>[e(F,{type:"submit",color:"primary",flat:"",loading:t(G),text:"Editar"},null,8,["loading"])]),_:1})]),_:1})]),_:1})]),_:1},8,["onSubmit"])]))}},Tt={__name:"TaskShowForm",props:{task:{type:Object,required:!0}},emits:["cancel"],setup(w,{emit:$}){const o=w,m=qe(),z=[{label:"Grãos",value:1},{label:"Proteína",value:2}],D=[{label:"Algo que funcionava, parou de funcionar!",value:1},{label:"Fazer uma solicitação, algo novo (melhoria)!",value:2}],T=n(o.task.segment),i=n(o.task.task_type),G=n(o.task.task_code),R=n(o.task.name),O=n(o.task.description),S=n(o.task.owner_id),q=n(o.task.responsible_id),A=n(o.task.task_status_id),_=n(o.task.system_screen),I=n(o.task.sequence),E=n(o.task.observation),J=n(o.task.priority_id),K=n(o.task.complexity_id),H=n(o.task.priority_justification),j=n(o.task.complexity_justification),x=n(o.task.finish_date?o.task.finish_date.split("T")[0]:null),B=n(o.task.expected_date?o.task.expected_date.split("T")[0]:null),y=n(o.task.created_at?o.task.created_at.split("T")[0]:null),W=n(o.task.status);return(b,a)=>(h(),N("div",null,[e(Me,null,{default:l(()=>[e(C,null,{default:l(()=>[e(r,{cols:"6"},{default:l(()=>[e(L,{modelValue:T.value,"onUpdate:modelValue":a[0]||(a[0]=s=>T.value=s),items:z,label:"Segmento","item-title":"label","item-value":"value",disabled:"",class:"custom-label"},null,8,["modelValue"])]),_:1}),e(r,{cols:"6"},{default:l(()=>[e(L,{modelValue:i.value,"onUpdate:modelValue":a[1]||(a[1]=s=>i.value=s),items:D,label:"Tipo de chamado","item-title":"label","item-value":"value",disabled:"",class:"custom-label"},null,8,["modelValue"])]),_:1})]),_:1}),e(C,null,{default:l(()=>[e(r,{cols:"6"},{default:l(()=>[e(ee,{modelValue:G.value,"onUpdate:modelValue":a[2]||(a[2]=s=>G.value=s),label:"Número do chamado",variant:"outlined",color:"primary",disabled:"",class:"custom-label"},null,8,["modelValue"])]),_:1}),e(r,{cols:"6"},{default:l(()=>[e(ee,{modelValue:R.value,"onUpdate:modelValue":a[3]||(a[3]=s=>R.value=s),label:"Título",variant:"outlined",color:"primary",readonly:"",class:"custom-label",rows:"2",maxlength:"60"},null,8,["modelValue"])]),_:1})]),_:1}),e(C,null,{default:l(()=>[e(r,{cols:"6"},{default:l(()=>[e(ee,{modelValue:_.value,"onUpdate:modelValue":a[4]||(a[4]=s=>_.value=s),label:"Tela",variant:"outlined",color:"primary",disabled:"",class:"custom-label"},null,8,["modelValue"])]),_:1}),e(r,{cols:"6"},{default:l(()=>[e(ee,{modelValue:I.value,"onUpdate:modelValue":a[5]||(a[5]=s=>I.value=s),label:"Sequência",variant:"outlined",color:"primary",maxlength:"10",counter:"",class:"custom-label"},null,8,["modelValue"])]),_:1})]),_:1}),e(C,null,{default:l(()=>[e(r,{cols:"12"},{default:l(()=>[e(me,{modelValue:O.value,"onUpdate:modelValue":a[6]||(a[6]=s=>O.value=s),label:"Descrição",variant:"outlined",color:"primary",rows:"5",readonly:"",class:"custom-label",maxlength:"150",counter:""},null,8,["modelValue"])]),_:1})]),_:1}),e(C,null,{default:l(()=>[e(r,{cols:"6"},{default:l(()=>[e(L,{modelValue:S.value,"onUpdate:modelValue":a[7]||(a[7]=s=>S.value=s),items:t(m).users,label:"Solicitante","item-title":"first_name","item-value":"id",disabled:"",class:"custom-label"},null,8,["modelValue","items"])]),_:1}),e(r,{cols:"6"},{default:l(()=>[e(ee,{modelValue:y.value,"onUpdate:modelValue":a[8]||(a[8]=s=>y.value=s),label:"Data de Criação",variant:"outlined",type:"date",disabled:"",class:"custom-label"},null,8,["modelValue"])]),_:1})]),_:1}),e(C,null,{default:l(()=>[e(r,{cols:"6"},{default:l(()=>[e(L,{modelValue:A.value,"onUpdate:modelValue":a[9]||(a[9]=s=>A.value=s),items:t(m).taskStatus,label:"Status do Chamado","item-title":"name","item-value":"id",disabled:"",class:"custom-label"},null,8,["modelValue","items"])]),_:1}),e(r,{cols:"6"},{default:l(()=>[e(L,{modelValue:q.value,"onUpdate:modelValue":a[10]||(a[10]=s=>q.value=s),items:t(m).users,label:"Responsável","item-title":"first_name","item-value":"id",disabled:"",class:"custom-label"},null,8,["modelValue","items"])]),_:1})]),_:1}),e(C,null,{default:l(()=>[e(r,{cols:"12"},{default:l(()=>[e(me,{modelValue:E.value,"onUpdate:modelValue":a[11]||(a[11]=s=>E.value=s),label:"Observação",variant:"outlined",color:"primary",rows:"5",readonly:"",class:"custom-label",maxlength:"500",counter:""},null,8,["modelValue"])]),_:1})]),_:1}),e(C,null,{default:l(()=>[e(r,{cols:"6"},{default:l(()=>[e(ee,{modelValue:B.value,"onUpdate:modelValue":a[12]||(a[12]=s=>B.value=s),label:"Data Esperada",variant:"outlined",type:"date",disabled:"",class:"custom-label"},null,8,["modelValue"])]),_:1}),e(r,{cols:"6"},{default:l(()=>[e(ee,{modelValue:x.value,"onUpdate:modelValue":a[13]||(a[13]=s=>x.value=s),label:"Data de Conclusão",variant:"outlined",type:"date",disabled:"",class:"custom-label"},null,8,["modelValue"])]),_:1})]),_:1}),e(C,null,{default:l(()=>[e(r,{cols:"6"},{default:l(()=>[e(L,{modelValue:J.value,"onUpdate:modelValue":a[14]||(a[14]=s=>J.value=s),items:t(m).priori,label:"Prioridade","item-title":"name","item-value":"id",disabled:"",class:"custom-label"},null,8,["modelValue","items"])]),_:1}),e(r,{cols:"6"},{default:l(()=>[e(me,{modelValue:H.value,"onUpdate:modelValue":a[15]||(a[15]=s=>H.value=s),label:"Justificativa da Prioridade",variant:"outlined",color:"primary",rows:"5",readonly:"",class:"custom-label",maxlength:"500",counter:""},null,8,["modelValue"])]),_:1})]),_:1}),e(C,null,{default:l(()=>[e(r,{cols:"6"},{default:l(()=>[e(L,{modelValue:K.value,"onUpdate:modelValue":a[16]||(a[16]=s=>K.value=s),items:t(m).complexity,label:"Complexidade do Chamado","item-title":"name","item-value":"id",disabled:"",class:"custom-label"},null,8,["modelValue","items"])]),_:1}),e(r,{cols:"6"},{default:l(()=>[e(me,{modelValue:j.value,"onUpdate:modelValue":a[17]||(a[17]=s=>j.value=s),label:"Justificativa da Complexidade",variant:"outlined",color:"primary",rows:"5",readonly:"",class:"custom-label",maxlength:"500",counter:""},null,8,["modelValue"])]),_:1})]),_:1}),e(C,null,{default:l(()=>[e(r,{cols:"12"},{default:l(()=>[e(el,{modelValue:W.value,"onUpdate:modelValue":a[18]||(a[18]=s=>W.value=s),label:W.value?"Ativo":"Inativo",color:"primary",inset:"",disabled:""},null,8,["modelValue","label"])]),_:1})]),_:1}),e(C,{justify:"end"},{default:l(()=>[e(r,{cols:"12",md:"auto"},{default:l(()=>[e(F,{flat:"",text:"Fechar",onClick:a[19]||(a[19]=s=>b.$emit("cancel"))})]),_:1})]),_:1})]),_:1})]))}},pl=Ml("chats",{state:()=>({messages:[]}),actions:{async fetchMessages(w,$=!1){try{let o=`/api/interactions/${w}`;$||(o+="?task_updated=1");const m=await Le.get(o);this.messages=m.data}catch(o){console.error("Error fetching messages:",o)}},async createInteraction(w,$,o){try{return(await Le.post("/api/interactions",{task_id:w,comment:$,user_id:o})).data}catch(m){console.error("Error creating interaction:",m)}},async uploadFile(w){try{return(await Le.post("/api/interaction-file",w,{headers:{"Content-Type":"multipart/form-data"}})).data}catch($){throw console.error("Error uploading file:",$),$}}}});const fl=w=>(We("data-v-3317e69d"),w=w(),Xe(),w),qt=fl(()=>d("span",{class:"text-h5"},"Notas de Trabalho",-1)),$t={class:"comment-text"},At={key:0},It=["href"],Mt={class:"text-right text-caption mt-2"},Dt={class:"email-text"},jt={class:"email-text"},Ft=fl(()=>d("span",{class:"text-h5"},"Adicionar Comentário",-1)),Pt={__name:"TaskChat",props:{taskId:{type:Number,required:!0},showChatModal:{type:Boolean,required:!0},userId:{type:Number,required:!0}},emits:["update:showChatModal"],setup(w,{emit:$}){const o=w,m=pl(),{messages:z}=Ue(m),D=n(!1),T=n(!1),i=n(!1),G=Qe({comment:oe().required().label("Comentário"),files:rl().of(dl()).nullable()}),{handleSubmit:R,errors:O,isSubmitting:S,resetForm:q}=tl({validationSchema:G,initialValues:{comment:"",files:[]}}),A=R(async j=>{try{const x=await m.createInteraction(o.taskId,j.comment,o.userId);if(j.files&&j.files.length>0){const B=new FormData;B.append("interaction_id",x.id);for(const y of j.files)B.append("files[]",y);await m.uploadFile(B)}await m.fetchMessages(o.taskId,i.value),T.value=!1,$("update:showChatModal",!1)}catch(x){console.error("Erro ao adicionar comentário ou fazer upload dos arquivos:",x)}}),{value:_}=k("comment"),{value:I}=k("files");ne(()=>o.showChatModal,async j=>{j?(D.value=!0,await m.fetchMessages(o.taskId,i.value)):D.value=!1}),ne(i,async j=>{await m.fetchMessages(o.taskId,j)});const E=()=>{i.value=!1,$("update:showChatModal",!1)},J=()=>{q(),T.value=!0},K=j=>{const x={year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"};return new Date(j).toLocaleDateString("pt-BR",x)},H=Z(()=>[...z.value].sort((j,x)=>x.id-j.id));return(j,x)=>{const B=Dl("v-list-item-content");return h(),le(_e,{modelValue:D.value,"onUpdate:modelValue":x[5]||(x[5]=y=>D.value=y),"max-width":"800px",persistent:""},{default:l(()=>[e(ce,null,{default:l(()=>[e(Ve,null,{default:l(()=>[qt]),_:1}),e(pe,null,{default:l(()=>[e(Me,null,{default:l(()=>[e(C,null,{default:l(()=>[(h(!0),N(Te,null,Ne(H.value,(y,W)=>(h(),le(r,{key:W,cols:"12"},{default:l(()=>[e(ce,{class:"mb-3"},{default:l(()=>[e(pe,null,{default:l(()=>[d("div",$t,X(y.comment),1),y.interaction_files&&y.interaction_files.length?(h(),N("div",At,[e(Se),e(jl,null,{default:l(()=>[(h(!0),N(Te,null,Ne(y.interaction_files,(b,a)=>(h(),le(we,{key:a},{default:l(()=>[e(B,null,{default:l(()=>[e(Fl,null,{default:l(()=>[d("a",{href:t(vl)(b.path),target:"_blank"},X(b.name),9,It)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:2},1024)])):de("",!0),d("div",Mt,[d("span",Dt,X(y.user_email),1),U(" - "),d("span",jt,X(K(y.created_at)),1)])]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})]),_:1}),e(Ie,null,{default:l(()=>[e(el,{modelValue:i.value,"onUpdate:modelValue":x[0]||(x[0]=y=>i.value=y),label:"Mostrar Atualizações do Chamado?"},null,8,["modelValue"]),e(F,{color:"primary",onClick:J},{default:l(()=>[U("Adicionar Comentário")]),_:1}),e(F,{color:"secondary",onClick:E},{default:l(()=>[U("Fechar")]),_:1})]),_:1})]),_:1}),e(_e,{modelValue:T.value,"onUpdate:modelValue":x[4]||(x[4]=y=>T.value=y),"max-width":"500px",persistent:""},{default:l(()=>[e(ce,null,{default:l(()=>[e(Ve,null,{default:l(()=>[Ft]),_:1}),e(pe,null,{default:l(()=>[e(Ze,{onSubmit:Ye(t(A),["prevent"])},{default:l(()=>[e(me,{modelValue:t(_),"onUpdate:modelValue":x[1]||(x[1]=y=>M(_)?_.value=y:null),label:"Comentário","error-messages":t(O).comment},null,8,["modelValue","error-messages"]),e(cl,{modelValue:t(I),"onUpdate:modelValue":x[2]||(x[2]=y=>M(I)?I.value=y:null),label:"Selecionar Arquivos","error-messages":t(O).files,"show-size":"",multiple:""},null,8,["modelValue","error-messages"])]),_:1},8,["onSubmit"])]),_:1}),e(Ie,null,{default:l(()=>[e(F,{color:"blue darken-1",text:"",onClick:x[3]||(x[3]=y=>T.value=!1)},{default:l(()=>[U("Cancelar")]),_:1}),e(F,{color:"blue darken-1",text:"",loading:t(S),onClick:t(A)},{default:l(()=>[U("Adicionar")]),_:1},8,["loading","onClick"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1},8,["modelValue"])}}},sl=ll(Pt,[["__scopeId","data-v-3317e69d"]]),Rt=d("span",{class:"text-h5"},"Anexos do Chamado",-1),Et=["href"],Ot={__name:"TaskAttachments",props:{taskId:{type:Number,required:!0},showAttachmentsModal:{type:Boolean,required:!0}},emits:["update:showAttachmentsModal"],setup(w,{emit:$}){const o=w,m=qe(),{taskFiles:z}=Ue(m),D=n(!1),T=n(!1),i=n(null);ne(()=>o.showAttachmentsModal,async q=>{q?(await m.getTaskFiles(o.taskId),D.value=!0):D.value=!1});const G=()=>{$("update:showAttachmentsModal",!1)},R=q=>{i.value=q,T.value=!0},O=()=>{T.value=!1},S=async q=>{await m.deleteTaskFile(q),await m.getTaskFiles(o.taskId),O()};return(q,A)=>(h(),N(Te,null,[e(_e,{modelValue:D.value,"onUpdate:modelValue":A[0]||(A[0]=_=>D.value=_),"max-width":"800px",persistent:""},{default:l(()=>[e(ce,null,{default:l(()=>[e(Ve,null,{default:l(()=>[Rt]),_:1}),e(pe,null,{default:l(()=>[e(Me,null,{default:l(()=>[e(C,null,{default:l(()=>[(h(!0),N(Te,null,Ne(t(z),(_,I)=>(h(),le(r,{key:I,cols:"12"},{default:l(()=>[e(ce,{class:"mb-3"},{default:l(()=>[e(pe,null,{default:l(()=>[d("a",{href:t(vl)(_.path),target:"_blank"},X(_.name),9,Et),e(F,{icon:"",onClick:E=>R(_.id)},{default:l(()=>[e(t(wl))]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})]),_:1}),e(Ie,null,{default:l(()=>[e(F,{color:"secondary",onClick:G},{default:l(()=>[U("Fechar")]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(_e,{modelValue:T.value,"onUpdate:modelValue":A[2]||(A[2]=_=>T.value=_),"max-width":"400px"},{default:l(()=>[e(ce,null,{default:l(()=>[e(Ve,{class:"headline"},{default:l(()=>[U("Confirmação")]),_:1}),e(pe,null,{default:l(()=>[U("Deseja realmente excluir esse arquivo?")]),_:1}),e(Ie,null,{default:l(()=>[e(F,{color:"red darken-1",text:"",onClick:O},{default:l(()=>[U("Cancelar")]),_:1}),e(F,{color:"green darken-1",text:"",onClick:A[1]||(A[1]=_=>S(i.value))},{default:l(()=>[U("Confirmar")]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])],64))}};const _l=w=>(We("data-v-40876769"),w=w(),Xe(),w),Nt={class:"mb-5 pb-5 border-b border-opacity-100"},zt=_l(()=>d("label",{class:"mr-4"},"Segmento:",-1)),Jt=_l(()=>d("span",{class:"text-h5"},"Adicionar Nota de Trabalho",-1)),Bt={__name:"index",setup(w){var De;const $=nl(),o=He(),m=qe(),{pagination:z}=Ue(m),{toShow:D,toEdit:T,toDelete:i}=Ue(m),G=pl();Ue(G);const{isLoading:R}=Ae(m.getTasks());Ae(m.getPriorities()),Ae(m.getComplexities()),Ae(m.getTasksStatus()),Ae(m.getUsers()),n({});const O=Z({get(){return!!Object.keys(T.value).length},set(g){g||(T.value={})}}),S=Z({get(){return!!Object.keys(D.value).length},set(g){g||(D.value={})}}),q=Z({get(){return!!Object.keys(i.value).length},set(g){g||(i.value={})}}),A=n(!1);async function _(g){A.value=!0,await m.deleteTask(g.id),i.value={},A.value=!1}const I=n(!1),E=n(0),J=n(!1),K=n(""),H=n(o.user.id),j=g=>{g&&g.id&&(E.value=g.id,I.value=!0)},x=g=>{g&&g.id&&(E.value=g.id,J.value=!0)},B=async()=>{await G.addMessage(E.value,K.value,H.value),K.value="",J.value=!1},y=n(!1),W=g=>{g&&g.id&&(E.value=g.id,y.value=!0)},b=n(""),a=n(!1),s=n(((De=o.user)==null?void 0:De.default_segment)||"0"),te=n(null),ie=n(null),se=n(null),fe=n(null),ge=n(null),re=Z(()=>({priority:te.value||null,complexity:ie.value||null,taskStatus:se.value||null,userResponsible:fe.value||null,userOwner:ge.value||null})),ke=g=>{console.log("Filters received:",g),te.value=g.priority||null,ie.value=g.complexity||null,se.value=g.taskStatus||null,fe.value=g.userResponsible||null,ge.value=g.userOwner||null,console.log("Updated Filters:",re.value),p(z.value.current_page)};function Q(g,P){let f;return function(...Y){clearTimeout(f),f=setTimeout(()=>g(...Y),P)}}const c=async()=>{try{await o.updateUserSegment(s.value),p(z.value.current_page)}catch(g){console.error("Failed to update user segment:",g)}},p=Q(async()=>{const g=z.value.current_page,P=b.value||"";console.log("Sending request with filters:",re.value),await m.getTasks(P,s.value,g,re.value)},2e3);return ne([b,s,re],()=>{console.log("Filters or page changed, fetching tasks..."),p(z.value.current_page)},{deep:!0}),ne(()=>z.value.current_page,()=>{p()}),Ke(()=>{const g=$.query.search||"";g?(a.value=!0,m.getTasks(g,s.value,z.value.current_page,re.value).then(()=>{a.value=!1})):p(z.value.current_page)}),ne(b,g=>{m.getTasks(g)}),(g,P)=>(h(),N("div",null,[d("div",Nt,[e(C,{align:"center",justify:"space-between"},{default:l(()=>[e(r,{cols:"12",lg:"3",md:"4"},{default:l(()=>[e(ee,{density:"compact",modelValue:b.value,"onUpdate:modelValue":P[0]||(P[0]=f=>b.value=f),label:"Pesquisar Chamados","append-inner-icon":"mdi-magnify","hide-details":"",variant:"outlined"},null,8,["modelValue"])]),_:1}),e(r,{cols:"12",lg:"6",md:"4",class:"d-flex align-center"},{default:l(()=>[zt,e(Pl,{modelValue:s.value,"onUpdate:modelValue":P[1]||(P[1]=f=>s.value=f),onChange:c,row:"",inline:"",class:"radio-button"},{default:l(()=>[e(Ge,{label:"Todos",value:"0",class:"mr-2"}),e(Ge,{label:"Grãos",value:"1",class:"mr-2"}),e(Ge,{label:"Proteína",value:"2"})]),_:1},8,["modelValue"])]),_:1}),e(r,{cols:"12",lg:"3",md:"4",class:"text-right"},{default:l(()=>[e(_e,{width:"800",persistent:""},{activator:l(({props:f})=>[e(F,ye({flat:"",color:"primary"},f),{default:l(()=>[U("Novo Chamado")]),_:2},1040)]),default:l(({isActive:f})=>[e(ce,{width:"800"},{default:l(()=>[e(Ve,null,{default:l(()=>[U("Adicionar chamado")]),_:1}),e(pe,null,{default:l(()=>[e(St,{onAdd:Y=>f.value=!1,onCancel:Y=>f.value=!1},null,8,["onAdd","onCancel"])]),_:2},1024)]),_:2},1024)]),_:1})]),_:1})]),_:1})]),t(R)?(h(),le(El,{key:0,width:3,color:"primary",indeterminate:""})):(h(),N(Te,{key:1},[e(wt,{onOpenChat:j,onAddNote:x,onOpenAttachments:W,"onUpdate:filters":ke}),e(_e,{modelValue:S.value,"onUpdate:modelValue":P[2]||(P[2]=f=>S.value=f),width:"800",persistent:""},{default:l(({isActive:f})=>[e(ce,{width:"800"},{default:l(()=>[e(Ve,null,{default:l(()=>[U("Visualizar chamado")]),_:1}),e(pe,null,{default:l(()=>[e(Tt,{task:t(D),onCancel:Y=>f.value=!1,onShow:Y=>f.value=!1},null,8,["task","onCancel","onShow"])]),_:2},1024)]),_:2},1024)]),_:1},8,["modelValue"]),e(_e,{modelValue:O.value,"onUpdate:modelValue":P[3]||(P[3]=f=>O.value=f),width:"800",persistent:""},{default:l(({isActive:f})=>[e(ce,{width:"800"},{default:l(()=>[e(Ve,null,{default:l(()=>[U("Editar chamado")]),_:1}),e(pe,null,{default:l(()=>[e(Ut,{task:t(T),onCancel:Y=>f.value=!1,onEdit:Y=>f.value=!1},null,8,["task","onCancel","onEdit"])]),_:2},1024)]),_:2},1024)]),_:1},8,["modelValue"]),e(_e,{modelValue:q.value,"onUpdate:modelValue":P[5]||(P[5]=f=>q.value=f),width:"800",persistent:""},{default:l(({isActive:f})=>[e(ce,{"prepend-icon":t(ul),title:"Você tem certeza que deseja deletar este chamado?"},{actions:l(()=>[e(Rl),e(F,{onClick:Y=>f.value=!1},{default:l(()=>[U("Cancelar")]),_:2},1032,["onClick"]),e(F,{onClick:P[4]||(P[4]=Y=>_(t(i))),variant:"tonal",color:"error",loading:A.value},{default:l(()=>[U("Deletar")]),_:1},8,["loading"])]),_:2},1032,["prepend-icon"])]),_:1},8,["modelValue"])],64)),e(sl,{taskId:E.value,showChatModal:I.value,userId:H.value,"onUpdate:showChatModal":P[6]||(P[6]=f=>I.value=f)},null,8,["taskId","showChatModal","userId"]),e(_e,{modelValue:J.value,"onUpdate:modelValue":P[9]||(P[9]=f=>J.value=f),"max-width":"500px",persistent:""},{default:l(()=>[e(ce,null,{default:l(()=>[e(Ve,null,{default:l(()=>[Jt]),_:1}),e(pe,null,{default:l(()=>[e(sl,{taskId:E.value,showChatModal:I.value,userId:H.value,"onUpdate:showChatModal":P[7]||(P[7]=f=>I.value=f)},null,8,["taskId","showChatModal","userId"])]),_:1}),e(Ie,null,{default:l(()=>[e(F,{color:"blue darken-1",text:"",onClick:P[8]||(P[8]=f=>J.value=!1)},{default:l(()=>[U("Cancelar")]),_:1}),e(F,{color:"blue darken-1",text:"",onClick:B},{default:l(()=>[U("Adicionar")]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(Ot,{taskId:E.value,showAttachmentsModal:y.value,"onUpdate:showAttachmentsModal":P[10]||(P[10]=f=>y.value=f)},null,8,["taskId","showAttachmentsModal"])]))}},Xt=ll(Bt,[["__scopeId","data-v-40876769"]]);export{Xt as default};
