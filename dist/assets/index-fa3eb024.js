import{P as Re,i as Ue,N as ze,j as Je,k as Oe}from"./vue-tabler-icons.es-bb8b0475.js";import{a3 as Me,a4 as z,a5 as ie,o as $,e as H,w as t,a as f,c as K,q as pe,an as Be,t as O,d as E,i as Le,l as ne,b as e,V as T,M as Ce,N as Se,p as ee,ao as $e,z as se,y as a,F as ue,a6 as Ge,u as Ae,L as P,B as te,ap as He,a7 as he,aq as B,a8 as J,ak as Ie,ar as qe,as as je,Q as le,a9 as Fe,a0 as ve,ai as y,_ as m,at as Q,ab as v,aa as X,au as Y,av as Ee,S as Pe,ac as Ve,aw as be,al as Qe,ax as ge,r as Ke,ag as oe,ah as Z,af as W,I as We,G as Xe,m as Ye,j as Ze,ay as _e,ae,ad as re,T as et,aj as tt}from"./index-6bd7ca57.js";import{a as c,u as xe}from"./vee-validate.esm-d133aaf5.js";const de=Me("tasks",{state:()=>({tasks:[],priori:[],complexity:[],users:[],taskStatus:[],toEdit:{},toDelete:{},toShowChat:{},toAddChat:{},taskFiles:[]}),actions:{async getTasks(){try{const s=await z.get("api/tasks");this.tasks=s.data.data}catch(s){console.error("Error fetching tasks:",s)}},async getPriorities(){try{const s=await z.get("api/priorities");this.priori=s.data.data}catch(s){console.error("Error fetching priorities:",s)}},async getComplexities(){try{const s=await z.get("api/complexities");this.complexity=s.data.data}catch(s){console.error("Error fetching complexities:",s)}},async getUsers(){try{const s=await z.get("api/users");this.users=s.data.data}catch(s){console.error("Error fetching users:",s)}},async getTasksStatus(){try{const s=await z.get("api/tasks-status");this.taskStatus=s.data.data}catch(s){console.error("Error fetching task statuses:",s)}},async storeTask(s,o){try{const n=(await z.post("api/tasks",s)).data;if(await this.getTasks(),console.log("task",n),o&&o.length>0){const U=new FormData;U.append("task_id",n.id);for(const S of o)U.append("files[]",S);await this.uploadTaskFile(U)}return n}catch(l){console.error("Error storing task:",l)}},async updateTask(s,o){try{const n=(await z.put(`api/tasks/${s}`,o)).data.data,U=this.tasks.findIndex(S=>S.id===s);this.tasks.splice(U,1,n),await this.getTasks()}catch(l){console.error("Error updating task:",l)}},async deleteTask(s){try{await z.delete(`api/tasks/${s}`);const o=this.tasks.findIndex(l=>l.id===s);this.tasks.splice(o,1)}catch(o){console.error("Error deleting task:",o)}},async uploadTaskFile(s){console.log("upload",s);try{return(await z.post("api/task-file",s,{headers:{"Content-Type":"multipart/form-data"}})).data}catch(o){throw console.error("Error uploading task file:",o),o}},async getTaskFiles(s){try{const o=await z.get(`api/task-file/${s}`);this.taskFiles=o.data.data}catch(o){console.error("Error fetching task files:",o)}},async deleteTaskFile(s){try{await z.delete(`api/task-file/${s}`);const o=this.taskFiles.findIndex(l=>l.id===s);o!==-1&&this.taskFiles.splice(o,1)}catch(o){console.error("Error deleting task file:",o)}}}}),at=f("thead",null,[f("tr",null,[f("th",{class:"text-left"},"Número do chamado"),f("th",{class:"text-left"},"Título"),f("th",{class:"text-left"},"Descrição"),f("th",{class:"text-left"},"Solicitante"),f("th",{class:"text-left"},"Responsável"),f("th",{class:"text-left"},"Status"),f("th",{class:"text-left"},"Prioridade"),f("th",{class:"text-left"},"Complexidade"),f("th",{class:"text-left"},"Ações"),f("th")])],-1),lt=E(" Default "),st={class:"text-right"},ot={class:"d-flex align-center"},rt={class:"text-right"},it={class:"d-flex align-center"},nt={class:"text-right"},ut={class:"d-flex align-center"},dt={setup(s){const o=de(),{tasks:l,toEdit:n,toDelete:U,taskFiles:S}=ie(o),A=r=>({color:r.color});return(r,q)=>($(),H(Ge,{class:"border-opacity-100"},{default:t(()=>[at,f("tbody",null,[($(!0),K(ue,null,pe(a(l),(u,I)=>{var V;return $(),K("tr",{key:I,style:Be(A(u.task_status))},[f("td",null,O(u.task_code),1),f("td",null,[E(O(u.name)+" ",1),u.default?($(),H(Le,{key:0,size:"small",variant:"tonal",color:"primary",class:"ml-2"},{default:t(()=>[lt]),_:1})):ne("",!0)]),f("td",null,O(u.description),1),f("td",null,O(u.user_owner.first_name),1),f("td",null,O(((V=u.user_responsible)==null?void 0:V.first_name)||"Nenhum responsável"),1),f("td",null,O(u.task_status.name),1),f("td",st,[f("div",ot,[e(se,{text:u.priority_justification},{activator:t(({props:k})=>[e(T,Ce(Se(k)),{default:t(()=>[f("span",ee(r.attrs,$e(r.on)),O(u.priority.name),17)]),_:2},1040)]),_:2},1032,["text"])])]),f("td",rt,[f("div",it,[e(se,{text:u.complexity_justification||"Aguardando análise"},{activator:t(({props:k})=>[e(T,Ce(Se(k)),{default:t(()=>{var M;return[f("span",ee(r.attrs,$e(r.on)),O(((M=u.complexity)==null?void 0:M.name)||"Aguardando análise"),17)]}),_:2},1040)]),_:2},1032,["text"])])]),f("td",nt,[f("div",ut,[e(se,{text:"Editar Chamado"},{activator:t(({props:k})=>[e(T,ee({icon:"",flat:"",onClick:M=>n.value=u},k),{default:t(()=>[e(a(Re),{"stroke-width":"1.5",size:"20",class:"text-primary"})]),_:2},1040,["onClick"])]),_:2},1024),e(se,{text:"Deletar Chamado"},{activator:t(({props:k})=>[e(T,ee({icon:"",flat:"",onClick:M=>U.value=u},k),{default:t(()=>[e(a(Ue),{"stroke-width":"1.5",size:"20",class:"text-error"})]),_:2},1040,["onClick"])]),_:2},1024),e(se,{text:"Consultar Notas de Trabalho"},{activator:t(({props:k})=>[e(T,ee({icon:"",flat:"",onClick:M=>r.$emit("openChat",u)},k),{default:t(()=>[e(a(ze),{"stroke-width":"1.5",size:"20",class:"text-primary"})]),_:2},1040,["onClick"])]),_:2},1024),e(se,{text:"Anexos"},{activator:t(({props:k})=>[e(T,ee({icon:"",flat:"",onClick:M=>r.$emit("openAttachments",u)},k),{default:t(()=>[e(a(Je),{"stroke-width":"1.5",size:"20",class:"text-primary"})]),_:2},1040,["onClick"])]),_:2},1024)])])],4)}),128))])]),_:1}))}},ct={emits:["cancel","add"],setup(s,{emit:o}){const l=Ae(),n=de();P([]);const U=[{label:"Grãos",value:1},{label:"Proteína",value:2}],S=[{label:"Algo que funcionava, parou de funcionar?",value:1},{label:"Fazer uma solicitação, algo novo (melhoria)?",value:2}],A=te(()=>{var C;return((C=n.priori.find(p=>p.is_default))==null?void 0:C.id)||null}),r=te(()=>{var C;return((C=n.taskStatus.find(p=>p.is_default))==null?void 0:C.id)||null}),{value:q}=c("segment",2),{value:u}=c("priority_id"),{value:I}=c("task_status_id");He(()=>{A.value&&!u.value&&(u.value=A.value),r.value&&!I.value&&(I.value=r.value)});const V=te(()=>{const C=n.priori.find(p=>p.id===u.value);return C&&C.justify}),k=te(()=>he({segment:B().required().label("Segmento"),task_type:B().required().label("Tipo de chamado"),name:J().required().label("Título"),system_screen:J().required().label("Tela"),description:J().required().label("Descrição"),owner_id:B().required().label("Solicitante"),task_status_id:B().required().label("Status do Chamado"),priority_id:B().required().label("Prioridade"),observation:J().nullable().label("Observação"),priority_justification:V.value?J().required().label("Justificativa da Prioridade"):J().label("Justificativa da Prioridade"),status:Ie().required().label("Status"),files:qe().of(je()).nullable()})),{handleSubmit:M,errors:j,isSubmitting:L}=xe({validationSchema:k,initialValues:{segment:1,task_type:"",name:"",system_screen:"",description:"",owner_id:l.user.id,responsible_id:"",task_status_id:r.value,priority_id:A.value,observation:"",created_at:"",expected_date:"",finish_date:"",priority_justification:"",status:!0,files:[]}}),F=M(async C=>{console.log("values",C);try{const p=R.value,h=await n.storeTask(C,p);o("add")}catch(p){console.error("Erro ao adicionar comentário ou fazer upload dos arquivos:",p)}}),x=P(""),{value:D}=c("name"),{value:b}=c("task_type"),{value:G}=c("system_screen"),{value:w}=c("description");c("owner_id"),c("responsible_id");const{value:g}=c("observation");c("created_at"),c("expected_date"),c("finish_date");const{value:_}=c("priority_justification");c("status");const{value:R}=c("files");return le(A,C=>{C&&!u.value&&(u.value=C)}),le(r,C=>{C&&!I.value&&(I.value=C)}),le(u,()=>{V.value||(_.value="")}),(C,p)=>($(),K("div",null,[x.value?($(),H(Fe,{key:0,color:"error",class:"mb-2"},{default:t(()=>[E(O(x.value),1)]),_:1})):ne("",!0),e(Ve,{onSubmit:Pe(a(F),["prevent"])},{default:t(()=>[e(ve,null,{default:t(()=>[e(y,null,{default:t(()=>[e(m,{cols:"12"},{default:t(()=>[e(Q,{modelValue:a(q),"onUpdate:modelValue":p[0]||(p[0]=h=>v(q)?q.value=h:null),"error-messages":a(j).segment,items:U,label:"Segmento","item-title":"label","item-value":"value"},null,8,["modelValue","error-messages"])]),_:1})]),_:1}),e(y,null,{default:t(()=>[e(m,{cols:"12"},{default:t(()=>[e(Q,{modelValue:a(b),"onUpdate:modelValue":p[1]||(p[1]=h=>v(b)?b.value=h:null),"error-messages":a(j).task_type,items:S,label:"Tipo de chamado","item-title":"label","item-value":"value"},null,8,["modelValue","error-messages"])]),_:1})]),_:1}),e(y,null,{default:t(()=>[e(m,{cols:"12"},{default:t(()=>[e(X,{modelValue:a(D),"onUpdate:modelValue":p[2]||(p[2]=h=>v(D)?D.value=h:null),"error-messages":a(j).name,label:"Título",variant:"outlined",color:"primary"},null,8,["modelValue","error-messages"])]),_:1})]),_:1}),e(y,null,{default:t(()=>[e(m,{cols:"12"},{default:t(()=>[e(X,{modelValue:a(G),"onUpdate:modelValue":p[3]||(p[3]=h=>v(G)?G.value=h:null),"error-messages":a(j).system_screen,label:"Tela",variant:"outlined",color:"primary"},null,8,["modelValue","error-messages"])]),_:1})]),_:1}),e(y,null,{default:t(()=>[e(m,{cols:"12"},{default:t(()=>[e(Y,{modelValue:a(w),"onUpdate:modelValue":p[4]||(p[4]=h=>v(w)?w.value=h:null),"error-messages":a(j).description,label:"Descrição",variant:"outlined",color:"primary",rows:"5"},null,8,["modelValue","error-messages"])]),_:1})]),_:1}),e(y,null,{default:t(()=>[e(m,{cols:"12"},{default:t(()=>[e(Y,{modelValue:a(g),"onUpdate:modelValue":p[5]||(p[5]=h=>v(g)?g.value=h:null),"error-messages":a(j).observation,label:"Observação",variant:"outlined",color:"primary",rows:"5"},null,8,["modelValue","error-messages"])]),_:1})]),_:1}),e(y,null,{default:t(()=>[e(m,{cols:"12",md:"12"},{default:t(()=>[e(Q,{modelValue:a(u),"onUpdate:modelValue":p[6]||(p[6]=h=>v(u)?u.value=h:null),"error-messages":a(j).priority_id,items:a(n).priori,label:"Prioridade","item-title":"name","item-value":"id"},null,8,["modelValue","error-messages","items"])]),_:1})]),_:1}),a(V)?($(),H(y,{key:0},{default:t(()=>[e(m,{cols:"12"},{default:t(()=>[e(Y,{modelValue:a(_),"onUpdate:modelValue":p[7]||(p[7]=h=>v(_)?_.value=h:null),"error-messages":a(j).priority_justification,label:"Justificativa da Prioridade",variant:"outlined",color:"primary",rows:"5"},null,8,["modelValue","error-messages"])]),_:1})]),_:1})):ne("",!0),e(y,null,{default:t(()=>[e(m,{cols:"12"},{default:t(()=>[e(Ee,{modelValue:a(R),"onUpdate:modelValue":p[8]||(p[8]=h=>v(R)?R.value=h:null),label:"Anexos do chamado",multiple:"","error-messages":a(j).files,"show-size":""},null,8,["modelValue","error-messages"])]),_:1})]),_:1}),e(y,{justify:"end"},{default:t(()=>[e(m,{cols:"12",md:"auto"},{default:t(()=>[e(T,{flat:"",text:"Cancelar",onClick:p[9]||(p[9]=h=>o("cancel"))})]),_:1}),e(m,{cols:"12",md:"auto"},{default:t(()=>[e(T,{type:"submit",color:"primary",flat:"",loading:a(L),text:"Adicionar"},null,8,["loading"])]),_:1})]),_:1})]),_:1})]),_:1},8,["onSubmit"])]))}},mt={props:{task:{type:Object,required:!0}},emits:["cancel","edit"],setup(s,{emit:o}){const l=s,n=de(),U=[{label:"Grãos",value:1},{label:"Proteína",value:2}],S=[{label:"É uma melhoria ?",value:1},{label:"É algo novo ?",value:2}],{handleSubmit:A,errors:r,isSubmitting:q,setFieldValue:u,setErrors:I}=xe({validationSchema:he({segment:B().required().label("Segmento"),task_type:B().required().label("Tipo de chamado"),task_code:J().required().label("Número do chamado"),name:J().required().label("Título"),system_screen:J().required().label("Tela"),description:J().required().label("Descrição"),owner_id:B().required().label("Solicitante"),responsible_id:B().required().label("Responsável"),task_status_id:B().required().label("Status do Chamado"),priority_id:B().required().label("Prioridade do Chamado"),complexity_id:B().required().label("Complexidade do Chamado"),observation:J().nullable().label("Observação"),created_at:be().nullable().label("Data de Criação"),expected_date:be().nullable().label("Data de Criação").transform((N,i)=>i===""?null:N),finish_date:be().nullable().label("Data de Conclusão").transform((N,i)=>i===""?null:N),priority_justification:J().nullable().label("Justificativa da Prioridade"),complexity_justification:J().nullable().label("Justificativa da Complexidade"),status:Ie().required().label("Status")}),initialValues:{segment:l.task.segment,task_type:l.task.task_type,task_code:l.task.task_code,name:l.task.name,description:l.task.description,owner_id:l.task.owner_id,responsible_id:l.task.responsible_id,task_status_id:l.task.task_status_id,system_screen:l.task.system_screen,observation:l.task.observation,priority_id:l.task.priority_id,complexity_id:l.task.complexity_id,priority_justification:l.task.priority_justification,complexity_justification:l.task.complexity_justification,finish_date:l.task.finish_date?l.task.finish_date.split("T")[0]:null,expected_date:l.task.expected_date?l.task.expected_date.split("T")[0]:null,created_at:l.task.created_at?l.task.created_at.split("T")[0]:null,status:l.task.status}}),V={complexityRef:P(null),complexityJustificationRef:P(null),responsibleRef:P(null)},k=()=>{r.responsible_id?ge(()=>{V.responsibleRef.value.focus(),V.responsibleRef.value.$el.scrollIntoView({behavior:"smooth",block:"center"})}):r.complexity_id?ge(()=>{V.complexityRef.value.focus(),V.complexityRef.value.$el.scrollIntoView({behavior:"smooth",block:"center"})}):r.complexity_justification&&ge(()=>{V.complexityJustificationRef.value.focus(),V.complexityJustificationRef.value.$el.scrollIntoView({behavior:"smooth",block:"center"})})};le(r,N=>{console.log(r),k()});const M=A(async N=>{we.value||delete N.priority_justification,ce.value||(N.expected_date=null),me.value||(N.finish_date=null),console.log("Payload being sent to the backend:",N),await n.updateTask(l.task.id,N),o("edit")}),j=P(""),{value:L}=c("segment"),{value:F}=c("priority_id"),{value:x}=c("complexity_id"),{value:D}=c("name"),{value:b}=c("task_code"),{value:G}=c("task_type"),{value:w}=c("description"),{value:g}=c("owner_id"),{value:_}=c("responsible_id"),{value:R}=c("task_status_id"),{value:C}=c("system_screen"),{value:p}=c("observation"),{value:h}=c("priority_justification"),{value:ye}=c("complexity_justification"),{value:ce}=c("expected_date"),{value:me}=c("finish_date"),{value:ke}=c("created_at"),{value:fe}=c("status"),we=te(()=>{const N=n.priori.find(i=>i.id===F.value);return N&&N.is_justify});return le(F,N=>{we.value?u("priority_justification",h.value||""):(h.value="",I({priority_justification:void 0}))}),(N,i)=>($(),K("div",null,[j.value?($(),H(Fe,{key:0,color:"error",class:"mb-2"},{default:t(()=>[E(O(j.value),1)]),_:1})):ne("",!0),e(Ve,{onSubmit:Pe(a(M),["prevent"])},{default:t(()=>[e(ve,null,{default:t(()=>[e(y,null,{default:t(()=>[e(m,{cols:"12"},{default:t(()=>[e(Q,{modelValue:a(L),"onUpdate:modelValue":i[0]||(i[0]=d=>v(L)?L.value=d:null),"error-messages":a(r).segment,items:U,label:"Segmento","item-title":"label","item-value":"value"},null,8,["modelValue","error-messages"])]),_:1})]),_:1}),e(y,null,{default:t(()=>[e(m,{cols:"12"},{default:t(()=>[e(Q,{modelValue:a(G),"onUpdate:modelValue":i[1]||(i[1]=d=>v(G)?G.value=d:null),"error-messages":a(r).task_type,items:S,label:"Tipo de chamado","item-title":"label","item-value":"value"},null,8,["modelValue","error-messages"])]),_:1})]),_:1}),e(y,null,{default:t(()=>[e(m,{cols:"12"},{default:t(()=>[e(X,{modelValue:a(b),"onUpdate:modelValue":i[2]||(i[2]=d=>v(b)?b.value=d:null),"error-messages":a(r).task_code,label:"Número do chamado",variant:"outlined",color:"primary",disabled:""},null,8,["modelValue","error-messages"])]),_:1})]),_:1}),e(y,null,{default:t(()=>[e(m,{cols:"12"},{default:t(()=>[e(X,{modelValue:a(D),"onUpdate:modelValue":i[3]||(i[3]=d=>v(D)?D.value=d:null),"error-messages":a(r).name,label:"Título",variant:"outlined",color:"primary"},null,8,["modelValue","error-messages"])]),_:1})]),_:1}),e(y,null,{default:t(()=>[e(m,{cols:"12"},{default:t(()=>[e(X,{modelValue:a(C),"onUpdate:modelValue":i[4]||(i[4]=d=>v(C)?C.value=d:null),"error-messages":a(r).system_screen,label:"Tela",variant:"outlined",color:"primary"},null,8,["modelValue","error-messages"])]),_:1})]),_:1}),e(y,null,{default:t(()=>[e(m,{cols:"12"},{default:t(()=>[e(Y,{modelValue:a(w),"onUpdate:modelValue":i[5]||(i[5]=d=>v(w)?w.value=d:null),"error-messages":a(r).description,label:"Descrição",variant:"outlined",color:"primary",rows:"5"},null,8,["modelValue","error-messages"])]),_:1})]),_:1}),e(y,null,{default:t(()=>[e(m,{cols:"12",md:"6"},{default:t(()=>[e(Q,{modelValue:a(g),"onUpdate:modelValue":i[6]||(i[6]=d=>v(g)?g.value=d:null),"error-messages":a(r).owner_id,items:a(n).users,label:"Solicitante","item-title":"first_name","item-value":"id",disabled:""},null,8,["modelValue","error-messages","items"])]),_:1}),e(m,{cols:"12",md:"6"},{default:t(()=>[e(X,{modelValue:a(ke),"onUpdate:modelValue":i[7]||(i[7]=d=>v(ke)?ke.value=d:null),"error-messages":a(r).created_at,label:"Data de Criação",variant:"outlined",type:"date",disabled:""},null,8,["modelValue","error-messages"])]),_:1})]),_:1}),e(y,null,{default:t(()=>[e(m,{cols:"12",md:"6"},{default:t(()=>[e(Q,{modelValue:a(R),"onUpdate:modelValue":i[8]||(i[8]=d=>v(R)?R.value=d:null),"error-messages":a(r).task_status_id,items:a(n).taskStatus,label:"Status do Chamado","item-title":"name","item-value":"id"},null,8,["modelValue","error-messages","items"])]),_:1}),e(m,{cols:"12",md:"6"},{default:t(()=>[e(Q,{modelValue:a(_),"onUpdate:modelValue":i[9]||(i[9]=d=>v(_)?_.value=d:null),"error-messages":a(r).responsible_id,items:a(n).users,label:"Responsável","item-title":"first_name","item-value":"id",ref:"responsibleRef"},null,8,["modelValue","error-messages","items"])]),_:1})]),_:1}),e(y,null,{default:t(()=>[e(m,{cols:"12"},{default:t(()=>[e(Y,{modelValue:a(p),"onUpdate:modelValue":i[10]||(i[10]=d=>v(p)?p.value=d:null),"error-messages":a(r).observation,label:"Observação",variant:"outlined",color:"primary",rows:"5"},null,8,["modelValue","error-messages"])]),_:1})]),_:1}),e(y,null,{default:t(()=>[e(m,{cols:"12",md:"6"},{default:t(()=>[e(X,{modelValue:a(ce),"onUpdate:modelValue":i[11]||(i[11]=d=>v(ce)?ce.value=d:null),"error-messages":a(r).expected_date,label:"Data Esperada",variant:"outlined",type:"date"},null,8,["modelValue","error-messages"])]),_:1}),e(m,{cols:"12",md:"6"},{default:t(()=>[e(X,{modelValue:a(me),"onUpdate:modelValue":i[12]||(i[12]=d=>v(me)?me.value=d:null),"error-messages":a(r).finish_date,label:"Data de Conclusão",variant:"outlined",type:"date"},null,8,["modelValue","error-messages"])]),_:1})]),_:1}),e(y,null,{default:t(()=>[e(m,{cols:"12",md:"12"},{default:t(()=>[e(Q,{modelValue:a(F),"onUpdate:modelValue":i[13]||(i[13]=d=>v(F)?F.value=d:null),"error-messages":a(r).priority_id,items:a(n).priori,label:"Prioridade","item-title":"name","item-value":"id"},null,8,["modelValue","error-messages","items"])]),_:1})]),_:1}),e(y,null,{default:t(()=>[e(m,{cols:"12"},{default:t(()=>[e(Y,{modelValue:a(h),"onUpdate:modelValue":i[14]||(i[14]=d=>v(h)?h.value=d:null),"error-messages":a(r).priority_justification,label:"Justificativa da Prioridade",variant:"outlined",color:"primary",rows:"5"},null,8,["modelValue","error-messages"])]),_:1})]),_:1}),e(y,null,{default:t(()=>[e(m,{cols:"12",md:"12"},{default:t(()=>[e(Q,{modelValue:a(x),"onUpdate:modelValue":i[15]||(i[15]=d=>v(x)?x.value=d:null),"error-messages":a(r).complexity_id,items:a(n).complexity,label:"Complexidade do Chamado","item-title":"name","item-value":"id",ref:"complexityRef"},null,8,["modelValue","error-messages","items"])]),_:1})]),_:1}),e(y,null,{default:t(()=>[e(m,{cols:"12"},{default:t(()=>[e(Y,{modelValue:a(ye),"onUpdate:modelValue":i[16]||(i[16]=d=>v(ye)?ye.value=d:null),"error-messages":a(r).complexity_justification,label:"Justificativa da Complexidade",variant:"outlined",color:"primary",rows:"5",ref:"complexityJustificationRef"},null,8,["modelValue","error-messages"])]),_:1})]),_:1}),e(y,null,{default:t(()=>[e(m,{cols:"12"},{default:t(()=>[e(Qe,{modelValue:a(fe),"onUpdate:modelValue":i[17]||(i[17]=d=>v(fe)?fe.value=d:null),label:a(fe)?"Ativo":"Inativo",color:"primary",inset:""},null,8,["modelValue","label"])]),_:1})]),_:1}),e(y,{justify:"end"},{default:t(()=>[e(m,{cols:"12",md:"auto"},{default:t(()=>[e(T,{flat:"",text:"Cancelar",onClick:i[18]||(i[18]=d=>o("cancel"))})]),_:1}),e(m,{cols:"12",md:"auto"},{default:t(()=>[e(T,{type:"submit",color:"primary",flat:"",loading:a(q),text:"Editar"},null,8,["loading"])]),_:1})]),_:1})]),_:1})]),_:1},8,["onSubmit"])]))}},De=Me("chats",{state:()=>({messages:[]}),actions:{async fetchMessages(s){try{const o=await z.get(`/api/interactions/${s}`);this.messages=o.data}catch(o){console.error("Error fetching messages:",o)}},async createInteraction(s,o,l){try{return(await z.post("/api/interactions",{task_id:s,comment:o,user_id:l})).data}catch(n){console.error("Error creating interaction:",n)}},async uploadFile(s){try{return(await z.post("/api/interaction-file",s,{headers:{"Content-Type":"multipart/form-data"}})).data}catch(o){throw console.error("Error uploading file:",o),o}}}});function Ne(s){return`http://localhost/storage/${s}`}const ft=f("span",{class:"text-h5"},"Notas de Trabalho",-1),pt={key:0},_t=["href"],vt=E("Adicionar Comentário"),yt=E("Fechar"),kt=f("span",{class:"text-h5"},"Adicionar Comentário",-1),bt=E("Cancelar"),gt=E("Adicionar"),Te={props:{taskId:{type:Number,required:!0},showChatModal:{type:Boolean,required:!0},userId:{type:Number,required:!0}},emits:["update:showChatModal"],setup(s,{emit:o}){const l=s,n=De(),{messages:U}=ie(n),S=P(!1),A=P(!1),r=he({comment:J().required().label("Comentário"),files:qe().of(je()).nullable()}),{handleSubmit:q,errors:u,isSubmitting:I}=xe({validationSchema:r,initialValues:{comment:"",files:[]}}),V=q(async F=>{try{const x=await n.createInteraction(l.taskId,F.comment,l.userId);if(F.files&&F.files.length>0){const D=new FormData;D.append("interaction_id",x.id);for(const b of F.files)D.append("files[]",b);await n.uploadFile(D)}await n.fetchMessages(l.taskId),A.value=!1,o("update:showChatModal",!1)}catch(x){console.error("Erro ao adicionar comentário ou fazer upload dos arquivos:",x)}}),{value:k}=c("comment"),{value:M}=c("files");le(()=>l.showChatModal,async F=>{F?(S.value=!0,await n.fetchMessages(l.taskId)):S.value=!1});const j=()=>{o("update:showChatModal",!1)},L=()=>{A.value=!0};return(F,x)=>{const D=Ke("v-list-item-content");return $(),H(ae,{modelValue:S.value,"onUpdate:modelValue":x[4]||(x[4]=b=>S.value=b),"max-width":"800px"},{default:t(()=>[e(W,null,{default:t(()=>[e(oe,null,{default:t(()=>[ft]),_:1}),e(Z,null,{default:t(()=>[e(ve,null,{default:t(()=>[e(y,null,{default:t(()=>[($(!0),K(ue,null,pe(a(U),(b,G)=>($(),H(m,{key:G,cols:"12"},{default:t(()=>[e(W,{class:"mb-3"},{default:t(()=>[e(Z,null,{default:t(()=>[E(O(b.comment)+" ",1),b.interaction_files&&b.interaction_files.length?($(),K("div",pt,[e(We),e(Xe,null,{default:t(()=>[($(!0),K(ue,null,pe(b.interaction_files,(w,g)=>($(),H(Ye,{key:g},{default:t(()=>[e(D,null,{default:t(()=>[e(Ze,null,{default:t(()=>[f("a",{href:a(Ne)(w.path),target:"_blank"},O(w.name),9,_t)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:2},1024)])):ne("",!0)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})]),_:1}),e(_e,null,{default:t(()=>[e(T,{color:"primary",onClick:L},{default:t(()=>[vt]),_:1}),e(T,{color:"secondary",onClick:j},{default:t(()=>[yt]),_:1})]),_:1})]),_:1}),e(ae,{modelValue:A.value,"onUpdate:modelValue":x[3]||(x[3]=b=>A.value=b),"max-width":"500px"},{default:t(()=>[e(W,null,{default:t(()=>[e(oe,null,{default:t(()=>[kt]),_:1}),e(Z,null,{default:t(()=>[e(Ve,{onSubmit:a(V)},{default:t(()=>[e(Y,{modelValue:a(k),"onUpdate:modelValue":x[0]||(x[0]=b=>v(k)?k.value=b:null),label:"Comentário","error-messages":a(u).comment},null,8,["modelValue","error-messages"]),e(Ee,{modelValue:a(M),"onUpdate:modelValue":x[1]||(x[1]=b=>v(M)?M.value=b:null),label:"Selecionar Arquivos","error-messages":a(u).files,"show-size":"",multiple:""},null,8,["modelValue","error-messages"])]),_:1},8,["onSubmit"])]),_:1}),e(_e,null,{default:t(()=>[e(T,{color:"blue darken-1",text:"",onClick:x[2]||(x[2]=b=>A.value=!1)},{default:t(()=>[bt]),_:1}),e(T,{color:"blue darken-1",text:"",loading:a(I),onClick:a(V)},{default:t(()=>[gt]),_:1},8,["loading","onClick"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1},8,["modelValue"])}}},ht=f("span",{class:"text-h5"},"Anexos do Chamado",-1),Vt=["href"],xt=E("Fechar"),wt={props:{taskId:{type:Number,required:!0},showAttachmentsModal:{type:Boolean,required:!0}},emits:["update:showAttachmentsModal"],setup(s,{emit:o}){const l=s,n=de(),{taskFiles:U}=ie(n),S=P(!1);le(()=>l.showAttachmentsModal,async q=>{q?(await n.getTaskFiles(l.taskId),S.value=!0):S.value=!1});const A=()=>{o("update:showAttachmentsModal",!1)},r=async q=>{await n.deleteTaskFile(q),await n.getTaskFiles(l.taskId)};return(q,u)=>($(),H(ae,{modelValue:S.value,"onUpdate:modelValue":u[0]||(u[0]=I=>S.value=I),"max-width":"800px"},{default:t(()=>[e(W,null,{default:t(()=>[e(oe,null,{default:t(()=>[ht]),_:1}),e(Z,null,{default:t(()=>[e(ve,null,{default:t(()=>[e(y,null,{default:t(()=>[($(!0),K(ue,null,pe(a(U),(I,V)=>($(),H(m,{key:V,cols:"12"},{default:t(()=>[e(W,{class:"mb-3"},{default:t(()=>[e(Z,null,{default:t(()=>[f("a",{href:a(Ne)(I.path),target:"_blank"},O(I.name),9,Vt),e(T,{icon:"",onClick:k=>r(I.id)},{default:t(()=>[e(a(Oe))]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})]),_:1}),e(_e,null,{default:t(()=>[e(T,{color:"secondary",onClick:A},{default:t(()=>[xt]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]))}},Ct={class:"mb-5 pb-5 border-b border-opacity-100"},St=f("h1",{class:"text-h3"},"Meus chamados",-1),$t=E("Novo Chamado"),Tt=E("Adicionar chamado"),Ut=E("Editar chamado"),Mt=E("Cancelar"),At=E("Deletar"),It=f("span",{class:"text-h5"},"Adicionar Nota de Trabalho",-1),qt=E("Cancelar"),jt=E("Adicionar"),Dt={setup(s){const o=Ae(),l=de(),{toEdit:n,toDelete:U}=ie(l),S=De();ie(S);const{isLoading:A}=re(l.getTasks());re(l.getPriorities()),re(l.getComplexities()),re(l.getTasksStatus()),re(l.getUsers());const r=te({get(){return!!Object.keys(n.value).length},set(w){w||(n.value={})}}),q=te({get(){return!!Object.keys(U.value).length},set(w){w||(U.value={})}}),u=P(!1);async function I(w){u.value=!0,await l.deleteTask(w.id),U.value={},u.value=!1}const V=P(!1),k=P(null),M=P(!1),j=P(""),L=P(o.user.id),F=w=>{k.value=w.id,V.value=!0},x=w=>{k.value=w.id,M.value=!0},D=async()=>{await S.addMessage(k.value,j.value,L.value),j.value="",M.value=!1},b=P(!1),G=w=>{k.value=w.id,b.value=!0};return(w,g)=>($(),K("div",null,[f("div",Ct,[e(y,null,{default:t(()=>[e(m,null,{default:t(()=>[St]),_:1}),e(m,{class:"text-right"},{default:t(()=>[e(ae,{width:"auto"},{activator:t(({props:_})=>[e(T,ee({flat:"",color:"primary"},_),{default:t(()=>[$t]),_:2},1040)]),default:t(({isActive:_})=>[e(W,{width:"400"},{default:t(()=>[e(oe,null,{default:t(()=>[Tt]),_:1}),e(Z,null,{default:t(()=>[e(ct,{onAdd:R=>_.value=!1,onCancel:R=>_.value=!1},null,8,["onAdd","onCancel"])]),_:2},1024)]),_:2},1024)]),_:1})]),_:1})]),_:1})]),a(A)?($(),H(tt,{key:0,width:3,color:"primary",indeterminate:""})):($(),K(ue,{key:1},[e(dt,{onOpenChat:F,onAddNote:x,onOpenAttachments:G}),e(ae,{modelValue:a(r),"onUpdate:modelValue":g[0]||(g[0]=_=>v(r)?r.value=_:null),width:"auto"},{default:t(({isActive:_})=>[e(W,{width:"400"},{default:t(()=>[e(oe,null,{default:t(()=>[Ut]),_:1}),e(Z,null,{default:t(()=>[e(mt,{task:a(n),onCancel:R=>_.value=!1,onEdit:R=>_.value=!1},null,8,["task","onCancel","onEdit"])]),_:2},1024)]),_:2},1024)]),_:1},8,["modelValue"]),e(ae,{modelValue:a(q),"onUpdate:modelValue":g[2]||(g[2]=_=>v(q)?q.value=_:null),width:"auto"},{default:t(({isActive:_})=>[e(W,{"prepend-icon":a(Ue),title:"Você tem certeza que deseja deletar este chamado?"},{actions:t(()=>[e(et),e(T,{onClick:R=>_.value=!1},{default:t(()=>[Mt]),_:2},1032,["onClick"]),e(T,{onClick:g[1]||(g[1]=R=>I(a(U))),variant:"tonal",color:"error",loading:u.value},{default:t(()=>[At]),_:1},8,["loading"])]),_:2},1032,["prepend-icon"])]),_:1},8,["modelValue"])],64)),e(Te,{taskId:k.value,showChatModal:V.value,userId:L.value,"onUpdate:showChatModal":g[3]||(g[3]=_=>V.value=_)},null,8,["taskId","showChatModal","userId"]),e(ae,{modelValue:M.value,"onUpdate:modelValue":g[6]||(g[6]=_=>M.value=_),"max-width":"500px"},{default:t(()=>[e(W,null,{default:t(()=>[e(oe,null,{default:t(()=>[It]),_:1}),e(Z,null,{default:t(()=>[e(Te,{taskId:k.value,showChatModal:V.value,userId:L.value,"onUpdate:showChatModal":g[4]||(g[4]=_=>V.value=_)},null,8,["taskId","showChatModal","userId"])]),_:1}),e(_e,null,{default:t(()=>[e(T,{color:"blue darken-1",text:"",onClick:g[5]||(g[5]=_=>M.value=!1)},{default:t(()=>[qt]),_:1}),e(T,{color:"blue darken-1",text:"",onClick:D},{default:t(()=>[jt]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(wt,{taskId:k.value,showAttachmentsModal:b.value,"onUpdate:showAttachmentsModal":g[7]||(g[7]=_=>b.value=_)},null,8,["taskId","showAttachmentsModal"])]))}};export{Dt as default};
